{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/action.js","src/lib/game.js","src/lib/gameObject/bench.js","src/lib/gameObject/lamp.js","src/lib/gameObject/platform.js","src/lib/gameObject/pole.js","src/lib/gameObject/tree.js","src/lib/scene.js","src/lib/scene/boot.js","src/lib/scene/play.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACrEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"action.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const debug = \"@@debug\";\r\nconst fontFamily = \"Cute Font\";\r\nconst Game = require(\"./lib/game\");\r\n\r\nWebFont.load({\r\n    google: {\r\n        families: [fontFamily]\r\n    },\r\n    active() {\r\n        const gameObject = new Game(fontFamily, debug);\r\n    }\r\n});\r\n","// load scenes\r\nconst BootScene = require(\"./scene/boot\");\r\nconst PlayScene = require(\"./scene/play\");\r\n\r\nclass Game extends Phaser.Game {\r\n    constructor(font, debug = false) {\r\n        if (debug) {\r\n            console.time(\"Game\");\r\n        }\r\n        super({\r\n            renderer: Phaser.AUTO,\r\n            antialias: true,\r\n            backgroundColor: \"#fcf1de\",\r\n            pixelArt: false,\r\n            roundPixels: true,\r\n            autoCenter: true,\r\n            banner: debug,\r\n            disableContextMenu: !debug,\r\n            scale: {\r\n                mode: Phaser.Scale.RESIZE,\r\n                parent: \"game\",\r\n                width: window.innerWidth,\r\n                height: window.innerHeight\r\n            },\r\n            scene: [\r\n                BootScene,\r\n                PlayScene\r\n            ]\r\n        });\r\n        this.font = font;\r\n        this.debug = debug;\r\n    }\r\n    start() {\r\n        super.start();\r\n        document.querySelector(\"#game canvas\").style.opacity = 1;\r\n        if (this.debug) {\r\n            console.timeEnd(\"Game\");\r\n        }\r\n        this.scale.on(\"resize\", () => {\r\n            document.querySelector(\"#game canvas\").style.opacity = 0;\r\n            window.location.reload();\r\n        });\r\n    }\r\n    sceneLog(name, log) {\r\n        if (this.debug) {\r\n            console.groupCollapsed(`%cScene Log [${name}]`, \"color: green;\");\r\n            console.table(log);\r\n            console.groupEnd();\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Game;","class Bench extends Phaser.GameObjects.Sprite {\r\n    constructor(scene) {\r\n        super(scene, 0, scene.game.config.height * 0.8, \"bench\");\r\n        this.scene = scene;\r\n        this.setOrigin(0, 0.92)\r\n            .setScale(0.8)\r\n            .setDepth(4);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Bench;","class Lamp extends Phaser.GameObjects.Sprite {\r\n    constructor(scene, count = 2, status = false, currect = true) {\r\n        super(scene, 0, scene.game.config.height * 0.8, `lamp-${count}-${(status == true ? \"on\" : \"off\")}`);\r\n        this.scene = scene;\r\n        this.gameCheck = true;\r\n        this.isCurrect = currect;\r\n        this.lightStatus = status;\r\n        this.setOrigin(0, 0.98)\r\n            .setScale(0.8)\r\n            .setDepth(4)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                this.lightStatus = !this.lightStatus;\r\n                this.setTexture(`lamp-${count}-${(this.lightStatus ? \"on\" : \"off\")}`);\r\n            }, this);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Lamp;","const TreeSprite = require(\"./tree\");\r\nconst PoleSprite = require(\"./pole\");\r\nconst BenchSprite = require(\"./bench\");\r\nconst LampSprite = require(\"./lamp\");\r\n\r\nclass Platform extends Phaser.GameObjects.Container {\r\n    constructor(scene) {\r\n        super(scene, 0, 0);\r\n        this.scene = scene;\r\n        this.level = {\r\n            requestCount: Math.round(scene.game.config.width / 180),\r\n            keepResponse: [],\r\n            data: [],\r\n            current: 1,\r\n            score: 0\r\n        };\r\n        this.scope = {\r\n            available: \"three\",\r\n            one: {\r\n                status: \"active\",\r\n                keep: 20,\r\n                el: this.scene.add.container((this.scene.game.config.width + 100), 0)\r\n            },\r\n            two: {\r\n                status: \"active\",\r\n                keep: 20,\r\n                el: this.scene.add.container((this.scene.game.config.width * 2) + 100, 0)\r\n            },\r\n            three: {\r\n                status: \"pause\",\r\n                keep: 20,\r\n                el: this.scene.add.container(this.scene.game.config.width, 0)\r\n            },\r\n        };\r\n        this.area(this.scope.one.el, 0xff0000);\r\n        this.area(this.scope.two.el, 0x00ff00);\r\n        this.area(this.scope.three.el, 0x0000ff);\r\n        this.add([this.scope.one.el, this.scope.two.el, this.scope.three.el]).setDepth(10);\r\n        // set limit\r\n        this.limit = this.scene.game.config.width * -1;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        // init start content\r\n        this.addContent(this.scope.one);\r\n        this.addContent(this.scope.two);\r\n    }\r\n    initRequest() {\r\n        this.level.data = [];\r\n        for (let i = 1; i <= this.level.requestCount; i++) {\r\n            this.level.data.push(this.createRequest(this.level.current, (i == this.level.requestCount ? true : Phaser.Utils.Array.GetRandom([true, false]))));\r\n        }\r\n        if (this.level.current > (this.scene.game.device.os.desktop ? 2 : 4)) {\r\n            this.scene.runSpace(\"mid\");\r\n        }\r\n        if (this.level.current > (this.scene.game.device.os.desktop ? 5 : 10)) {\r\n            this.scene.runSpace(\"max\");\r\n        }\r\n        this.level.current++;\r\n    }\r\n    createRequest(level, createResponse = true) {\r\n        let worldLevel = Math.ceil(level / 3);\r\n        let request = {\r\n            count: 0,\r\n            light: Phaser.Math.Between(0, worldLevel),\r\n            pole: {\r\n                status: (Phaser.Math.Between(1, 12) >= 8 ? true : false),\r\n                more: 0\r\n            }\r\n        };\r\n        if (request.light > 4) {\r\n            request.light = 4;\r\n        }\r\n        if (request.pole.status && (request.light > 0 && request.light <= 2)) {\r\n            request.pole.more = Phaser.Utils.Array.GetRandom([-1, -2, 1, 2]);\r\n            if (request.light + request.pole.more < 0) {\r\n                request.pole.more = 0;\r\n            }\r\n        }\r\n        request.count = request.light + request.pole.more;\r\n        let currect = [];\r\n        let wrong = [];\r\n        if (this.level.keepResponse.length >= 2) {\r\n            createResponse = true;\r\n        }\r\n        if (createResponse) {\r\n            for (let index in this.level.keepResponse) {\r\n                currect.push(this.level.keepResponse[index]);\r\n            }\r\n            this.level.keepResponse = [];\r\n        }\r\n        let needLamp = request.count;\r\n        while (needLamp > 0) {\r\n            let select = 1;\r\n            if (needLamp > 1) {\r\n                select = (request.light >= 2 ? 2 : Phaser.Utils.Array.GetRandom([1, 2]));\r\n            }\r\n            currect.push(select);\r\n            needLamp -= select;\r\n        }\r\n        if (!createResponse) {\r\n            for (let index in currect) {\r\n                this.level.keepResponse.push(currect[index]);\r\n            }\r\n            currect = [];\r\n        }\r\n        for (let i = 0; i < currect.length / 2; i++) {\r\n            wrong.push(Phaser.Math.Between(1, 2));\r\n        }\r\n        return {\r\n            request,\r\n            currect,\r\n            wrong\r\n        };\r\n    }\r\n    addContent(scope) {\r\n        if (!this.level.data.length) {\r\n            this.initRequest();\r\n        }\r\n        let maxWidth = scope.el.width * (this.scene.game.device.os.desktop ? 0.8 : 0.6);\r\n        let container = this.scene.add.container(0, 0);\r\n        scope.el.add(container);\r\n        while (scope.keep <= maxWidth && this.level.data.length) {\r\n            let data = this.level.data.shift();\r\n            // add tree\r\n            let treeSpace = Phaser.Math.Between(10, 30);\r\n            let tree = new TreeSprite(this.scene, Phaser.Math.Between(1, 6), data.request.light).show().setX(scope.keep + treeSpace);\r\n            scope.keep += tree.width + treeSpace;\r\n            container.add(tree);\r\n            if (!data.request.pole.status) {\r\n                // add bench\r\n                if (Phaser.Math.Between(1, 2) == 2) {\r\n                    let benchSpace = Phaser.Math.Between(10, 20);\r\n                    let bench = new BenchSprite(this.scene).show().setX(scope.keep + benchSpace);\r\n                    scope.keep += bench.displayWidth + benchSpace;\r\n                    container.add(bench);\r\n                }\r\n            }\r\n            else {\r\n                // add pole\r\n                let poleSpace = Phaser.Math.Between(5, 15);\r\n                let pole = new PoleSprite(this.scene, data.request.pole.more).show().setX(scope.keep + poleSpace);\r\n                scope.keep += pole.displayWidth + poleSpace;\r\n                container.add(pole);\r\n            }\r\n            let lamps = [];\r\n            // add currect lamps\r\n            for (let index in data.currect) {\r\n                let lampSpace = Phaser.Math.Between(10, 20);\r\n                let lampItem = new LampSprite(this.scene, data.currect[index], Phaser.Utils.Array.GetRandom([false, true]), true)\r\n                    .show()\r\n                    .setFlipX((data.currect[index] == 1 ? Phaser.Utils.Array.GetRandom([false, true]) : false))\r\n                    .setX(scope.keep + lampSpace);\r\n                scope.keep += lampItem.displayWidth + lampSpace;\r\n                lamps.push(lampItem);\r\n            }\r\n            // add wrong lamps\r\n            for (let index in data.wrong) {\r\n                if (scope.keep <= maxWidth) {\r\n                    let lampSpace = Phaser.Math.Between(10, 20);\r\n                    let lampItem = new LampSprite(this.scene, data.wrong[index], Phaser.Utils.Array.GetRandom([false, true]), false)\r\n                        .show()\r\n                        .setFlipX((data.currect[index] == 1 ? Phaser.Utils.Array.GetRandom([false, true]) : false))\r\n                        .setX(scope.keep + lampSpace);\r\n                    scope.keep += lampItem.displayWidth + lampSpace;\r\n                    lamps.push(lampItem);\r\n                }\r\n            }\r\n            container.add(lamps);\r\n        }\r\n        container.x = ((scope.el.width - scope.keep) / 2);\r\n    }\r\n    removeContent(scope) {\r\n        scope.status = \"pause\";\r\n        let gameOver = false;\r\n        scope.el.last.each((child) => {\r\n            child.setAlpha(0.3);\r\n            if (child.gameCheck) {\r\n                if (child.isCurrect != child.lightStatus) {\r\n                    child.setAlpha(1).setTintFill(0xff0000, 0x000000);\r\n                    gameOver = true;\r\n                }\r\n            }\r\n        });\r\n        if (gameOver) {\r\n            this.scene.pauseSpace();\r\n\r\n            if (this.scope.one.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.one.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            if (this.scope.two.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.two.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            if (this.scope.three.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.three.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            this.scene.tweens.add({\r\n                targets: scope.el,\r\n                x: 0,\r\n                delay: 800,\r\n                duration: 800,\r\n                ease: Phaser.Math.Easing.Back.Out\r\n            });\r\n            this.scene.time.addEvent({\r\n                delay: 1000,\r\n                callback: () => {\r\n                    this.scene.title.setText(\"Game Over\").setDepth(20).setTintFill(0xff0000, 0x000000);\r\n                },\r\n                callbackScope: this.scene\r\n            });\r\n            this.scene.time.addEvent({\r\n                delay: 6000,\r\n                callback: () => {\r\n                    this.scene.scene.start(\"Boot\");\r\n                },\r\n                callbackScope: this.scene\r\n            });\r\n        } else {\r\n            scope.el.x = Math.abs(this.limit);\r\n            scope.el.removeAll(true);\r\n            scope.keep = 20;\r\n        }\r\n    }\r\n    run(speed = 0) {\r\n        if (speed) {\r\n            this.level.score += speed;\r\n            if (this.scope.one.status == \"active\") {\r\n                this.scope.one.el.x -= speed;\r\n                if (this.scope.one.el.x <= this.limit) {\r\n                    this.scope.available = \"one\";\r\n                    this.scope.three.status = \"active\";\r\n                    this.removeContent(this.scope.one);\r\n                    this.addContent(this.scope.three);\r\n                }\r\n            }\r\n            if (this.scope.two.status == \"active\") {\r\n                this.scope.two.el.x -= speed;\r\n                if (this.scope.two.el.x <= this.limit) {\r\n                    this.scope.available = \"two\";\r\n                    this.scope.one.status = \"active\";\r\n                    this.removeContent(this.scope.two);\r\n                    this.addContent(this.scope.one);\r\n                }\r\n            }\r\n            if (this.scope.three.status == \"active\") {\r\n                this.scope.three.el.x -= speed;\r\n                if (this.scope.three.el.x <= this.limit) {\r\n                    this.scope.available = \"three\";\r\n                    this.scope.two.status = \"active\";\r\n                    this.removeContent(this.scope.three);\r\n                    this.addContent(this.scope.two);\r\n                }\r\n            }\r\n            this.scene.title.setText(Math.round(this.level.score / 10).toString().padStart(5, \"0\"));\r\n        }\r\n    }\r\n    area(scope, color) {\r\n        scope.setSize(this.scene.game.config.width - 40, (this.scene.game.config.height * 0.8) - 40)\r\n        if (false) {\r\n            let areaStart = this.scene.add.graphics(0, 0)\r\n                .fillStyle(color, 0.5)\r\n                .fillRect(10, 10, 2, scope.height + 20);\r\n            let areaEnd = this.scene.add.graphics(0, 0)\r\n                .fillStyle(color, 0.5)\r\n                .fillRect(scope.width + 20, 10, 2, scope.height + 20);\r\n            scope.add([areaStart, areaEnd]);\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Platform;","class Pole extends Phaser.GameObjects.Sprite {\r\n    constructor(scene, type = \"0\") {\r\n        let poleType = {\r\n            \"-2\": \"-2\",\r\n            \"-1\": \"-1\",\r\n            \"0\": \"\",\r\n            \"1\": \"+1\",\r\n            \"2\": \"+2\"\r\n        };\r\n        super(scene, 0, scene.game.config.height * 0.8, `pole${poleType[type]}`);\r\n        this.scene = scene;\r\n        this.setOrigin(0, 0.98)\r\n            .setScale(0.8)\r\n            .setDepth(4);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Pole;","class Tree extends Phaser.GameObjects.Container {\r\n    constructor(scene, type = \"1\", lightCount = 0) {\r\n        super(scene, 0, scene.game.config.height * 0.8);\r\n        this.scene = scene;\r\n        let tree = this.scene.add.sprite(0, 0, `tree${type}`)\r\n            .setScale(0.7)\r\n            .setOrigin(0, 0.92);\r\n        this.add(tree);\r\n        if (lightCount < 0 || lightCount > 4) {\r\n            lightCount = 0;\r\n        }\r\n        if (lightCount) {\r\n            let count = {\r\n                w: 200,\r\n                h: 230\r\n            };\r\n            switch (lightCount) {\r\n                case 2: {\r\n                    count.w *= 2;\r\n                    break;\r\n                }\r\n                case 3: {\r\n                    count.w *= 3;\r\n                    break;\r\n                }\r\n                case 4: {\r\n                    count.w *= 2;\r\n                    count.h *= 2;\r\n                    break;\r\n                }\r\n            }\r\n            let light = this.scene.add.tileSprite(tree.displayWidth / 2, (tree.displayHeight * -1), count.w, count.h, \"light\")\r\n                .setScale(0.13)\r\n                .setOrigin(0.5, 1);\r\n            this.add(light);\r\n        }\r\n        this.setDepth(4).setSize(tree.displayWidth, tree.displayHeight);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Tree;","const Platform = require(\"./gameObject/platform\");\r\n\r\nclass Scene extends Phaser.Scene {\r\n    constructor(name) {\r\n        super(name);\r\n        this.name = name;\r\n        this.keepLog = [];\r\n        this.lock = true;\r\n    }\r\n    log(message = null, system = false) {\r\n        if (this.game.debug && message) {\r\n            this.keepLog.push({\r\n                message,\r\n                bySystem: system\r\n            });\r\n        }\r\n        return this.keepLog;\r\n    }\r\n    init() {\r\n        this.log(\"init\", true);\r\n    }\r\n    preload() {\r\n        this.log(\"preload\", true);\r\n    }\r\n    create() {\r\n        // add ground\r\n        this.ground = this.add.tileSprite(-2, this.game.config.height + 2, this.game.config.width + 4, this.game.config.height * 0.2, \"ground\")\r\n            .setOrigin(0, 1)\r\n            .setTileScale((this.game.device.os.desktop ? 1 : 0.6))\r\n            .setDepth(0);\r\n        this.ground.speed = { current: 0, pause: 0, min: 2, mid: 3, max: 4 };\r\n        // add city\r\n        this.city = this.add.tileSprite(0, this.game.config.height * 0.8, this.game.config.width, 109, \"city\")\r\n            .setOrigin(0, 1)\r\n            .setDepth(1);\r\n        this.city.speed = { current: 0, pause: 0, min: 0.2, mid: 0.4, max: 0.6 };\r\n        this.line = this.add.graphics(0, 0)\r\n            .fillStyle(0xf4d242, 1)\r\n            .fillRect(0, (this.game.config.height * 0.8), this.game.config.width, 3)\r\n            .setDepth(1);\r\n        // add cloud\r\n        this.cloud = this.add.tileSprite(0, this.game.config.height * 0.6, this.game.config.width, 105, \"cloud\")\r\n            .setOrigin(0, 1)\r\n            .setDepth(2);\r\n        this.cloud.speed = { current: 0, pause: 0, min: -0.4, mid: -0.6, max: -0.8 };\r\n        // load platform\r\n        this.title = this.add.text(this.game.config.width * 0.5, this.game.config.height * 0.15, \"\", {\r\n            font: `${(this.game.device.os.desktop ? \"160\" : \"100\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(0.5);\r\n        // end of scene\r\n        this.log(\"create\", true);\r\n        this.game.sceneLog(this.name, this.keepLog);\r\n    }\r\n    update() {\r\n        if (this.lock) return;\r\n        if (this.ground.speed.current) {\r\n            this.platform.run(this.ground.speed.current);\r\n            this.ground.tilePositionX += (this.game.device.os.desktop ? this.ground.speed.current : this.ground.speed.current * 1.6);\r\n            if (this.city.speed.current) {\r\n                this.city.tilePositionX += this.city.speed.current;\r\n            }\r\n        }\r\n        if (this.cloud.speed.current) {\r\n            this.cloud.tilePositionX += this.cloud.speed.current;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Scene;","const Scene = require(\"../scene\");\r\n\r\nclass Boot extends Scene {\r\n    constructor() {\r\n        super(\"Boot\");\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n        this.load.image(\"ground\", \"data/ground.png\");\r\n        this.load.image(\"city\", \"data/city.png\");\r\n        this.load.image(\"cloud\", \"data/cloud.png\");\r\n        this.load.image(\"play\", \"data/play.png\");\r\n        //\r\n        this.load.image(\"tree1\", \"data/tree1.png\");\r\n        this.load.image(\"tree2\", \"data/tree2.png\");\r\n        this.load.image(\"tree3\", \"data/tree3.png\");\r\n        this.load.image(\"tree4\", \"data/tree4.png\");\r\n        this.load.image(\"tree5\", \"data/tree5.png\");\r\n        this.load.image(\"tree6\", \"data/tree6.png\");\r\n        //\r\n        this.load.image(\"light\", \"data/light.png\");\r\n        this.load.image(\"bench\", \"data/bench.png\");\r\n        //\r\n        this.load.image(\"pole\", \"data/pole.png\");\r\n        this.load.image(\"pole-1\", \"data/pole-1.png\");\r\n        this.load.image(\"pole-2\", \"data/pole-2.png\");\r\n        this.load.image(\"pole+1\", \"data/pole+1.png\");\r\n        this.load.image(\"pole+2\", \"data/pole+2.png\");\r\n        //\r\n        this.load.image(\"lamp-1-on\", \"data/lamp-1-on.png\");\r\n        this.load.image(\"lamp-1-off\", \"data/lamp-1-off.png\");\r\n        this.load.image(\"lamp-2-on\", \"data/lamp-2-on.png\");\r\n        this.load.image(\"lamp-2-off\", \"data/lamp-2-off.png\");\r\n    }\r\n    create() {\r\n        super.create();\r\n        this.title.setText(\"Light Tree\");\r\n        this.btn = this.add.sprite(0, 0, \"play\")\r\n            .setOrigin(0.5)\r\n            .setPosition(this.game.config.width / 2, this.game.config.height / 2)\r\n            .setDepth(10)\r\n            .setScale(0.4)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                this.scene.start(\"Play\");\r\n            }, this);;\r\n        this.tweens.add({\r\n            targets: this.btn,\r\n            x: {\r\n                from: this.game.config.width * 0.495,\r\n                to: this.game.config.width * 0.505\r\n            },\r\n            duration: 300,\r\n            yoyo: true,\r\n            repeat: -1\r\n        });\r\n    }\r\n}\r\n\r\nmodule.exports = Boot;","const Scene = require(\"../scene\");\r\nconst Platform = require(\"../gameObject/platform\");\r\n\r\nclass Play extends Scene {\r\n    constructor() {\r\n        super(\"Play\");\r\n        this.lock = false;\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n    }\r\n    create() {\r\n        super.create();\r\n        this.lock = false;\r\n        this.platform = new Platform(this);\r\n        if (this.game.config.height > this.game.config.width) {\r\n            this.title.setText(\"Rotate!\");\r\n            this.tweens.add({\r\n                targets: this.title,\r\n                angle: { from: -5, to: 5 },\r\n                duration: 150,\r\n                yoyo: true,\r\n                repeat: -1\r\n            });\r\n        } else {\r\n            if (this.game.config.width < 480 || this.game.config.height < 320) {\r\n                this.title.setText(\"Screen!\");\r\n                this.tweens.add({\r\n                    targets: this.title,\r\n                    y: 50,\r\n                    duration: 150,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            } else {\r\n                this.platform.show();\r\n                this.runSpace();\r\n            }\r\n        }\r\n    }\r\n    runSpace(speed = \"min\", object = []) {\r\n        if (!object.length) {\r\n            object = [\"ground\", \"city\", \"cloud\"];\r\n        }\r\n        for (let index in object) {\r\n            this[object[index]].speed.current = this[object[index]].speed[speed];\r\n        }\r\n    }\r\n    pauseSpace() {\r\n        this.lock = true;\r\n        this.ground.speed.current = this.ground.speed.pause;\r\n        this.city.speed.current = this.city.speed.pause;\r\n        this.cloud.speed.current = this.cloud.speed.pause;\r\n    }\r\n}\r\n\r\nmodule.exports = Play;"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYWN0aW9uLmpzIiwic3JjL2xpYi9nYW1lLmpzIiwic3JjL2xpYi9nYW1lT2JqZWN0L2JlbmNoLmpzIiwic3JjL2xpYi9nYW1lT2JqZWN0L2xhbXAuanMiLCJzcmMvbGliL2dhbWVPYmplY3QvcGxhdGZvcm0uanMiLCJzcmMvbGliL2dhbWVPYmplY3QvcG9sZS5qcyIsInNyYy9saWIvZ2FtZU9iamVjdC90cmVlLmpzIiwic3JjL2xpYi9zY2VuZS5qcyIsInNyYy9saWIvc2NlbmUvYm9vdC5qcyIsInNyYy9saWIvc2NlbmUvcGxheS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcERBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3JFQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOURBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGRlYnVnID0gXCJAQGRlYnVnXCI7XHJcbmNvbnN0IGZvbnRGYW1pbHkgPSBcIkN1dGUgRm9udFwiO1xyXG5jb25zdCBHYW1lID0gcmVxdWlyZShcIi4vbGliL2dhbWVcIik7XHJcblxyXG5XZWJGb250LmxvYWQoe1xyXG4gICAgZ29vZ2xlOiB7XHJcbiAgICAgICAgZmFtaWxpZXM6IFtmb250RmFtaWx5XVxyXG4gICAgfSxcclxuICAgIGFjdGl2ZSgpIHtcclxuICAgICAgICBjb25zdCBnYW1lT2JqZWN0ID0gbmV3IEdhbWUoZm9udEZhbWlseSwgZGVidWcpO1xyXG4gICAgfVxyXG59KTtcclxuIiwiLy8gbG9hZCBzY2VuZXNcclxuY29uc3QgQm9vdFNjZW5lID0gcmVxdWlyZShcIi4vc2NlbmUvYm9vdFwiKTtcclxuY29uc3QgUGxheVNjZW5lID0gcmVxdWlyZShcIi4vc2NlbmUvcGxheVwiKTtcclxuXHJcbmNsYXNzIEdhbWUgZXh0ZW5kcyBQaGFzZXIuR2FtZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihmb250LCBkZWJ1ZyA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKGRlYnVnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUudGltZShcIkdhbWVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1cGVyKHtcclxuICAgICAgICAgICAgcmVuZGVyZXI6IFBoYXNlci5BVVRPLFxyXG4gICAgICAgICAgICBhbnRpYWxpYXM6IHRydWUsXHJcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjZmNmMWRlXCIsXHJcbiAgICAgICAgICAgIHBpeGVsQXJ0OiBmYWxzZSxcclxuICAgICAgICAgICAgcm91bmRQaXhlbHM6IHRydWUsXHJcbiAgICAgICAgICAgIGF1dG9DZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgIGJhbm5lcjogZGVidWcsXHJcbiAgICAgICAgICAgIGRpc2FibGVDb250ZXh0TWVudTogIWRlYnVnLFxyXG4gICAgICAgICAgICBzY2FsZToge1xyXG4gICAgICAgICAgICAgICAgbW9kZTogUGhhc2VyLlNjYWxlLlJFU0laRSxcclxuICAgICAgICAgICAgICAgIHBhcmVudDogXCJnYW1lXCIsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzY2VuZTogW1xyXG4gICAgICAgICAgICAgICAgQm9vdFNjZW5lLFxyXG4gICAgICAgICAgICAgICAgUGxheVNjZW5lXHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmZvbnQgPSBmb250O1xyXG4gICAgICAgIHRoaXMuZGVidWcgPSBkZWJ1ZztcclxuICAgIH1cclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIHN1cGVyLnN0YXJ0KCk7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNnYW1lIGNhbnZhc1wiKS5zdHlsZS5vcGFjaXR5ID0gMTtcclxuICAgICAgICBpZiAodGhpcy5kZWJ1Zykge1xyXG4gICAgICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJHYW1lXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNjYWxlLm9uKFwicmVzaXplXCIsICgpID0+IHtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNnYW1lIGNhbnZhc1wiKS5zdHlsZS5vcGFjaXR5ID0gMDtcclxuICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uLnJlbG9hZCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG4gICAgc2NlbmVMb2cobmFtZSwgbG9nKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuZGVidWcpIHtcclxuICAgICAgICAgICAgY29uc29sZS5ncm91cENvbGxhcHNlZChgJWNTY2VuZSBMb2cgWyR7bmFtZX1dYCwgXCJjb2xvcjogZ3JlZW47XCIpO1xyXG4gICAgICAgICAgICBjb25zb2xlLnRhYmxlKGxvZyk7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBFbmQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gR2FtZTsiLCJjbGFzcyBCZW5jaCBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGUge1xyXG4gICAgY29uc3RydWN0b3Ioc2NlbmUpIHtcclxuICAgICAgICBzdXBlcihzY2VuZSwgMCwgc2NlbmUuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44LCBcImJlbmNoXCIpO1xyXG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuICAgICAgICB0aGlzLnNldE9yaWdpbigwLCAwLjkyKVxyXG4gICAgICAgICAgICAuc2V0U2NhbGUoMC44KVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoNCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQmVuY2g7IiwiY2xhc3MgTGFtcCBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGUge1xyXG4gICAgY29uc3RydWN0b3Ioc2NlbmUsIGNvdW50ID0gMiwgc3RhdHVzID0gZmFsc2UsIGN1cnJlY3QgPSB0cnVlKSB7XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIHNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCwgYGxhbXAtJHtjb3VudH0tJHsoc3RhdHVzID09IHRydWUgPyBcIm9uXCIgOiBcIm9mZlwiKX1gKTtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgdGhpcy5nYW1lQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaXNDdXJyZWN0ID0gY3VycmVjdDtcclxuICAgICAgICB0aGlzLmxpZ2h0U3RhdHVzID0gc3RhdHVzO1xyXG4gICAgICAgIHRoaXMuc2V0T3JpZ2luKDAsIDAuOTgpXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjgpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCg0KVxyXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUoKVxyXG4gICAgICAgICAgICAub24oXCJwb2ludGVyZG93blwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpZ2h0U3RhdHVzID0gIXRoaXMubGlnaHRTdGF0dXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRleHR1cmUoYGxhbXAtJHtjb3VudH0tJHsodGhpcy5saWdodFN0YXR1cyA/IFwib25cIiA6IFwib2ZmXCIpfWApO1xyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2hvdygpIHtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBMYW1wOyIsImNvbnN0IFRyZWVTcHJpdGUgPSByZXF1aXJlKFwiLi90cmVlXCIpO1xyXG5jb25zdCBQb2xlU3ByaXRlID0gcmVxdWlyZShcIi4vcG9sZVwiKTtcclxuY29uc3QgQmVuY2hTcHJpdGUgPSByZXF1aXJlKFwiLi9iZW5jaFwiKTtcclxuY29uc3QgTGFtcFNwcml0ZSA9IHJlcXVpcmUoXCIuL2xhbXBcIik7XHJcblxyXG5jbGFzcyBQbGF0Zm9ybSBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5Db250YWluZXIge1xyXG4gICAgY29uc3RydWN0b3Ioc2NlbmUpIHtcclxuICAgICAgICBzdXBlcihzY2VuZSwgMCwgMCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIHRoaXMubGV2ZWwgPSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RDb3VudDogTWF0aC5yb3VuZChzY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAvIDE4MCksXHJcbiAgICAgICAgICAgIGtlZXBSZXNwb25zZTogW10sXHJcbiAgICAgICAgICAgIGRhdGE6IFtdLFxyXG4gICAgICAgICAgICBjdXJyZW50OiAxLFxyXG4gICAgICAgICAgICBzY29yZTogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zY29wZSA9IHtcclxuICAgICAgICAgICAgYXZhaWxhYmxlOiBcInRocmVlXCIsXHJcbiAgICAgICAgICAgIG9uZToge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBcImFjdGl2ZVwiLFxyXG4gICAgICAgICAgICAgICAga2VlcDogMjAsXHJcbiAgICAgICAgICAgICAgICBlbDogdGhpcy5zY2VuZS5hZGQuY29udGFpbmVyKCh0aGlzLnNjZW5lLmdhbWUuY29uZmlnLndpZHRoICsgMTAwKSwgMClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHdvOiB7XHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFwiYWN0aXZlXCIsXHJcbiAgICAgICAgICAgICAgICBrZWVwOiAyMCxcclxuICAgICAgICAgICAgICAgIGVsOiB0aGlzLnNjZW5lLmFkZC5jb250YWluZXIoKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAyKSArIDEwMCwgMClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGhyZWU6IHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogXCJwYXVzZVwiLFxyXG4gICAgICAgICAgICAgICAga2VlcDogMjAsXHJcbiAgICAgICAgICAgICAgICBlbDogdGhpcy5zY2VuZS5hZGQuY29udGFpbmVyKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGgsIDApXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmFyZWEodGhpcy5zY29wZS5vbmUuZWwsIDB4ZmYwMDAwKTtcclxuICAgICAgICB0aGlzLmFyZWEodGhpcy5zY29wZS50d28uZWwsIDB4MDBmZjAwKTtcclxuICAgICAgICB0aGlzLmFyZWEodGhpcy5zY29wZS50aHJlZS5lbCwgMHgwMDAwZmYpO1xyXG4gICAgICAgIHRoaXMuYWRkKFt0aGlzLnNjb3BlLm9uZS5lbCwgdGhpcy5zY29wZS50d28uZWwsIHRoaXMuc2NvcGUudGhyZWUuZWxdKS5zZXREZXB0aCgxMCk7XHJcbiAgICAgICAgLy8gc2V0IGxpbWl0XHJcbiAgICAgICAgdGhpcy5saW1pdCA9IHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAtMTtcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgLy8gaW5pdCBzdGFydCBjb250ZW50XHJcbiAgICAgICAgdGhpcy5hZGRDb250ZW50KHRoaXMuc2NvcGUub25lKTtcclxuICAgICAgICB0aGlzLmFkZENvbnRlbnQodGhpcy5zY29wZS50d28pO1xyXG4gICAgfVxyXG4gICAgaW5pdFJlcXVlc3QoKSB7XHJcbiAgICAgICAgdGhpcy5sZXZlbC5kYXRhID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5sZXZlbC5yZXF1ZXN0Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmxldmVsLmRhdGEucHVzaCh0aGlzLmNyZWF0ZVJlcXVlc3QodGhpcy5sZXZlbC5jdXJyZW50LCAoaSA9PSB0aGlzLmxldmVsLnJlcXVlc3RDb3VudCA/IHRydWUgOiBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFt0cnVlLCBmYWxzZV0pKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sZXZlbC5jdXJyZW50ID4gKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDIgOiA0KSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnJ1blNwYWNlKFwibWlkXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sZXZlbC5jdXJyZW50ID4gKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDUgOiAxMCkpIHtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS5ydW5TcGFjZShcIm1heFwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5sZXZlbC5jdXJyZW50Kys7XHJcbiAgICB9XHJcbiAgICBjcmVhdGVSZXF1ZXN0KGxldmVsLCBjcmVhdGVSZXNwb25zZSA9IHRydWUpIHtcclxuICAgICAgICBsZXQgd29ybGRMZXZlbCA9IE1hdGguY2VpbChsZXZlbCAvIDMpO1xyXG4gICAgICAgIGxldCByZXF1ZXN0ID0ge1xyXG4gICAgICAgICAgICBjb3VudDogMCxcclxuICAgICAgICAgICAgbGlnaHQ6IFBoYXNlci5NYXRoLkJldHdlZW4oMCwgd29ybGRMZXZlbCksXHJcbiAgICAgICAgICAgIHBvbGU6IHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogKFBoYXNlci5NYXRoLkJldHdlZW4oMSwgMTIpID49IDggPyB0cnVlIDogZmFsc2UpLFxyXG4gICAgICAgICAgICAgICAgbW9yZTogMFxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuICAgICAgICBpZiAocmVxdWVzdC5saWdodCA+IDQpIHtcclxuICAgICAgICAgICAgcmVxdWVzdC5saWdodCA9IDQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChyZXF1ZXN0LnBvbGUuc3RhdHVzICYmIChyZXF1ZXN0LmxpZ2h0ID4gMCAmJiByZXF1ZXN0LmxpZ2h0IDw9IDIpKSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3QucG9sZS5tb3JlID0gUGhhc2VyLlV0aWxzLkFycmF5LkdldFJhbmRvbShbLTEsIC0yLCAxLCAyXSk7XHJcbiAgICAgICAgICAgIGlmIChyZXF1ZXN0LmxpZ2h0ICsgcmVxdWVzdC5wb2xlLm1vcmUgPCAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXF1ZXN0LnBvbGUubW9yZSA9IDA7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmVxdWVzdC5jb3VudCA9IHJlcXVlc3QubGlnaHQgKyByZXF1ZXN0LnBvbGUubW9yZTtcclxuICAgICAgICBsZXQgY3VycmVjdCA9IFtdO1xyXG4gICAgICAgIGxldCB3cm9uZyA9IFtdO1xyXG4gICAgICAgIGlmICh0aGlzLmxldmVsLmtlZXBSZXNwb25zZS5sZW5ndGggPj0gMikge1xyXG4gICAgICAgICAgICBjcmVhdGVSZXNwb25zZSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChjcmVhdGVSZXNwb25zZSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCBpbiB0aGlzLmxldmVsLmtlZXBSZXNwb25zZSkge1xyXG4gICAgICAgICAgICAgICAgY3VycmVjdC5wdXNoKHRoaXMubGV2ZWwua2VlcFJlc3BvbnNlW2luZGV4XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5sZXZlbC5rZWVwUmVzcG9uc2UgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG5lZWRMYW1wID0gcmVxdWVzdC5jb3VudDtcclxuICAgICAgICB3aGlsZSAobmVlZExhbXAgPiAwKSB7XHJcbiAgICAgICAgICAgIGxldCBzZWxlY3QgPSAxO1xyXG4gICAgICAgICAgICBpZiAobmVlZExhbXAgPiAxKSB7XHJcbiAgICAgICAgICAgICAgICBzZWxlY3QgPSAocmVxdWVzdC5saWdodCA+PSAyID8gMiA6IFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oWzEsIDJdKSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVjdC5wdXNoKHNlbGVjdCk7XHJcbiAgICAgICAgICAgIG5lZWRMYW1wIC09IHNlbGVjdDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCFjcmVhdGVSZXNwb25zZSkge1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCBpbiBjdXJyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxldmVsLmtlZXBSZXNwb25zZS5wdXNoKGN1cnJlY3RbaW5kZXhdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdXJyZWN0ID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgY3VycmVjdC5sZW5ndGggLyAyOyBpKyspIHtcclxuICAgICAgICAgICAgd3JvbmcucHVzaChQaGFzZXIuTWF0aC5CZXR3ZWVuKDEsIDIpKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHtcclxuICAgICAgICAgICAgcmVxdWVzdCxcclxuICAgICAgICAgICAgY3VycmVjdCxcclxuICAgICAgICAgICAgd3JvbmdcclxuICAgICAgICB9O1xyXG4gICAgfVxyXG4gICAgYWRkQ29udGVudChzY29wZSkge1xyXG4gICAgICAgIGlmICghdGhpcy5sZXZlbC5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICB0aGlzLmluaXRSZXF1ZXN0KCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBtYXhXaWR0aCA9IHNjb3BlLmVsLndpZHRoICogKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDAuOCA6IDAuNik7XHJcbiAgICAgICAgbGV0IGNvbnRhaW5lciA9IHRoaXMuc2NlbmUuYWRkLmNvbnRhaW5lcigwLCAwKTtcclxuICAgICAgICBzY29wZS5lbC5hZGQoY29udGFpbmVyKTtcclxuICAgICAgICB3aGlsZSAoc2NvcGUua2VlcCA8PSBtYXhXaWR0aCAmJiB0aGlzLmxldmVsLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0gdGhpcy5sZXZlbC5kYXRhLnNoaWZ0KCk7XHJcbiAgICAgICAgICAgIC8vIGFkZCB0cmVlXHJcbiAgICAgICAgICAgIGxldCB0cmVlU3BhY2UgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEwLCAzMCk7XHJcbiAgICAgICAgICAgIGxldCB0cmVlID0gbmV3IFRyZWVTcHJpdGUodGhpcy5zY2VuZSwgUGhhc2VyLk1hdGguQmV0d2VlbigxLCA2KSwgZGF0YS5yZXF1ZXN0LmxpZ2h0KS5zaG93KCkuc2V0WChzY29wZS5rZWVwICsgdHJlZVNwYWNlKTtcclxuICAgICAgICAgICAgc2NvcGUua2VlcCArPSB0cmVlLndpZHRoICsgdHJlZVNwYWNlO1xyXG4gICAgICAgICAgICBjb250YWluZXIuYWRkKHRyZWUpO1xyXG4gICAgICAgICAgICBpZiAoIWRhdGEucmVxdWVzdC5wb2xlLnN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgLy8gYWRkIGJlbmNoXHJcbiAgICAgICAgICAgICAgICBpZiAoUGhhc2VyLk1hdGguQmV0d2VlbigxLCAyKSA9PSAyKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJlbmNoU3BhY2UgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEwLCAyMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGJlbmNoID0gbmV3IEJlbmNoU3ByaXRlKHRoaXMuc2NlbmUpLnNob3coKS5zZXRYKHNjb3BlLmtlZXAgKyBiZW5jaFNwYWNlKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5rZWVwICs9IGJlbmNoLmRpc3BsYXlXaWR0aCArIGJlbmNoU3BhY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZChiZW5jaCk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgcG9sZVxyXG4gICAgICAgICAgICAgICAgbGV0IHBvbGVTcGFjZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oNSwgMTUpO1xyXG4gICAgICAgICAgICAgICAgbGV0IHBvbGUgPSBuZXcgUG9sZVNwcml0ZSh0aGlzLnNjZW5lLCBkYXRhLnJlcXVlc3QucG9sZS5tb3JlKS5zaG93KCkuc2V0WChzY29wZS5rZWVwICsgcG9sZVNwYWNlKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmtlZXAgKz0gcG9sZS5kaXNwbGF5V2lkdGggKyBwb2xlU3BhY2U7XHJcbiAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkKHBvbGUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBsYW1wcyA9IFtdO1xyXG4gICAgICAgICAgICAvLyBhZGQgY3VycmVjdCBsYW1wc1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCBpbiBkYXRhLmN1cnJlY3QpIHtcclxuICAgICAgICAgICAgICAgIGxldCBsYW1wU3BhY2UgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEwLCAyMCk7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGFtcEl0ZW0gPSBuZXcgTGFtcFNwcml0ZSh0aGlzLnNjZW5lLCBkYXRhLmN1cnJlY3RbaW5kZXhdLCBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFtmYWxzZSwgdHJ1ZV0pLCB0cnVlKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zaG93KClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0RmxpcFgoKGRhdGEuY3VycmVjdFtpbmRleF0gPT0gMSA/IFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oW2ZhbHNlLCB0cnVlXSkgOiBmYWxzZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFgoc2NvcGUua2VlcCArIGxhbXBTcGFjZSk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5rZWVwICs9IGxhbXBJdGVtLmRpc3BsYXlXaWR0aCArIGxhbXBTcGFjZTtcclxuICAgICAgICAgICAgICAgIGxhbXBzLnB1c2gobGFtcEl0ZW0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIC8vIGFkZCB3cm9uZyBsYW1wc1xyXG4gICAgICAgICAgICBmb3IgKGxldCBpbmRleCBpbiBkYXRhLndyb25nKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoc2NvcGUua2VlcCA8PSBtYXhXaWR0aCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBsYW1wU3BhY2UgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEwLCAyMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxhbXBJdGVtID0gbmV3IExhbXBTcHJpdGUodGhpcy5zY2VuZSwgZGF0YS53cm9uZ1tpbmRleF0sIFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oW2ZhbHNlLCB0cnVlXSksIGZhbHNlKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2hvdygpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRGbGlwWCgoZGF0YS5jdXJyZWN0W2luZGV4XSA9PSAxID8gUGhhc2VyLlV0aWxzLkFycmF5LkdldFJhbmRvbShbZmFsc2UsIHRydWVdKSA6IGZhbHNlKSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldFgoc2NvcGUua2VlcCArIGxhbXBTcGFjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUua2VlcCArPSBsYW1wSXRlbS5kaXNwbGF5V2lkdGggKyBsYW1wU3BhY2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbGFtcHMucHVzaChsYW1wSXRlbSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY29udGFpbmVyLmFkZChsYW1wcyk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGNvbnRhaW5lci54ID0gKChzY29wZS5lbC53aWR0aCAtIHNjb3BlLmtlZXApIC8gMik7XHJcbiAgICB9XHJcbiAgICByZW1vdmVDb250ZW50KHNjb3BlKSB7XHJcbiAgICAgICAgc2NvcGUuc3RhdHVzID0gXCJwYXVzZVwiO1xyXG4gICAgICAgIGxldCBnYW1lT3ZlciA9IGZhbHNlO1xyXG4gICAgICAgIHNjb3BlLmVsLmxhc3QuZWFjaCgoY2hpbGQpID0+IHtcclxuICAgICAgICAgICAgY2hpbGQuc2V0QWxwaGEoMC4zKTtcclxuICAgICAgICAgICAgaWYgKGNoaWxkLmdhbWVDaGVjaykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGNoaWxkLmlzQ3VycmVjdCAhPSBjaGlsZC5saWdodFN0YXR1cykge1xyXG4gICAgICAgICAgICAgICAgICAgIGNoaWxkLnNldEFscGhhKDEpLnNldFRpbnRGaWxsKDB4ZmYwMDAwLCAweDAwMDAwMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZ2FtZU92ZXIgPSB0cnVlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKGdhbWVPdmVyKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUucGF1c2VTcGFjZSgpO1xyXG5cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUub25lLnN0YXR1cyA9PSBcImFjdGl2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMuc2NvcGUub25lLmVsLFxyXG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAxLjIsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDgwMCxcclxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBQaGFzZXIuTWF0aC5FYXNpbmcuQmFjay5JblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUudHdvLnN0YXR1cyA9PSBcImFjdGl2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMuc2NvcGUudHdvLmVsLFxyXG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAxLjIsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDgwMCxcclxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBQaGFzZXIuTWF0aC5FYXNpbmcuQmFjay5JblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUudGhyZWUuc3RhdHVzID09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5zY29wZS50aHJlZS5lbCxcclxuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLnNjZW5lLmdhbWUuY29uZmlnLndpZHRoICogMS4yLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA4MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZWFzZTogUGhhc2VyLk1hdGguRWFzaW5nLkJhY2suSW5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiBzY29wZS5lbCxcclxuICAgICAgICAgICAgICAgIHg6IDAsXHJcbiAgICAgICAgICAgICAgICBkZWxheTogODAwLFxyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDgwMCxcclxuICAgICAgICAgICAgICAgIGVhc2U6IFBoYXNlci5NYXRoLkVhc2luZy5CYWNrLk91dFxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS50aW1lLmFkZEV2ZW50KHtcclxuICAgICAgICAgICAgICAgIGRlbGF5OiAxMDAwLFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnRpdGxlLnNldFRleHQoXCJHYW1lIE92ZXJcIikuc2V0RGVwdGgoMjApLnNldFRpbnRGaWxsKDB4ZmYwMDAwLCAweDAwMDAwMCk7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tTY29wZTogdGhpcy5zY2VuZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS50aW1lLmFkZEV2ZW50KHtcclxuICAgICAgICAgICAgICAgIGRlbGF5OiA2MDAwLFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2s6ICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnNjZW5lLnN0YXJ0KFwiQm9vdFwiKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFja1Njb3BlOiB0aGlzLnNjZW5lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHNjb3BlLmVsLnggPSBNYXRoLmFicyh0aGlzLmxpbWl0KTtcclxuICAgICAgICAgICAgc2NvcGUuZWwucmVtb3ZlQWxsKHRydWUpO1xyXG4gICAgICAgICAgICBzY29wZS5rZWVwID0gMjA7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcnVuKHNwZWVkID0gMCkge1xyXG4gICAgICAgIGlmIChzcGVlZCkge1xyXG4gICAgICAgICAgICB0aGlzLmxldmVsLnNjb3JlICs9IHNwZWVkO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZS5vbmUuc3RhdHVzID09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUub25lLmVsLnggLT0gc3BlZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY29wZS5vbmUuZWwueCA8PSB0aGlzLmxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS5hdmFpbGFibGUgPSBcIm9uZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUudGhyZWUuc3RhdHVzID0gXCJhY3RpdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNvbnRlbnQodGhpcy5zY29wZS5vbmUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGVudCh0aGlzLnNjb3BlLnRocmVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZS50d28uc3RhdHVzID09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUudHdvLmVsLnggLT0gc3BlZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY29wZS50d28uZWwueCA8PSB0aGlzLmxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS5hdmFpbGFibGUgPSBcInR3b1wiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUub25lLnN0YXR1cyA9IFwiYWN0aXZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDb250ZW50KHRoaXMuc2NvcGUudHdvKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRlbnQodGhpcy5zY29wZS5vbmUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLnRocmVlLnN0YXR1cyA9PSBcImFjdGl2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLnRocmVlLmVsLnggLT0gc3BlZWQ7XHJcbiAgICAgICAgICAgICAgICBpZiAodGhpcy5zY29wZS50aHJlZS5lbC54IDw9IHRoaXMubGltaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLmF2YWlsYWJsZSA9IFwidGhyZWVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLnR3by5zdGF0dXMgPSBcImFjdGl2ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ29udGVudCh0aGlzLnNjb3BlLnRocmVlKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRlbnQodGhpcy5zY29wZS50d28pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUudGl0bGUuc2V0VGV4dChNYXRoLnJvdW5kKHRoaXMubGV2ZWwuc2NvcmUgLyAxMCkudG9TdHJpbmcoKS5wYWRTdGFydCg1LCBcIjBcIikpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIGFyZWEoc2NvcGUsIGNvbG9yKSB7XHJcbiAgICAgICAgc2NvcGUuc2V0U2l6ZSh0aGlzLnNjZW5lLmdhbWUuY29uZmlnLndpZHRoIC0gNDAsICh0aGlzLnNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCkgLSA0MClcclxuICAgICAgICBpZiAoZmFsc2UpIHtcclxuICAgICAgICAgICAgbGV0IGFyZWFTdGFydCA9IHRoaXMuc2NlbmUuYWRkLmdyYXBoaWNzKDAsIDApXHJcbiAgICAgICAgICAgICAgICAuZmlsbFN0eWxlKGNvbG9yLCAwLjUpXHJcbiAgICAgICAgICAgICAgICAuZmlsbFJlY3QoMTAsIDEwLCAyLCBzY29wZS5oZWlnaHQgKyAyMCk7XHJcbiAgICAgICAgICAgIGxldCBhcmVhRW5kID0gdGhpcy5zY2VuZS5hZGQuZ3JhcGhpY3MoMCwgMClcclxuICAgICAgICAgICAgICAgIC5maWxsU3R5bGUoY29sb3IsIDAuNSlcclxuICAgICAgICAgICAgICAgIC5maWxsUmVjdChzY29wZS53aWR0aCArIDIwLCAxMCwgMiwgc2NvcGUuaGVpZ2h0ICsgMjApO1xyXG4gICAgICAgICAgICBzY29wZS5hZGQoW2FyZWFTdGFydCwgYXJlYUVuZF0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQbGF0Zm9ybTsiLCJjbGFzcyBQb2xlIGV4dGVuZHMgUGhhc2VyLkdhbWVPYmplY3RzLlNwcml0ZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSwgdHlwZSA9IFwiMFwiKSB7XHJcbiAgICAgICAgbGV0IHBvbGVUeXBlID0ge1xyXG4gICAgICAgICAgICBcIi0yXCI6IFwiLTJcIixcclxuICAgICAgICAgICAgXCItMVwiOiBcIi0xXCIsXHJcbiAgICAgICAgICAgIFwiMFwiOiBcIlwiLFxyXG4gICAgICAgICAgICBcIjFcIjogXCIrMVwiLFxyXG4gICAgICAgICAgICBcIjJcIjogXCIrMlwiXHJcbiAgICAgICAgfTtcclxuICAgICAgICBzdXBlcihzY2VuZSwgMCwgc2NlbmUuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44LCBgcG9sZSR7cG9sZVR5cGVbdHlwZV19YCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIHRoaXMuc2V0T3JpZ2luKDAsIDAuOTgpXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjgpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCg0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2hvdygpIHtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQb2xlOyIsImNsYXNzIFRyZWUgZXh0ZW5kcyBQaGFzZXIuR2FtZU9iamVjdHMuQ29udGFpbmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCB0eXBlID0gXCIxXCIsIGxpZ2h0Q291bnQgPSAwKSB7XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIHNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIGxldCB0cmVlID0gdGhpcy5zY2VuZS5hZGQuc3ByaXRlKDAsIDAsIGB0cmVlJHt0eXBlfWApXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjcpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMC45Mik7XHJcbiAgICAgICAgdGhpcy5hZGQodHJlZSk7XHJcbiAgICAgICAgaWYgKGxpZ2h0Q291bnQgPCAwIHx8IGxpZ2h0Q291bnQgPiA0KSB7XHJcbiAgICAgICAgICAgIGxpZ2h0Q291bnQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGlnaHRDb3VudCkge1xyXG4gICAgICAgICAgICBsZXQgY291bnQgPSB7XHJcbiAgICAgICAgICAgICAgICB3OiAyMDAsXHJcbiAgICAgICAgICAgICAgICBoOiAyMzBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3dpdGNoIChsaWdodENvdW50KSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC53ICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC53ICo9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC53ICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnQuaCAqPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBsaWdodCA9IHRoaXMuc2NlbmUuYWRkLnRpbGVTcHJpdGUodHJlZS5kaXNwbGF5V2lkdGggLyAyLCAodHJlZS5kaXNwbGF5SGVpZ2h0ICogLTEpLCBjb3VudC53LCBjb3VudC5oLCBcImxpZ2h0XCIpXHJcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC4xMylcclxuICAgICAgICAgICAgICAgIC5zZXRPcmlnaW4oMC41LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5hZGQobGlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldERlcHRoKDQpLnNldFNpemUodHJlZS5kaXNwbGF5V2lkdGgsIHRyZWUuZGlzcGxheUhlaWdodCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gVHJlZTsiLCJjb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoXCIuL2dhbWVPYmplY3QvcGxhdGZvcm1cIik7XHJcblxyXG5jbGFzcyBTY2VuZSBleHRlbmRzIFBoYXNlci5TY2VuZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XHJcbiAgICAgICAgc3VwZXIobmFtZSk7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmtlZXBMb2cgPSBbXTtcclxuICAgICAgICB0aGlzLmxvY2sgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgbG9nKG1lc3NhZ2UgPSBudWxsLCBzeXN0ZW0gPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmdhbWUuZGVidWcgJiYgbWVzc2FnZSkge1xyXG4gICAgICAgICAgICB0aGlzLmtlZXBMb2cucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgYnlTeXN0ZW06IHN5c3RlbVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMua2VlcExvZztcclxuICAgIH1cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJpbml0XCIsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgcHJlbG9hZCgpIHtcclxuICAgICAgICB0aGlzLmxvZyhcInByZWxvYWRcIiwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgLy8gYWRkIGdyb3VuZFxyXG4gICAgICAgIHRoaXMuZ3JvdW5kID0gdGhpcy5hZGQudGlsZVNwcml0ZSgtMiwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKyAyLCB0aGlzLmdhbWUuY29uZmlnLndpZHRoICsgNCwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjIsIFwiZ3JvdW5kXCIpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMSlcclxuICAgICAgICAgICAgLnNldFRpbGVTY2FsZSgodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMSA6IDAuNikpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCgwKTtcclxuICAgICAgICB0aGlzLmdyb3VuZC5zcGVlZCA9IHsgY3VycmVudDogMCwgcGF1c2U6IDAsIG1pbjogMiwgbWlkOiAzLCBtYXg6IDQgfTtcclxuICAgICAgICAvLyBhZGQgY2l0eVxyXG4gICAgICAgIHRoaXMuY2l0eSA9IHRoaXMuYWRkLnRpbGVTcHJpdGUoMCwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgsIHRoaXMuZ2FtZS5jb25maWcud2lkdGgsIDEwOSwgXCJjaXR5XCIpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMSlcclxuICAgICAgICAgICAgLnNldERlcHRoKDEpO1xyXG4gICAgICAgIHRoaXMuY2l0eS5zcGVlZCA9IHsgY3VycmVudDogMCwgcGF1c2U6IDAsIG1pbjogMC4yLCBtaWQ6IDAuNCwgbWF4OiAwLjYgfTtcclxuICAgICAgICB0aGlzLmxpbmUgPSB0aGlzLmFkZC5ncmFwaGljcygwLCAwKVxyXG4gICAgICAgICAgICAuZmlsbFN0eWxlKDB4ZjRkMjQyLCAxKVxyXG4gICAgICAgICAgICAuZmlsbFJlY3QoMCwgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44KSwgdGhpcy5nYW1lLmNvbmZpZy53aWR0aCwgMylcclxuICAgICAgICAgICAgLnNldERlcHRoKDEpO1xyXG4gICAgICAgIC8vIGFkZCBjbG91ZFxyXG4gICAgICAgIHRoaXMuY2xvdWQgPSB0aGlzLmFkZC50aWxlU3ByaXRlKDAsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC42LCB0aGlzLmdhbWUuY29uZmlnLndpZHRoLCAxMDUsIFwiY2xvdWRcIilcclxuICAgICAgICAgICAgLnNldE9yaWdpbigwLCAxKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoMik7XHJcbiAgICAgICAgdGhpcy5jbG91ZC5zcGVlZCA9IHsgY3VycmVudDogMCwgcGF1c2U6IDAsIG1pbjogLTAuNCwgbWlkOiAtMC42LCBtYXg6IC0wLjggfTtcclxuICAgICAgICAvLyBsb2FkIHBsYXRmb3JtXHJcbiAgICAgICAgdGhpcy50aXRsZSA9IHRoaXMuYWRkLnRleHQodGhpcy5nYW1lLmNvbmZpZy53aWR0aCAqIDAuNSwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjE1LCBcIlwiLCB7XHJcbiAgICAgICAgICAgIGZvbnQ6IGAkeyh0aGlzLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyBcIjE2MFwiIDogXCIxMDBcIil9cHggJyR7dGhpcy5nYW1lLmZvbnR9J2AsXHJcbiAgICAgICAgICAgIGZpbGw6IFwiI0ZGRjhFRVwiXHJcbiAgICAgICAgfSkuc2V0T3JpZ2luKDAuNSk7XHJcbiAgICAgICAgLy8gZW5kIG9mIHNjZW5lXHJcbiAgICAgICAgdGhpcy5sb2coXCJjcmVhdGVcIiwgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5nYW1lLnNjZW5lTG9nKHRoaXMubmFtZSwgdGhpcy5rZWVwTG9nKTtcclxuICAgIH1cclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2NrKSByZXR1cm47XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JvdW5kLnNwZWVkLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5wbGF0Zm9ybS5ydW4odGhpcy5ncm91bmQuc3BlZWQuY3VycmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdW5kLnRpbGVQb3NpdGlvblggKz0gKHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IHRoaXMuZ3JvdW5kLnNwZWVkLmN1cnJlbnQgOiB0aGlzLmdyb3VuZC5zcGVlZC5jdXJyZW50ICogMS42KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY2l0eS5zcGVlZC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNpdHkudGlsZVBvc2l0aW9uWCArPSB0aGlzLmNpdHkuc3BlZWQuY3VycmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jbG91ZC5zcGVlZC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvdWQudGlsZVBvc2l0aW9uWCArPSB0aGlzLmNsb3VkLnNwZWVkLmN1cnJlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFNjZW5lOyIsImNvbnN0IFNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lXCIpO1xyXG5cclxuY2xhc3MgQm9vdCBleHRlbmRzIFNjZW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKFwiQm9vdFwiKTtcclxuICAgIH1cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgc3VwZXIuaW5pdCgpO1xyXG4gICAgfVxyXG4gICAgcHJlbG9hZCgpIHtcclxuICAgICAgICBzdXBlci5wcmVsb2FkKCk7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiZ3JvdW5kXCIsIFwiZGF0YS9ncm91bmQucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImNpdHlcIiwgXCJkYXRhL2NpdHkucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImNsb3VkXCIsIFwiZGF0YS9jbG91ZC5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicGxheVwiLCBcImRhdGEvcGxheS5wbmdcIik7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJ0cmVlMVwiLCBcImRhdGEvdHJlZTEucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInRyZWUyXCIsIFwiZGF0YS90cmVlMi5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwidHJlZTNcIiwgXCJkYXRhL3RyZWUzLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJ0cmVlNFwiLCBcImRhdGEvdHJlZTQucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInRyZWU1XCIsIFwiZGF0YS90cmVlNS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwidHJlZTZcIiwgXCJkYXRhL3RyZWU2LnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImxpZ2h0XCIsIFwiZGF0YS9saWdodC5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiYmVuY2hcIiwgXCJkYXRhL2JlbmNoLnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGVcIiwgXCJkYXRhL3BvbGUucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGUtMVwiLCBcImRhdGEvcG9sZS0xLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJwb2xlLTJcIiwgXCJkYXRhL3BvbGUtMi5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicG9sZSsxXCIsIFwiZGF0YS9wb2xlKzEucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGUrMlwiLCBcImRhdGEvcG9sZSsyLnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImxhbXAtMS1vblwiLCBcImRhdGEvbGFtcC0xLW9uLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJsYW1wLTEtb2ZmXCIsIFwiZGF0YS9sYW1wLTEtb2ZmLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJsYW1wLTItb25cIiwgXCJkYXRhL2xhbXAtMi1vbi5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwibGFtcC0yLW9mZlwiLCBcImRhdGEvbGFtcC0yLW9mZi5wbmdcIik7XHJcbiAgICB9XHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgc3VwZXIuY3JlYXRlKCk7XHJcbiAgICAgICAgdGhpcy50aXRsZS5zZXRUZXh0KFwiTGlnaHQgVHJlZVwiKTtcclxuICAgICAgICB0aGlzLmJ0biA9IHRoaXMuYWRkLnNwcml0ZSgwLCAwLCBcInBsYXlcIilcclxuICAgICAgICAgICAgLnNldE9yaWdpbigwLjUpXHJcbiAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLmdhbWUuY29uZmlnLndpZHRoIC8gMiwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgLyAyKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoMTApXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgwLjQpXHJcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSgpXHJcbiAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuc3RhcnQoXCJQbGF5XCIpO1xyXG4gICAgICAgICAgICB9LCB0aGlzKTs7XHJcbiAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5idG4sXHJcbiAgICAgICAgICAgIHg6IHtcclxuICAgICAgICAgICAgICAgIGZyb206IHRoaXMuZ2FtZS5jb25maWcud2lkdGggKiAwLjQ5NSxcclxuICAgICAgICAgICAgICAgIHRvOiB0aGlzLmdhbWUuY29uZmlnLndpZHRoICogMC41MDVcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgZHVyYXRpb246IDMwMCxcclxuICAgICAgICAgICAgeW95bzogdHJ1ZSxcclxuICAgICAgICAgICAgcmVwZWF0OiAtMVxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7IiwiY29uc3QgU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmVcIik7XHJcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZShcIi4uL2dhbWVPYmplY3QvcGxhdGZvcm1cIik7XHJcblxyXG5jbGFzcyBQbGF5IGV4dGVuZHMgU2NlbmUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJQbGF5XCIpO1xyXG4gICAgICAgIHRoaXMubG9jayA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBzdXBlci5pbml0KCk7XHJcbiAgICB9XHJcbiAgICBwcmVsb2FkKCkge1xyXG4gICAgICAgIHN1cGVyLnByZWxvYWQoKTtcclxuICAgIH1cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICBzdXBlci5jcmVhdGUoKTtcclxuICAgICAgICB0aGlzLmxvY2sgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLnBsYXRmb3JtID0gbmV3IFBsYXRmb3JtKHRoaXMpO1xyXG4gICAgICAgIGlmICh0aGlzLmdhbWUuY29uZmlnLmhlaWdodCA+IHRoaXMuZ2FtZS5jb25maWcud2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy50aXRsZS5zZXRUZXh0KFwiUm90YXRlIVwiKTtcclxuICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMudGl0bGUsXHJcbiAgICAgICAgICAgICAgICBhbmdsZTogeyBmcm9tOiAtNSwgdG86IDUgfSxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXHJcbiAgICAgICAgICAgICAgICB5b3lvOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nYW1lLmNvbmZpZy53aWR0aCA8IDQ4MCB8fCB0aGlzLmdhbWUuY29uZmlnLmhlaWdodCA8IDMyMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZS5zZXRUZXh0KFwiU2NyZWVuIVwiKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICB5OiA1MCxcclxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwLFxyXG4gICAgICAgICAgICAgICAgICAgIHlveW86IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnBsYXRmb3JtLnNob3coKTtcclxuICAgICAgICAgICAgICAgIHRoaXMucnVuU3BhY2UoKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJ1blNwYWNlKHNwZWVkID0gXCJtaW5cIiwgb2JqZWN0ID0gW10pIHtcclxuICAgICAgICBpZiAoIW9iamVjdC5sZW5ndGgpIHtcclxuICAgICAgICAgICAgb2JqZWN0ID0gW1wiZ3JvdW5kXCIsIFwiY2l0eVwiLCBcImNsb3VkXCJdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpbmRleCBpbiBvYmplY3QpIHtcclxuICAgICAgICAgICAgdGhpc1tvYmplY3RbaW5kZXhdXS5zcGVlZC5jdXJyZW50ID0gdGhpc1tvYmplY3RbaW5kZXhdXS5zcGVlZFtzcGVlZF07XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcGF1c2VTcGFjZSgpIHtcclxuICAgICAgICB0aGlzLmxvY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuZ3JvdW5kLnNwZWVkLmN1cnJlbnQgPSB0aGlzLmdyb3VuZC5zcGVlZC5wYXVzZTtcclxuICAgICAgICB0aGlzLmNpdHkuc3BlZWQuY3VycmVudCA9IHRoaXMuY2l0eS5zcGVlZC5wYXVzZTtcclxuICAgICAgICB0aGlzLmNsb3VkLnNwZWVkLmN1cnJlbnQgPSB0aGlzLmNsb3VkLnNwZWVkLnBhdXNlO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXk7Il19"}