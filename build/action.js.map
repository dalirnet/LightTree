{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/action.js","src/lib/game.js","src/lib/gameObject/bench.js","src/lib/gameObject/lamp.js","src/lib/gameObject/platform.js","src/lib/gameObject/pole.js","src/lib/gameObject/tree.js","src/lib/scene.js","src/lib/scene/boot.js","src/lib/scene/help.js","src/lib/scene/play.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC5FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"action.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const debug = \"@@debug\";\r\nconst fontFamily = \"Cute Font\";\r\nconst Game = require(\"./lib/game\");\r\n\r\nWebFont.load({\r\n    google: {\r\n        families: [fontFamily]\r\n    },\r\n    active() {\r\n        const gameObject = new Game(fontFamily, debug);\r\n    }\r\n});\r\n","// load scenes\r\nconst BootScene = require(\"./scene/boot\");\r\nconst HelpScene = require(\"./scene/help\");\r\nconst PlayScene = require(\"./scene/play\");\r\n\r\nclass Game extends Phaser.Game {\r\n    constructor(font, debug = false) {\r\n        if (debug) {\r\n            console.time(\"Game\");\r\n        }\r\n        super({\r\n            renderer: Phaser.AUTO,\r\n            antialias: true,\r\n            backgroundColor: \"#fcf1de\",\r\n            pixelArt: false,\r\n            roundPixels: true,\r\n            autoCenter: true,\r\n            banner: debug,\r\n            disableContextMenu: !debug,\r\n            scale: {\r\n                mode: Phaser.Scale.RESIZE,\r\n                parent: \"game\",\r\n                width: window.innerWidth,\r\n                height: window.innerHeight\r\n            },\r\n            scene: [\r\n                BootScene,\r\n                HelpScene,\r\n                PlayScene\r\n            ]\r\n        });\r\n        this.font = font;\r\n        this.debug = debug;\r\n    }\r\n    start() {\r\n        super.start();\r\n        document.querySelector(\"#game canvas\").style.opacity = 1;\r\n        if (this.debug) {\r\n            console.timeEnd(\"Game\");\r\n        }\r\n        this.scale.on(\"resize\", () => {\r\n            document.querySelector(\"#game canvas\").style.opacity = 0;\r\n            this.config.width = window.innerWidth;\r\n            this.config.height = window.innerHeight;\r\n            this.scene.getScene(\"Play\").scene.stop();\r\n            this.scene.getScene(\"Help\").scene.stop();\r\n            this.scene.getScene(\"Boot\").scene.restart();\r\n            setTimeout(() => {\r\n                document.querySelector(\"#game canvas\").style.opacity = 1;\r\n            }, 250);\r\n        });\r\n    }\r\n    sceneLog(name, log) {\r\n        if (this.debug) {\r\n            console.groupCollapsed(`%cScene Log [${name}]`, \"color: green;\");\r\n            console.table(log);\r\n            console.groupEnd();\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Game;","class Bench extends Phaser.GameObjects.Sprite {\r\n    constructor(scene) {\r\n        super(scene, 0, scene.game.config.height * 0.8, \"bench\");\r\n        this.scene = scene;\r\n        this.setOrigin(0, 0.85)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.8 : 0.6))\r\n            .setDepth(4);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Bench;","class Lamp extends Phaser.GameObjects.Sprite {\r\n    constructor(scene, count = 2, status = false, currect = true) {\r\n        super(scene, 0, scene.game.config.height * 0.8, `lamp-${count}-${(status == true ? \"on\" : \"off\")}`);\r\n        this.scene = scene;\r\n        this.gameCheck = true;\r\n        this.isCurrect = currect;\r\n        this.lightStatus = status;\r\n        this.setOrigin(0, 0.96)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.8 : 0.6))\r\n            .setDepth(4)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                this.lightStatus = !this.lightStatus;\r\n                this.setTexture(`lamp-${count}-${(this.lightStatus ? \"on\" : \"off\")}`);\r\n            }, this);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Lamp;","const TreeSprite = require(\"./tree\");\r\nconst PoleSprite = require(\"./pole\");\r\nconst BenchSprite = require(\"./bench\");\r\nconst LampSprite = require(\"./lamp\");\r\n\r\nclass Platform extends Phaser.GameObjects.Container {\r\n    constructor(scene) {\r\n        super(scene, 0, 0);\r\n        this.scene = scene;\r\n        this.level = {\r\n            requestCount: Math.round(scene.game.config.width / 180),\r\n            keepResponse: [],\r\n            data: [],\r\n            current: 1,\r\n            score: 0\r\n        };\r\n        this.scope = {\r\n            available: \"three\",\r\n            one: {\r\n                status: \"active\",\r\n                keep: 20,\r\n                el: this.scene.add.container((this.scene.game.config.width + 100), 0)\r\n            },\r\n            two: {\r\n                status: \"active\",\r\n                keep: 20,\r\n                el: this.scene.add.container((this.scene.game.config.width * 2) + 100, 0)\r\n            },\r\n            three: {\r\n                status: \"pause\",\r\n                keep: 20,\r\n                el: this.scene.add.container(this.scene.game.config.width, 0)\r\n            },\r\n        };\r\n        this.area(this.scope.one.el, 0xff0000);\r\n        this.area(this.scope.two.el, 0x00ff00);\r\n        this.area(this.scope.three.el, 0x0000ff);\r\n        this.add([this.scope.one.el, this.scope.two.el, this.scope.three.el]).setDepth(10);\r\n        // set limit\r\n        this.limit = this.scene.game.config.width * -1;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        // init start content\r\n        this.addContent(this.scope.one);\r\n        this.addContent(this.scope.two);\r\n    }\r\n    initRequest() {\r\n        this.level.data = [];\r\n        for (let i = 1; i <= this.level.requestCount; i++) {\r\n            this.level.data.push(this.createRequest(this.level.current, (i == this.level.requestCount ? true : Phaser.Utils.Array.GetRandom([true, false]))));\r\n        }\r\n        if (this.level.current > (this.scene.game.device.os.desktop ? 2 : 4)) {\r\n            this.scene.runSpace(\"mid\");\r\n        }\r\n        if (this.level.current > (this.scene.game.device.os.desktop ? 5 : 8)) {\r\n            this.scene.runSpace(\"max\");\r\n        }\r\n        this.level.current++;\r\n    }\r\n    createRequest(level, createResponse = true) {\r\n        let worldLevel = Math.ceil(level / 3);\r\n        let request = {\r\n            count: 0,\r\n            light: Phaser.Math.Between(0, worldLevel),\r\n            pole: {\r\n                status: (Phaser.Math.Between(1, 12) >= 8 ? true : false),\r\n                more: 0\r\n            }\r\n        };\r\n        if (request.light > 4) {\r\n            request.light = 4;\r\n        }\r\n        if (request.pole.status && (request.light > 0 && request.light <= 2)) {\r\n            request.pole.more = Phaser.Utils.Array.GetRandom([-1, -2, 1, 2]);\r\n            if (request.light + request.pole.more < 0) {\r\n                request.pole.more = 0;\r\n            }\r\n        }\r\n        request.count = request.light + request.pole.more;\r\n        let currect = [];\r\n        let wrong = [];\r\n        if (this.level.keepResponse.length >= 2) {\r\n            createResponse = true;\r\n        }\r\n        if (createResponse) {\r\n            for (let index in this.level.keepResponse) {\r\n                currect.push(this.level.keepResponse[index]);\r\n            }\r\n            this.level.keepResponse = [];\r\n        }\r\n        let needLamp = request.count;\r\n        while (needLamp > 0) {\r\n            let select = 1;\r\n            if (needLamp > 1) {\r\n                select = (request.light >= 2 ? 2 : Phaser.Utils.Array.GetRandom([1, 2]));\r\n            }\r\n            currect.push(select);\r\n            needLamp -= select;\r\n        }\r\n        if (!createResponse) {\r\n            for (let index in currect) {\r\n                this.level.keepResponse.push(currect[index]);\r\n            }\r\n            currect = [];\r\n        }\r\n        for (let i = 0; i < currect.length / 2; i++) {\r\n            wrong.push(Phaser.Math.Between(1, 2));\r\n        }\r\n        return {\r\n            request,\r\n            currect,\r\n            wrong\r\n        };\r\n    }\r\n    addContent(scope) {\r\n        if (!this.level.data.length) {\r\n            this.initRequest();\r\n        }\r\n        let maxWidth = scope.el.width * (this.scene.game.device.os.desktop ? 0.8 : 0.6);\r\n        let container = this.scene.add.container(0, 0);\r\n        scope.el.add(container);\r\n        while (scope.keep <= maxWidth && this.level.data.length) {\r\n            let data = this.level.data.shift();\r\n            // add tree\r\n            let treeSpace = Phaser.Math.Between(10, 30);\r\n            let tree = new TreeSprite(this.scene, Phaser.Math.Between(1, 6), data.request.light).show().setX(scope.keep + treeSpace);\r\n            scope.keep += tree.width + treeSpace;\r\n            container.add(tree);\r\n            if (!data.request.pole.status) {\r\n                // add bench\r\n                if (Phaser.Math.Between(1, 2) == 2) {\r\n                    let benchSpace = Phaser.Math.Between(10, 20);\r\n                    let bench = new BenchSprite(this.scene).show().setX(scope.keep + benchSpace);\r\n                    scope.keep += bench.displayWidth + benchSpace;\r\n                    container.add(bench);\r\n                }\r\n            }\r\n            else {\r\n                // add pole\r\n                let poleSpace = Phaser.Math.Between(5, 15);\r\n                let pole = new PoleSprite(this.scene, data.request.pole.more).show().setX(scope.keep + poleSpace);\r\n                scope.keep += pole.displayWidth + poleSpace;\r\n                container.add(pole);\r\n            }\r\n            let lamps = [];\r\n            // add currect lamps\r\n            for (let index in data.currect) {\r\n                let lampSpace = Phaser.Math.Between(10, 20);\r\n                let lampItem = new LampSprite(this.scene, data.currect[index], Phaser.Utils.Array.GetRandom([false, true]), true)\r\n                    .show()\r\n                    .setFlipX((data.currect[index] == 1 ? Phaser.Utils.Array.GetRandom([false, true]) : false))\r\n                    .setX(scope.keep + lampSpace);\r\n                scope.keep += lampItem.displayWidth + lampSpace;\r\n                lamps.push(lampItem);\r\n            }\r\n            // add wrong lamps\r\n            for (let index in data.wrong) {\r\n                if (scope.keep <= maxWidth) {\r\n                    let lampSpace = Phaser.Math.Between(10, 20);\r\n                    let lampItem = new LampSprite(this.scene, data.wrong[index], Phaser.Utils.Array.GetRandom([false, true]), false)\r\n                        .show()\r\n                        .setFlipX((data.currect[index] == 1 ? Phaser.Utils.Array.GetRandom([false, true]) : false))\r\n                        .setX(scope.keep + lampSpace);\r\n                    scope.keep += lampItem.displayWidth + lampSpace;\r\n                    lamps.push(lampItem);\r\n                }\r\n            }\r\n            container.add(lamps);\r\n        }\r\n        container.x = ((scope.el.width - scope.keep) / 2);\r\n    }\r\n    removeContent(scope) {\r\n        scope.status = \"pause\";\r\n        let gameOver = false;\r\n        scope.el.last.each((child) => {\r\n            child.setAlpha(0.3);\r\n            if (child.gameCheck) {\r\n                if (child.isCurrect != child.lightStatus) {\r\n                    child.setAlpha(1).setTintFill(0xff0000, 0x000000);\r\n                    gameOver = true;\r\n                }\r\n            }\r\n        });\r\n        if (gameOver) {\r\n            this.scene.pauseSpace();\r\n\r\n            if (this.scope.one.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.one.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            if (this.scope.two.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.two.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            if (this.scope.three.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.three.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            this.scene.tweens.add({\r\n                targets: scope.el,\r\n                x: 0,\r\n                delay: 800,\r\n                duration: 800,\r\n                ease: Phaser.Math.Easing.Back.Out\r\n            });\r\n            this.scene.time.addEvent({\r\n                delay: 1000,\r\n                callback: () => {\r\n                    this.scene.title.setText(\"Game Over\").setDepth(20).setTintFill(0xff0000, 0x000000);\r\n                },\r\n                callbackScope: this.scene\r\n            });\r\n            this.scene.time.addEvent({\r\n                delay: 6000,\r\n                callback: () => {\r\n                    this.scene.scene.start(\"Boot\");\r\n                },\r\n                callbackScope: this.scene\r\n            });\r\n        } else {\r\n            scope.el.x = Math.abs(this.limit);\r\n            scope.el.removeAll(true);\r\n            scope.keep = 20;\r\n        }\r\n    }\r\n    run(speed = 0) {\r\n        if (speed) {\r\n            this.level.score += speed;\r\n            if (this.scope.one.status == \"active\") {\r\n                this.scope.one.el.x -= speed;\r\n                if (this.scope.one.el.x <= this.limit) {\r\n                    this.scope.available = \"one\";\r\n                    this.scope.three.status = \"active\";\r\n                    this.removeContent(this.scope.one);\r\n                    this.addContent(this.scope.three);\r\n                }\r\n            }\r\n            if (this.scope.two.status == \"active\") {\r\n                this.scope.two.el.x -= speed;\r\n                if (this.scope.two.el.x <= this.limit) {\r\n                    this.scope.available = \"two\";\r\n                    this.scope.one.status = \"active\";\r\n                    this.removeContent(this.scope.two);\r\n                    this.addContent(this.scope.one);\r\n                }\r\n            }\r\n            if (this.scope.three.status == \"active\") {\r\n                this.scope.three.el.x -= speed;\r\n                if (this.scope.three.el.x <= this.limit) {\r\n                    this.scope.available = \"three\";\r\n                    this.scope.two.status = \"active\";\r\n                    this.removeContent(this.scope.three);\r\n                    this.addContent(this.scope.two);\r\n                }\r\n            }\r\n            this.scene.title.setText(Math.round(this.level.score / 10).toString().padStart(5, \"0\"));\r\n        }\r\n    }\r\n    area(scope, color) {\r\n        scope.setSize(this.scene.game.config.width - 40, (this.scene.game.config.height * 0.8) - 40)\r\n        if (false) {\r\n            let areaStart = this.scene.add.graphics(0, 0)\r\n                .fillStyle(color, 0.5)\r\n                .fillRect(10, 10, 2, scope.height + 20);\r\n            let areaEnd = this.scene.add.graphics(0, 0)\r\n                .fillStyle(color, 0.5)\r\n                .fillRect(scope.width + 20, 10, 2, scope.height + 20);\r\n            scope.add([areaStart, areaEnd]);\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Platform;","class Pole extends Phaser.GameObjects.Sprite {\r\n    constructor(scene, type = \"0\") {\r\n        let poleType = {\r\n            \"-2\": \"-2\",\r\n            \"-1\": \"-1\",\r\n            \"0\": \"\",\r\n            \"1\": \"+1\",\r\n            \"2\": \"+2\"\r\n        };\r\n        super(scene, 0, scene.game.config.height * 0.8, `pole${poleType[type]}`);\r\n        this.scene = scene;\r\n        this.setOrigin(0, 0.97)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.8 : 0.6))\r\n            .setDepth(4);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Pole;","class Tree extends Phaser.GameObjects.Container {\r\n    constructor(scene, type = \"1\", lightCount = 0) {\r\n        super(scene, 0, scene.game.config.height * 0.8);\r\n        this.scene = scene;\r\n        let tree = this.scene.add.sprite(0, 0, `tree${type}`)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.7 : 0.5))\r\n            .setOrigin(0, 0.91);\r\n        this.add(tree);\r\n        if (lightCount < 0 || lightCount > 4) {\r\n            lightCount = 0;\r\n        }\r\n        if (lightCount) {\r\n            let count = {\r\n                w: 200,\r\n                h: 230\r\n            };\r\n            switch (lightCount) {\r\n                case 2: {\r\n                    count.w *= 2;\r\n                    break;\r\n                }\r\n                case 3: {\r\n                    count.w *= 3;\r\n                    break;\r\n                }\r\n                case 4: {\r\n                    count.w *= 2;\r\n                    count.h *= 2;\r\n                    break;\r\n                }\r\n            }\r\n            let light = this.scene.add.tileSprite(tree.displayWidth / 2, (tree.displayHeight * -1), count.w, count.h, \"light\")\r\n                .setScale(0.13)\r\n                .setOrigin(0.5, 1);\r\n            this.add(light);\r\n        }\r\n        this.setDepth(4).setSize(tree.displayWidth, tree.displayHeight);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Tree;","const Platform = require(\"./gameObject/platform\");\r\n\r\nclass Scene extends Phaser.Scene {\r\n    constructor(name) {\r\n        super(name);\r\n        this.name = name;\r\n        this.keepLog = [];\r\n        this.lock = true;\r\n        this.helpOpen = false;\r\n    }\r\n    log(message = null, system = false) {\r\n        if (this.game.debug && message) {\r\n            this.keepLog.push({\r\n                message,\r\n                bySystem: system\r\n            });\r\n        }\r\n        return this.keepLog;\r\n    }\r\n    init() {\r\n        this.log(\"init\", true);\r\n    }\r\n    preload() {\r\n        this.log(\"preload\", true);\r\n    }\r\n    create() {\r\n        // add ground\r\n        this.ground = this.add.tileSprite(-2, this.game.config.height + 2, this.game.config.width + 4, this.game.config.height * 0.2, \"ground\")\r\n            .setOrigin(0, 1)\r\n            .setTileScale((this.game.device.os.desktop ? 1 : 0.6))\r\n            .setDepth(0);\r\n        this.ground.speed = {\r\n            current: 0,\r\n            pause: 0,\r\n            min: (this.game.device.os.desktop ? 2.5 : 2),\r\n            mid: (this.game.device.os.desktop ? 3.5 : 3),\r\n            max: (this.game.device.os.desktop ? 4.5 : 4),\r\n        };\r\n        // add city\r\n        this.city = this.add.tileSprite(0, this.game.config.height * 0.8, this.game.config.width, 109, \"city\")\r\n            .setOrigin(0, 1)\r\n            .setDepth(1);\r\n        this.city.speed = {\r\n            current: 0,\r\n            pause: 0,\r\n            min: 0.2,\r\n            mid: 0.4,\r\n            max: 0.6\r\n        };\r\n        this.line = this.add.graphics(0, 0)\r\n            .fillStyle(0xf4d242, 1)\r\n            .fillRect(0, (this.game.config.height * 0.8), this.game.config.width, 3)\r\n            .setDepth(1);\r\n        // add cloud\r\n        this.cloud = this.add.tileSprite(0, this.game.config.height * 0.6, this.game.config.width, 105, \"cloud\")\r\n            .setOrigin(0, 1)\r\n            .setDepth(2);\r\n        this.cloud.speed = {\r\n            current: 0,\r\n            pause: 0,\r\n            min: -0.4,\r\n            mid: -0.6,\r\n            max: -0.8\r\n        };\r\n        // load platform\r\n        this.title = this.add.text(this.game.config.width * 0.5, this.game.config.height * 0.15, \"\", {\r\n            font: `${(this.game.device.os.desktop ? \"160\" : \"100\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(0.5);\r\n        // add help\r\n        this.helpBtn = this.add.text(25, this.game.config.height - 20, \"?\", {\r\n            font: `${(this.game.device.os.desktop ? \"40\" : \"30\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(0, 1)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                if (!this.helpOpen) {\r\n                    this.scene.start(\"Help\");\r\n                } else {\r\n                    this.scene.start(\"Boot\");\r\n                }\r\n            }, this);\r\n        // add fullscreen\r\n        this.fullscreenBtn = this.add.text(this.game.config.width - 25, this.game.config.height - 20, \"⎚\", {\r\n            font: `${(this.game.device.os.desktop ? \"40\" : \"30\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(1, 1)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                if (this.scale.isFullscreen) {\r\n                    this.scale.stopFullscreen();\r\n                } else {\r\n                    this.scale.startFullscreen();\r\n                }\r\n            }, this);\r\n        // end of scene\r\n        this.log(\"create\", true);\r\n        this.game.sceneLog(this.name, this.keepLog);\r\n    }\r\n    update() {\r\n        if (this.lock) return;\r\n        if (this.ground.speed.current) {\r\n            this.platform.run(this.ground.speed.current);\r\n            this.ground.tilePositionX += (this.game.device.os.desktop ? this.ground.speed.current : this.ground.speed.current * 1.6);\r\n            if (this.city.speed.current) {\r\n                this.city.tilePositionX += this.city.speed.current;\r\n            }\r\n        }\r\n        if (this.cloud.speed.current) {\r\n            this.cloud.tilePositionX += this.cloud.speed.current;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Scene;","const Scene = require(\"../scene\");\r\n\r\nclass Boot extends Scene {\r\n    constructor() {\r\n        super(\"Boot\");\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n        this.load.image(\"ground\", \"data/ground.png\");\r\n        this.load.image(\"city\", \"data/city.png\");\r\n        this.load.image(\"cloud\", \"data/cloud.png\");\r\n        this.load.image(\"play\", \"data/play.png\");\r\n        this.load.image(\"help\", \"data/help.png\");\r\n        //\r\n        this.load.image(\"tree1\", \"data/tree1.png\");\r\n        this.load.image(\"tree2\", \"data/tree2.png\");\r\n        this.load.image(\"tree3\", \"data/tree3.png\");\r\n        this.load.image(\"tree4\", \"data/tree4.png\");\r\n        this.load.image(\"tree5\", \"data/tree5.png\");\r\n        this.load.image(\"tree6\", \"data/tree6.png\");\r\n        //\r\n        this.load.image(\"light\", \"data/light.png\");\r\n        this.load.image(\"bench\", \"data/bench.png\");\r\n        //\r\n        this.load.image(\"pole\", \"data/pole.png\");\r\n        this.load.image(\"pole-1\", \"data/pole-1.png\");\r\n        this.load.image(\"pole-2\", \"data/pole-2.png\");\r\n        this.load.image(\"pole+1\", \"data/pole+1.png\");\r\n        this.load.image(\"pole+2\", \"data/pole+2.png\");\r\n        //\r\n        this.load.image(\"lamp-1-on\", \"data/lamp-1-on.png\");\r\n        this.load.image(\"lamp-1-off\", \"data/lamp-1-off.png\");\r\n        this.load.image(\"lamp-2-on\", \"data/lamp-2-on.png\");\r\n        this.load.image(\"lamp-2-off\", \"data/lamp-2-off.png\");\r\n    }\r\n    create() {\r\n        super.create();\r\n        this.helpOpen = false;\r\n        if (this.game.config.height > this.game.config.width) {\r\n            this.title.setText(\"Rotate!\")\r\n                .setDepth(20)\r\n                .setTintFill(0xff0000, 0x000000)\r\n                .setPosition(this.game.config.width / 2, (this.game.config.height * 0.8) / 2);\r\n            this.tweens.add({\r\n                targets: this.title,\r\n                scale: { from: 0.95, to: 1.05 },\r\n                duration: 150,\r\n                yoyo: true,\r\n                repeat: -1\r\n            });\r\n        } else {\r\n            if (this.game.config.width < 480 || this.game.config.height < 320) {\r\n                this.title.setText(\"Screen!\")\r\n                    .setDepth(20)\r\n                    .setTintFill(0xff0000, 0x000000)\r\n                    .setPosition(this.game.config.width / 2, (this.game.config.height * 0.8) / 2);\r\n                this.tweens.add({\r\n                    targets: this.title,\r\n                    scale: { from: 0.95, to: 1.05 },\r\n                    duration: 150,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            } else {\r\n                this.title.setText(\"Light Tree\").setTintFill(0xf4d242);\r\n                this.btn = this.add.sprite(0, 0, \"play\")\r\n                    .setOrigin(0.5)\r\n                    .setPosition(this.game.config.width / 2, (this.game.config.height / 2) + (this.game.config.height * 0.1))\r\n                    .setDepth(10)\r\n                    .setScale(0.3)\r\n                    .setInteractive()\r\n                    .on(\"pointerdown\", () => {\r\n                        this.scene.start(\"Play\");\r\n                    }, this);\r\n                this.tweens.add({\r\n                    targets: this.btn,\r\n                    x: {\r\n                        from: this.game.config.width * 0.497,\r\n                        to: this.game.config.width * 0.503\r\n                    },\r\n                    duration: 300,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Boot;","const Scene = require(\"../scene\");\r\n\r\nclass Help extends Scene {\r\n    constructor() {\r\n        super(\"Help\");\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n\r\n    }\r\n    create() {\r\n        super.create();\r\n        // hide boot scene object\r\n        this.ground.setVisible(false);\r\n        this.city.setVisible(false);\r\n        this.cloud.setVisible(false);\r\n        this.line.setVisible(false);\r\n        this.fullscreenBtn.setVisible(false);\r\n        // add help image\r\n        this.helpImage = this.add.image(0, 0, \"help\")\r\n            .setOrigin(0.5)\r\n            .setScale((this.game.device.os.desktop ? 0.6 : 0.4))\r\n            .setDepth(5)\r\n            .setPosition(this.game.config.width / 2, this.game.config.height / 2)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                this.scene.start(\"Boot\");\r\n            }, this);\r\n        this.helpOpen = true;\r\n        this.helpBtn.setText(\"«\").setTintFill(0x000000);\r\n    }\r\n}\r\n\r\nmodule.exports = Help;","const Scene = require(\"../scene\");\r\nconst Platform = require(\"../gameObject/platform\");\r\n\r\nclass Play extends Scene {\r\n    constructor() {\r\n        super(\"Play\");\r\n        this.lock = false;\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n    }\r\n    create() {\r\n        super.create();\r\n        this.lock = false;\r\n        this.helpOpen = false;\r\n        this.platform = new Platform(this);\r\n        if (this.game.config.height > this.game.config.width) {\r\n            this.title.setText(\"Rotate!\");\r\n            this.tweens.add({\r\n                targets: this.title,\r\n                angle: { from: -5, to: 5 },\r\n                duration: 150,\r\n                yoyo: true,\r\n                repeat: -1\r\n            });\r\n        } else {\r\n            if (this.game.config.width < 480 || this.game.config.height < 320) {\r\n                this.title.setText(\"Screen!\");\r\n                this.tweens.add({\r\n                    targets: this.title,\r\n                    y: 50,\r\n                    duration: 150,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            } else {\r\n                this.platform.show();\r\n                this.runSpace();\r\n            }\r\n        }\r\n    }\r\n    runSpace(speed = \"min\", object = []) {\r\n        if (!object.length) {\r\n            object = [\"ground\", \"city\", \"cloud\"];\r\n        }\r\n        for (let index in object) {\r\n            this[object[index]].speed.current = this[object[index]].speed[speed];\r\n        }\r\n    }\r\n    pauseSpace() {\r\n        this.lock = true;\r\n        this.ground.speed.current = this.ground.speed.pause;\r\n        this.city.speed.current = this.city.speed.pause;\r\n        this.cloud.speed.current = this.cloud.speed.pause;\r\n    }\r\n}\r\n\r\nmodule.exports = Play;"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYWN0aW9uLmpzIiwic3JjL2xpYi9nYW1lLmpzIiwic3JjL2xpYi9nYW1lT2JqZWN0L2JlbmNoLmpzIiwic3JjL2xpYi9nYW1lT2JqZWN0L2xhbXAuanMiLCJzcmMvbGliL2dhbWVPYmplY3QvcGxhdGZvcm0uanMiLCJzcmMvbGliL2dhbWVPYmplY3QvcG9sZS5qcyIsInNyYy9saWIvZ2FtZU9iamVjdC90cmVlLmpzIiwic3JjL2xpYi9zY2VuZS5qcyIsInNyYy9saWIvc2NlbmUvYm9vdC5qcyIsInNyYy9saWIvc2NlbmUvaGVscC5qcyIsInNyYy9saWIvc2NlbmUvcGxheS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDNUZBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3BDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQSIsImZpbGUiOiJnZW5lcmF0ZWQuanMiLCJzb3VyY2VSb290IjoiIiwic291cmNlc0NvbnRlbnQiOlsiKGZ1bmN0aW9uKCl7ZnVuY3Rpb24gcihlLG4sdCl7ZnVuY3Rpb24gbyhpLGYpe2lmKCFuW2ldKXtpZighZVtpXSl7dmFyIGM9XCJmdW5jdGlvblwiPT10eXBlb2YgcmVxdWlyZSYmcmVxdWlyZTtpZighZiYmYylyZXR1cm4gYyhpLCEwKTtpZih1KXJldHVybiB1KGksITApO3ZhciBhPW5ldyBFcnJvcihcIkNhbm5vdCBmaW5kIG1vZHVsZSAnXCIraStcIidcIik7dGhyb3cgYS5jb2RlPVwiTU9EVUxFX05PVF9GT1VORFwiLGF9dmFyIHA9bltpXT17ZXhwb3J0czp7fX07ZVtpXVswXS5jYWxsKHAuZXhwb3J0cyxmdW5jdGlvbihyKXt2YXIgbj1lW2ldWzFdW3JdO3JldHVybiBvKG58fHIpfSxwLHAuZXhwb3J0cyxyLGUsbix0KX1yZXR1cm4gbltpXS5leHBvcnRzfWZvcih2YXIgdT1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlLGk9MDtpPHQubGVuZ3RoO2krKylvKHRbaV0pO3JldHVybiBvfXJldHVybiByfSkoKSIsImNvbnN0IGRlYnVnID0gXCJAQGRlYnVnXCI7XHJcbmNvbnN0IGZvbnRGYW1pbHkgPSBcIkN1dGUgRm9udFwiO1xyXG5jb25zdCBHYW1lID0gcmVxdWlyZShcIi4vbGliL2dhbWVcIik7XHJcblxyXG5XZWJGb250LmxvYWQoe1xyXG4gICAgZ29vZ2xlOiB7XHJcbiAgICAgICAgZmFtaWxpZXM6IFtmb250RmFtaWx5XVxyXG4gICAgfSxcclxuICAgIGFjdGl2ZSgpIHtcclxuICAgICAgICBjb25zdCBnYW1lT2JqZWN0ID0gbmV3IEdhbWUoZm9udEZhbWlseSwgZGVidWcpO1xyXG4gICAgfVxyXG59KTtcclxuIiwiLy8gbG9hZCBzY2VuZXNcclxuY29uc3QgQm9vdFNjZW5lID0gcmVxdWlyZShcIi4vc2NlbmUvYm9vdFwiKTtcclxuY29uc3QgSGVscFNjZW5lID0gcmVxdWlyZShcIi4vc2NlbmUvaGVscFwiKTtcclxuY29uc3QgUGxheVNjZW5lID0gcmVxdWlyZShcIi4vc2NlbmUvcGxheVwiKTtcclxuXHJcbmNsYXNzIEdhbWUgZXh0ZW5kcyBQaGFzZXIuR2FtZSB7XHJcbiAgICBjb25zdHJ1Y3Rvcihmb250LCBkZWJ1ZyA9IGZhbHNlKSB7XHJcbiAgICAgICAgaWYgKGRlYnVnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUudGltZShcIkdhbWVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHN1cGVyKHtcclxuICAgICAgICAgICAgcmVuZGVyZXI6IFBoYXNlci5BVVRPLFxyXG4gICAgICAgICAgICBhbnRpYWxpYXM6IHRydWUsXHJcbiAgICAgICAgICAgIGJhY2tncm91bmRDb2xvcjogXCIjZmNmMWRlXCIsXHJcbiAgICAgICAgICAgIHBpeGVsQXJ0OiBmYWxzZSxcclxuICAgICAgICAgICAgcm91bmRQaXhlbHM6IHRydWUsXHJcbiAgICAgICAgICAgIGF1dG9DZW50ZXI6IHRydWUsXHJcbiAgICAgICAgICAgIGJhbm5lcjogZGVidWcsXHJcbiAgICAgICAgICAgIGRpc2FibGVDb250ZXh0TWVudTogIWRlYnVnLFxyXG4gICAgICAgICAgICBzY2FsZToge1xyXG4gICAgICAgICAgICAgICAgbW9kZTogUGhhc2VyLlNjYWxlLlJFU0laRSxcclxuICAgICAgICAgICAgICAgIHBhcmVudDogXCJnYW1lXCIsXHJcbiAgICAgICAgICAgICAgICB3aWR0aDogd2luZG93LmlubmVyV2lkdGgsXHJcbiAgICAgICAgICAgICAgICBoZWlnaHQ6IHdpbmRvdy5pbm5lckhlaWdodFxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICBzY2VuZTogW1xyXG4gICAgICAgICAgICAgICAgQm9vdFNjZW5lLFxyXG4gICAgICAgICAgICAgICAgSGVscFNjZW5lLFxyXG4gICAgICAgICAgICAgICAgUGxheVNjZW5lXHJcbiAgICAgICAgICAgIF1cclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLmZvbnQgPSBmb250O1xyXG4gICAgICAgIHRoaXMuZGVidWcgPSBkZWJ1ZztcclxuICAgIH1cclxuICAgIHN0YXJ0KCkge1xyXG4gICAgICAgIHN1cGVyLnN0YXJ0KCk7XHJcbiAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNnYW1lIGNhbnZhc1wiKS5zdHlsZS5vcGFjaXR5ID0gMTtcclxuICAgICAgICBpZiAodGhpcy5kZWJ1Zykge1xyXG4gICAgICAgICAgICBjb25zb2xlLnRpbWVFbmQoXCJHYW1lXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNjYWxlLm9uKFwicmVzaXplXCIsICgpID0+IHtcclxuICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNnYW1lIGNhbnZhc1wiKS5zdHlsZS5vcGFjaXR5ID0gMDtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICAgICAgdGhpcy5jb25maWcuaGVpZ2h0ID0gd2luZG93LmlubmVySGVpZ2h0O1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLmdldFNjZW5lKFwiUGxheVwiKS5zY2VuZS5zdG9wKCk7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUuZ2V0U2NlbmUoXCJIZWxwXCIpLnNjZW5lLnN0b3AoKTtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS5nZXRTY2VuZShcIkJvb3RcIikuc2NlbmUucmVzdGFydCgpO1xyXG4gICAgICAgICAgICBzZXRUaW1lb3V0KCgpID0+IHtcclxuICAgICAgICAgICAgICAgIGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZ2FtZSBjYW52YXNcIikuc3R5bGUub3BhY2l0eSA9IDE7XHJcbiAgICAgICAgICAgIH0sIDI1MCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbiAgICBzY2VuZUxvZyhuYW1lLCBsb2cpIHtcclxuICAgICAgICBpZiAodGhpcy5kZWJ1Zykge1xyXG4gICAgICAgICAgICBjb25zb2xlLmdyb3VwQ29sbGFwc2VkKGAlY1NjZW5lIExvZyBbJHtuYW1lfV1gLCBcImNvbG9yOiBncmVlbjtcIik7XHJcbiAgICAgICAgICAgIGNvbnNvbGUudGFibGUobG9nKTtcclxuICAgICAgICAgICAgY29uc29sZS5ncm91cEVuZCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBHYW1lOyIsImNsYXNzIEJlbmNoIGV4dGVuZHMgUGhhc2VyLkdhbWVPYmplY3RzLlNwcml0ZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSkge1xyXG4gICAgICAgIHN1cGVyKHNjZW5lLCAwLCBzY2VuZS5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgsIFwiYmVuY2hcIik7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIHRoaXMuc2V0T3JpZ2luKDAsIDAuODUpXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgodGhpcy5zY2VuZS5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMC44IDogMC42KSlcclxuICAgICAgICAgICAgLnNldERlcHRoKDQpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBzaG93KCkge1xyXG4gICAgICAgIHRoaXMuc2NlbmUuYWRkLmV4aXN0aW5nKHRoaXMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEJlbmNoOyIsImNsYXNzIExhbXAgZXh0ZW5kcyBQaGFzZXIuR2FtZU9iamVjdHMuU3ByaXRlIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCBjb3VudCA9IDIsIHN0YXR1cyA9IGZhbHNlLCBjdXJyZWN0ID0gdHJ1ZSkge1xyXG4gICAgICAgIHN1cGVyKHNjZW5lLCAwLCBzY2VuZS5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgsIGBsYW1wLSR7Y291bnR9LSR7KHN0YXR1cyA9PSB0cnVlID8gXCJvblwiIDogXCJvZmZcIil9YCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIHRoaXMuZ2FtZUNoZWNrID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmlzQ3VycmVjdCA9IGN1cnJlY3Q7XHJcbiAgICAgICAgdGhpcy5saWdodFN0YXR1cyA9IHN0YXR1cztcclxuICAgICAgICB0aGlzLnNldE9yaWdpbigwLCAwLjk2KVxyXG4gICAgICAgICAgICAuc2V0U2NhbGUoKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDAuOCA6IDAuNikpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCg0KVxyXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUoKVxyXG4gICAgICAgICAgICAub24oXCJwb2ludGVyZG93blwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmxpZ2h0U3RhdHVzID0gIXRoaXMubGlnaHRTdGF0dXM7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNldFRleHR1cmUoYGxhbXAtJHtjb3VudH0tJHsodGhpcy5saWdodFN0YXR1cyA/IFwib25cIiA6IFwib2ZmXCIpfWApO1xyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2hvdygpIHtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBMYW1wOyIsImNvbnN0IFRyZWVTcHJpdGUgPSByZXF1aXJlKFwiLi90cmVlXCIpO1xyXG5jb25zdCBQb2xlU3ByaXRlID0gcmVxdWlyZShcIi4vcG9sZVwiKTtcclxuY29uc3QgQmVuY2hTcHJpdGUgPSByZXF1aXJlKFwiLi9iZW5jaFwiKTtcclxuY29uc3QgTGFtcFNwcml0ZSA9IHJlcXVpcmUoXCIuL2xhbXBcIik7XHJcblxyXG5jbGFzcyBQbGF0Zm9ybSBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5Db250YWluZXIge1xyXG4gICAgY29uc3RydWN0b3Ioc2NlbmUpIHtcclxuICAgICAgICBzdXBlcihzY2VuZSwgMCwgMCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIHRoaXMubGV2ZWwgPSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3RDb3VudDogTWF0aC5yb3VuZChzY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAvIDE4MCksXHJcbiAgICAgICAgICAgIGtlZXBSZXNwb25zZTogW10sXHJcbiAgICAgICAgICAgIGRhdGE6IFtdLFxyXG4gICAgICAgICAgICBjdXJyZW50OiAxLFxyXG4gICAgICAgICAgICBzY29yZTogMFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgdGhpcy5zY29wZSA9IHtcclxuICAgICAgICAgICAgYXZhaWxhYmxlOiBcInRocmVlXCIsXHJcbiAgICAgICAgICAgIG9uZToge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBcImFjdGl2ZVwiLFxyXG4gICAgICAgICAgICAgICAga2VlcDogMjAsXHJcbiAgICAgICAgICAgICAgICBlbDogdGhpcy5zY2VuZS5hZGQuY29udGFpbmVyKCh0aGlzLnNjZW5lLmdhbWUuY29uZmlnLndpZHRoICsgMTAwKSwgMClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdHdvOiB7XHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFwiYWN0aXZlXCIsXHJcbiAgICAgICAgICAgICAgICBrZWVwOiAyMCxcclxuICAgICAgICAgICAgICAgIGVsOiB0aGlzLnNjZW5lLmFkZC5jb250YWluZXIoKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAyKSArIDEwMCwgMClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgdGhyZWU6IHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogXCJwYXVzZVwiLFxyXG4gICAgICAgICAgICAgICAga2VlcDogMjAsXHJcbiAgICAgICAgICAgICAgICBlbDogdGhpcy5zY2VuZS5hZGQuY29udGFpbmVyKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGgsIDApXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmFyZWEodGhpcy5zY29wZS5vbmUuZWwsIDB4ZmYwMDAwKTtcclxuICAgICAgICB0aGlzLmFyZWEodGhpcy5zY29wZS50d28uZWwsIDB4MDBmZjAwKTtcclxuICAgICAgICB0aGlzLmFyZWEodGhpcy5zY29wZS50aHJlZS5lbCwgMHgwMDAwZmYpO1xyXG4gICAgICAgIHRoaXMuYWRkKFt0aGlzLnNjb3BlLm9uZS5lbCwgdGhpcy5zY29wZS50d28uZWwsIHRoaXMuc2NvcGUudGhyZWUuZWxdKS5zZXREZXB0aCgxMCk7XHJcbiAgICAgICAgLy8gc2V0IGxpbWl0XHJcbiAgICAgICAgdGhpcy5saW1pdCA9IHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAtMTtcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgLy8gaW5pdCBzdGFydCBjb250ZW50XHJcbiAgICAgICAgdGhpcy5hZGRDb250ZW50KHRoaXMuc2NvcGUub25lKTtcclxuICAgICAgICB0aGlzLmFkZENvbnRlbnQodGhpcy5zY29wZS50d28pO1xyXG4gICAgfVxyXG4gICAgaW5pdFJlcXVlc3QoKSB7XHJcbiAgICAgICAgdGhpcy5sZXZlbC5kYXRhID0gW107XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDE7IGkgPD0gdGhpcy5sZXZlbC5yZXF1ZXN0Q291bnQ7IGkrKykge1xyXG4gICAgICAgICAgICB0aGlzLmxldmVsLmRhdGEucHVzaCh0aGlzLmNyZWF0ZVJlcXVlc3QodGhpcy5sZXZlbC5jdXJyZW50LCAoaSA9PSB0aGlzLmxldmVsLnJlcXVlc3RDb3VudCA/IHRydWUgOiBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFt0cnVlLCBmYWxzZV0pKSkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sZXZlbC5jdXJyZW50ID4gKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDIgOiA0KSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnJ1blNwYWNlKFwibWlkXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5sZXZlbC5jdXJyZW50ID4gKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDUgOiA4KSkge1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnJ1blNwYWNlKFwibWF4XCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmxldmVsLmN1cnJlbnQrKztcclxuICAgIH1cclxuICAgIGNyZWF0ZVJlcXVlc3QobGV2ZWwsIGNyZWF0ZVJlc3BvbnNlID0gdHJ1ZSkge1xyXG4gICAgICAgIGxldCB3b3JsZExldmVsID0gTWF0aC5jZWlsKGxldmVsIC8gMyk7XHJcbiAgICAgICAgbGV0IHJlcXVlc3QgPSB7XHJcbiAgICAgICAgICAgIGNvdW50OiAwLFxyXG4gICAgICAgICAgICBsaWdodDogUGhhc2VyLk1hdGguQmV0d2VlbigwLCB3b3JsZExldmVsKSxcclxuICAgICAgICAgICAgcG9sZToge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiAoUGhhc2VyLk1hdGguQmV0d2VlbigxLCAxMikgPj0gOCA/IHRydWUgOiBmYWxzZSksXHJcbiAgICAgICAgICAgICAgICBtb3JlOiAwXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmIChyZXF1ZXN0LmxpZ2h0ID4gNCkge1xyXG4gICAgICAgICAgICByZXF1ZXN0LmxpZ2h0ID0gNDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHJlcXVlc3QucG9sZS5zdGF0dXMgJiYgKHJlcXVlc3QubGlnaHQgPiAwICYmIHJlcXVlc3QubGlnaHQgPD0gMikpIHtcclxuICAgICAgICAgICAgcmVxdWVzdC5wb2xlLm1vcmUgPSBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFstMSwgLTIsIDEsIDJdKTtcclxuICAgICAgICAgICAgaWYgKHJlcXVlc3QubGlnaHQgKyByZXF1ZXN0LnBvbGUubW9yZSA8IDApIHtcclxuICAgICAgICAgICAgICAgIHJlcXVlc3QucG9sZS5tb3JlID0gMDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXF1ZXN0LmNvdW50ID0gcmVxdWVzdC5saWdodCArIHJlcXVlc3QucG9sZS5tb3JlO1xyXG4gICAgICAgIGxldCBjdXJyZWN0ID0gW107XHJcbiAgICAgICAgbGV0IHdyb25nID0gW107XHJcbiAgICAgICAgaWYgKHRoaXMubGV2ZWwua2VlcFJlc3BvbnNlLmxlbmd0aCA+PSAyKSB7XHJcbiAgICAgICAgICAgIGNyZWF0ZVJlc3BvbnNlID0gdHJ1ZTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGNyZWF0ZVJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4IGluIHRoaXMubGV2ZWwua2VlcFJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgICAgICBjdXJyZWN0LnB1c2godGhpcy5sZXZlbC5rZWVwUmVzcG9uc2VbaW5kZXhdKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLmxldmVsLmtlZXBSZXNwb25zZSA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbmVlZExhbXAgPSByZXF1ZXN0LmNvdW50O1xyXG4gICAgICAgIHdoaWxlIChuZWVkTGFtcCA+IDApIHtcclxuICAgICAgICAgICAgbGV0IHNlbGVjdCA9IDE7XHJcbiAgICAgICAgICAgIGlmIChuZWVkTGFtcCA+IDEpIHtcclxuICAgICAgICAgICAgICAgIHNlbGVjdCA9IChyZXF1ZXN0LmxpZ2h0ID49IDIgPyAyIDogUGhhc2VyLlV0aWxzLkFycmF5LkdldFJhbmRvbShbMSwgMl0pKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjdXJyZWN0LnB1c2goc2VsZWN0KTtcclxuICAgICAgICAgICAgbmVlZExhbXAgLT0gc2VsZWN0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoIWNyZWF0ZVJlc3BvbnNlKSB7XHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4IGluIGN1cnJlY3QpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGV2ZWwua2VlcFJlc3BvbnNlLnB1c2goY3VycmVjdFtpbmRleF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlY3QgPSBbXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBjdXJyZWN0Lmxlbmd0aCAvIDI7IGkrKykge1xyXG4gICAgICAgICAgICB3cm9uZy5wdXNoKFBoYXNlci5NYXRoLkJldHdlZW4oMSwgMikpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4ge1xyXG4gICAgICAgICAgICByZXF1ZXN0LFxyXG4gICAgICAgICAgICBjdXJyZWN0LFxyXG4gICAgICAgICAgICB3cm9uZ1xyXG4gICAgICAgIH07XHJcbiAgICB9XHJcbiAgICBhZGRDb250ZW50KHNjb3BlKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmxldmVsLmRhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIHRoaXMuaW5pdFJlcXVlc3QoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IG1heFdpZHRoID0gc2NvcGUuZWwud2lkdGggKiAodGhpcy5zY2VuZS5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMC44IDogMC42KTtcclxuICAgICAgICBsZXQgY29udGFpbmVyID0gdGhpcy5zY2VuZS5hZGQuY29udGFpbmVyKDAsIDApO1xyXG4gICAgICAgIHNjb3BlLmVsLmFkZChjb250YWluZXIpO1xyXG4gICAgICAgIHdoaWxlIChzY29wZS5rZWVwIDw9IG1heFdpZHRoICYmIHRoaXMubGV2ZWwuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB0aGlzLmxldmVsLmRhdGEuc2hpZnQoKTtcclxuICAgICAgICAgICAgLy8gYWRkIHRyZWVcclxuICAgICAgICAgICAgbGV0IHRyZWVTcGFjZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMTAsIDMwKTtcclxuICAgICAgICAgICAgbGV0IHRyZWUgPSBuZXcgVHJlZVNwcml0ZSh0aGlzLnNjZW5lLCBQaGFzZXIuTWF0aC5CZXR3ZWVuKDEsIDYpLCBkYXRhLnJlcXVlc3QubGlnaHQpLnNob3coKS5zZXRYKHNjb3BlLmtlZXAgKyB0cmVlU3BhY2UpO1xyXG4gICAgICAgICAgICBzY29wZS5rZWVwICs9IHRyZWUud2lkdGggKyB0cmVlU3BhY2U7XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGQodHJlZSk7XHJcbiAgICAgICAgICAgIGlmICghZGF0YS5yZXF1ZXN0LnBvbGUuc3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBhZGQgYmVuY2hcclxuICAgICAgICAgICAgICAgIGlmIChQaGFzZXIuTWF0aC5CZXR3ZWVuKDEsIDIpID09IDIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYmVuY2hTcGFjZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMTAsIDIwKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgYmVuY2ggPSBuZXcgQmVuY2hTcHJpdGUodGhpcy5zY2VuZSkuc2hvdygpLnNldFgoc2NvcGUua2VlcCArIGJlbmNoU3BhY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmtlZXAgKz0gYmVuY2guZGlzcGxheVdpZHRoICsgYmVuY2hTcGFjZTtcclxuICAgICAgICAgICAgICAgICAgICBjb250YWluZXIuYWRkKGJlbmNoKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIC8vIGFkZCBwb2xlXHJcbiAgICAgICAgICAgICAgICBsZXQgcG9sZVNwYWNlID0gUGhhc2VyLk1hdGguQmV0d2Vlbig1LCAxNSk7XHJcbiAgICAgICAgICAgICAgICBsZXQgcG9sZSA9IG5ldyBQb2xlU3ByaXRlKHRoaXMuc2NlbmUsIGRhdGEucmVxdWVzdC5wb2xlLm1vcmUpLnNob3coKS5zZXRYKHNjb3BlLmtlZXAgKyBwb2xlU3BhY2UpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUua2VlcCArPSBwb2xlLmRpc3BsYXlXaWR0aCArIHBvbGVTcGFjZTtcclxuICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGQocG9sZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGxhbXBzID0gW107XHJcbiAgICAgICAgICAgIC8vIGFkZCBjdXJyZWN0IGxhbXBzXHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4IGluIGRhdGEuY3VycmVjdCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGxhbXBTcGFjZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMTAsIDIwKTtcclxuICAgICAgICAgICAgICAgIGxldCBsYW1wSXRlbSA9IG5ldyBMYW1wU3ByaXRlKHRoaXMuc2NlbmUsIGRhdGEuY3VycmVjdFtpbmRleF0sIFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oW2ZhbHNlLCB0cnVlXSksIHRydWUpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNob3coKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRGbGlwWCgoZGF0YS5jdXJyZWN0W2luZGV4XSA9PSAxID8gUGhhc2VyLlV0aWxzLkFycmF5LkdldFJhbmRvbShbZmFsc2UsIHRydWVdKSA6IGZhbHNlKSlcclxuICAgICAgICAgICAgICAgICAgICAuc2V0WChzY29wZS5rZWVwICsgbGFtcFNwYWNlKTtcclxuICAgICAgICAgICAgICAgIHNjb3BlLmtlZXAgKz0gbGFtcEl0ZW0uZGlzcGxheVdpZHRoICsgbGFtcFNwYWNlO1xyXG4gICAgICAgICAgICAgICAgbGFtcHMucHVzaChsYW1wSXRlbSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gYWRkIHdyb25nIGxhbXBzXHJcbiAgICAgICAgICAgIGZvciAobGV0IGluZGV4IGluIGRhdGEud3JvbmcpIHtcclxuICAgICAgICAgICAgICAgIGlmIChzY29wZS5rZWVwIDw9IG1heFdpZHRoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGxhbXBTcGFjZSA9IFBoYXNlci5NYXRoLkJldHdlZW4oMTAsIDIwKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGFtcEl0ZW0gPSBuZXcgTGFtcFNwcml0ZSh0aGlzLnNjZW5lLCBkYXRhLndyb25nW2luZGV4XSwgUGhhc2VyLlV0aWxzLkFycmF5LkdldFJhbmRvbShbZmFsc2UsIHRydWVdKSwgZmFsc2UpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zaG93KClcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNldEZsaXBYKChkYXRhLmN1cnJlY3RbaW5kZXhdID09IDEgPyBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFtmYWxzZSwgdHJ1ZV0pIDogZmFsc2UpKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0WChzY29wZS5rZWVwICsgbGFtcFNwYWNlKTtcclxuICAgICAgICAgICAgICAgICAgICBzY29wZS5rZWVwICs9IGxhbXBJdGVtLmRpc3BsYXlXaWR0aCArIGxhbXBTcGFjZTtcclxuICAgICAgICAgICAgICAgICAgICBsYW1wcy5wdXNoKGxhbXBJdGVtKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBjb250YWluZXIuYWRkKGxhbXBzKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgY29udGFpbmVyLnggPSAoKHNjb3BlLmVsLndpZHRoIC0gc2NvcGUua2VlcCkgLyAyKTtcclxuICAgIH1cclxuICAgIHJlbW92ZUNvbnRlbnQoc2NvcGUpIHtcclxuICAgICAgICBzY29wZS5zdGF0dXMgPSBcInBhdXNlXCI7XHJcbiAgICAgICAgbGV0IGdhbWVPdmVyID0gZmFsc2U7XHJcbiAgICAgICAgc2NvcGUuZWwubGFzdC5lYWNoKChjaGlsZCkgPT4ge1xyXG4gICAgICAgICAgICBjaGlsZC5zZXRBbHBoYSgwLjMpO1xyXG4gICAgICAgICAgICBpZiAoY2hpbGQuZ2FtZUNoZWNrKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoY2hpbGQuaXNDdXJyZWN0ICE9IGNoaWxkLmxpZ2h0U3RhdHVzKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2hpbGQuc2V0QWxwaGEoMSkuc2V0VGludEZpbGwoMHhmZjAwMDAsIDB4MDAwMDAwKTtcclxuICAgICAgICAgICAgICAgICAgICBnYW1lT3ZlciA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAoZ2FtZU92ZXIpIHtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS5wYXVzZVNwYWNlKCk7XHJcblxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZS5vbmUuc3RhdHVzID09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5zY29wZS5vbmUuZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAqIDEuMixcclxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogODAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IFBoYXNlci5NYXRoLkVhc2luZy5CYWNrLkluXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZS50d28uc3RhdHVzID09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy5zY29wZS50d28uZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAqIDEuMixcclxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogODAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IFBoYXNlci5NYXRoLkVhc2luZy5CYWNrLkluXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZS50aHJlZS5zdGF0dXMgPT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnNjb3BlLnRocmVlLmVsLFxyXG4gICAgICAgICAgICAgICAgICAgIHg6IHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKiAxLjIsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDgwMCxcclxuICAgICAgICAgICAgICAgICAgICBlYXNlOiBQaGFzZXIuTWF0aC5FYXNpbmcuQmFjay5JblxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zY2VuZS50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgIHRhcmdldHM6IHNjb3BlLmVsLFxyXG4gICAgICAgICAgICAgICAgeDogMCxcclxuICAgICAgICAgICAgICAgIGRlbGF5OiA4MDAsXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogODAwLFxyXG4gICAgICAgICAgICAgICAgZWFzZTogUGhhc2VyLk1hdGguRWFzaW5nLkJhY2suT3V0XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnRpbWUuYWRkRXZlbnQoe1xyXG4gICAgICAgICAgICAgICAgZGVsYXk6IDEwMDAsXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUudGl0bGUuc2V0VGV4dChcIkdhbWUgT3ZlclwiKS5zZXREZXB0aCgyMCkuc2V0VGludEZpbGwoMHhmZjAwMDAsIDB4MDAwMDAwKTtcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFja1Njb3BlOiB0aGlzLnNjZW5lXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnRpbWUuYWRkRXZlbnQoe1xyXG4gICAgICAgICAgICAgICAgZGVsYXk6IDYwMDAsXHJcbiAgICAgICAgICAgICAgICBjYWxsYmFjazogKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuc2NlbmUuc3RhcnQoXCJCb290XCIpO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrU2NvcGU6IHRoaXMuc2NlbmVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgc2NvcGUuZWwueCA9IE1hdGguYWJzKHRoaXMubGltaXQpO1xyXG4gICAgICAgICAgICBzY29wZS5lbC5yZW1vdmVBbGwodHJ1ZSk7XHJcbiAgICAgICAgICAgIHNjb3BlLmtlZXAgPSAyMDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBydW4oc3BlZWQgPSAwKSB7XHJcbiAgICAgICAgaWYgKHNwZWVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGV2ZWwuc2NvcmUgKz0gc3BlZWQ7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLm9uZS5zdGF0dXMgPT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY29wZS5vbmUuZWwueCAtPSBzcGVlZDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLm9uZS5lbC54IDw9IHRoaXMubGltaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLmF2YWlsYWJsZSA9IFwib25lXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS50aHJlZS5zdGF0dXMgPSBcImFjdGl2ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ29udGVudCh0aGlzLnNjb3BlLm9uZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250ZW50KHRoaXMuc2NvcGUudGhyZWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLnR3by5zdGF0dXMgPT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY29wZS50d28uZWwueCAtPSBzcGVlZDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLnR3by5lbC54IDw9IHRoaXMubGltaXQpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLmF2YWlsYWJsZSA9IFwidHdvXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS5vbmUuc3RhdHVzID0gXCJhY3RpdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNvbnRlbnQodGhpcy5zY29wZS50d28pO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGVudCh0aGlzLnNjb3BlLm9uZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUudGhyZWUuc3RhdHVzID09IFwiYWN0aXZlXCIpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUudGhyZWUuZWwueCAtPSBzcGVlZDtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLnRocmVlLmVsLnggPD0gdGhpcy5saW1pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUuYXZhaWxhYmxlID0gXCJ0aHJlZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUudHdvLnN0YXR1cyA9IFwiYWN0aXZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDb250ZW50KHRoaXMuc2NvcGUudGhyZWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuYWRkQ29udGVudCh0aGlzLnNjb3BlLnR3byk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdGhpcy5zY2VuZS50aXRsZS5zZXRUZXh0KE1hdGgucm91bmQodGhpcy5sZXZlbC5zY29yZSAvIDEwKS50b1N0cmluZygpLnBhZFN0YXJ0KDUsIFwiMFwiKSk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgYXJlYShzY29wZSwgY29sb3IpIHtcclxuICAgICAgICBzY29wZS5zZXRTaXplKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggLSA0MCwgKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44KSAtIDQwKVxyXG4gICAgICAgIGlmIChmYWxzZSkge1xyXG4gICAgICAgICAgICBsZXQgYXJlYVN0YXJ0ID0gdGhpcy5zY2VuZS5hZGQuZ3JhcGhpY3MoMCwgMClcclxuICAgICAgICAgICAgICAgIC5maWxsU3R5bGUoY29sb3IsIDAuNSlcclxuICAgICAgICAgICAgICAgIC5maWxsUmVjdCgxMCwgMTAsIDIsIHNjb3BlLmhlaWdodCArIDIwKTtcclxuICAgICAgICAgICAgbGV0IGFyZWFFbmQgPSB0aGlzLnNjZW5lLmFkZC5ncmFwaGljcygwLCAwKVxyXG4gICAgICAgICAgICAgICAgLmZpbGxTdHlsZShjb2xvciwgMC41KVxyXG4gICAgICAgICAgICAgICAgLmZpbGxSZWN0KHNjb3BlLndpZHRoICsgMjAsIDEwLCAyLCBzY29wZS5oZWlnaHQgKyAyMCk7XHJcbiAgICAgICAgICAgIHNjb3BlLmFkZChbYXJlYVN0YXJ0LCBhcmVhRW5kXSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFBsYXRmb3JtOyIsImNsYXNzIFBvbGUgZXh0ZW5kcyBQaGFzZXIuR2FtZU9iamVjdHMuU3ByaXRlIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCB0eXBlID0gXCIwXCIpIHtcclxuICAgICAgICBsZXQgcG9sZVR5cGUgPSB7XHJcbiAgICAgICAgICAgIFwiLTJcIjogXCItMlwiLFxyXG4gICAgICAgICAgICBcIi0xXCI6IFwiLTFcIixcclxuICAgICAgICAgICAgXCIwXCI6IFwiXCIsXHJcbiAgICAgICAgICAgIFwiMVwiOiBcIisxXCIsXHJcbiAgICAgICAgICAgIFwiMlwiOiBcIisyXCJcclxuICAgICAgICB9O1xyXG4gICAgICAgIHN1cGVyKHNjZW5lLCAwLCBzY2VuZS5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgsIGBwb2xlJHtwb2xlVHlwZVt0eXBlXX1gKTtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgdGhpcy5zZXRPcmlnaW4oMCwgMC45NylcclxuICAgICAgICAgICAgLnNldFNjYWxlKCh0aGlzLnNjZW5lLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyAwLjggOiAwLjYpKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoNCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUG9sZTsiLCJjbGFzcyBUcmVlIGV4dGVuZHMgUGhhc2VyLkdhbWVPYmplY3RzLkNvbnRhaW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSwgdHlwZSA9IFwiMVwiLCBsaWdodENvdW50ID0gMCkge1xyXG4gICAgICAgIHN1cGVyKHNjZW5lLCAwLCBzY2VuZS5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgpO1xyXG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuICAgICAgICBsZXQgdHJlZSA9IHRoaXMuc2NlbmUuYWRkLnNwcml0ZSgwLCAwLCBgdHJlZSR7dHlwZX1gKVxyXG4gICAgICAgICAgICAuc2V0U2NhbGUoKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDAuNyA6IDAuNSkpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMC45MSk7XHJcbiAgICAgICAgdGhpcy5hZGQodHJlZSk7XHJcbiAgICAgICAgaWYgKGxpZ2h0Q291bnQgPCAwIHx8IGxpZ2h0Q291bnQgPiA0KSB7XHJcbiAgICAgICAgICAgIGxpZ2h0Q291bnQgPSAwO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAobGlnaHRDb3VudCkge1xyXG4gICAgICAgICAgICBsZXQgY291bnQgPSB7XHJcbiAgICAgICAgICAgICAgICB3OiAyMDAsXHJcbiAgICAgICAgICAgICAgICBoOiAyMzBcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICAgICAgc3dpdGNoIChsaWdodENvdW50KSB7XHJcbiAgICAgICAgICAgICAgICBjYXNlIDI6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC53ICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIDM6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC53ICo9IDM7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYXNlIDQ6IHtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC53ICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgY291bnQuaCAqPSAyO1xyXG4gICAgICAgICAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGxldCBsaWdodCA9IHRoaXMuc2NlbmUuYWRkLnRpbGVTcHJpdGUodHJlZS5kaXNwbGF5V2lkdGggLyAyLCAodHJlZS5kaXNwbGF5SGVpZ2h0ICogLTEpLCBjb3VudC53LCBjb3VudC5oLCBcImxpZ2h0XCIpXHJcbiAgICAgICAgICAgICAgICAuc2V0U2NhbGUoMC4xMylcclxuICAgICAgICAgICAgICAgIC5zZXRPcmlnaW4oMC41LCAxKTtcclxuICAgICAgICAgICAgdGhpcy5hZGQobGlnaHQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLnNldERlcHRoKDQpLnNldFNpemUodHJlZS5kaXNwbGF5V2lkdGgsIHRyZWUuZGlzcGxheUhlaWdodCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gVHJlZTsiLCJjb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoXCIuL2dhbWVPYmplY3QvcGxhdGZvcm1cIik7XHJcblxyXG5jbGFzcyBTY2VuZSBleHRlbmRzIFBoYXNlci5TY2VuZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihuYW1lKSB7XHJcbiAgICAgICAgc3VwZXIobmFtZSk7XHJcbiAgICAgICAgdGhpcy5uYW1lID0gbmFtZTtcclxuICAgICAgICB0aGlzLmtlZXBMb2cgPSBbXTtcclxuICAgICAgICB0aGlzLmxvY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaGVscE9wZW4gPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGxvZyhtZXNzYWdlID0gbnVsbCwgc3lzdGVtID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAodGhpcy5nYW1lLmRlYnVnICYmIG1lc3NhZ2UpIHtcclxuICAgICAgICAgICAgdGhpcy5rZWVwTG9nLnB1c2goe1xyXG4gICAgICAgICAgICAgICAgbWVzc2FnZSxcclxuICAgICAgICAgICAgICAgIGJ5U3lzdGVtOiBzeXN0ZW1cclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmtlZXBMb2c7XHJcbiAgICB9XHJcbiAgICBpbml0KCkge1xyXG4gICAgICAgIHRoaXMubG9nKFwiaW5pdFwiLCB0cnVlKTtcclxuICAgIH1cclxuICAgIHByZWxvYWQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJwcmVsb2FkXCIsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlKCkge1xyXG4gICAgICAgIC8vIGFkZCBncm91bmRcclxuICAgICAgICB0aGlzLmdyb3VuZCA9IHRoaXMuYWRkLnRpbGVTcHJpdGUoLTIsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICsgMiwgdGhpcy5nYW1lLmNvbmZpZy53aWR0aCArIDQsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC4yLCBcImdyb3VuZFwiKVxyXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDAsIDEpXHJcbiAgICAgICAgICAgIC5zZXRUaWxlU2NhbGUoKHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDEgOiAwLjYpKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoMCk7XHJcbiAgICAgICAgdGhpcy5ncm91bmQuc3BlZWQgPSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQ6IDAsXHJcbiAgICAgICAgICAgIHBhdXNlOiAwLFxyXG4gICAgICAgICAgICBtaW46ICh0aGlzLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyAyLjUgOiAyKSxcclxuICAgICAgICAgICAgbWlkOiAodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMy41IDogMyksXHJcbiAgICAgICAgICAgIG1heDogKHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDQuNSA6IDQpLFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gYWRkIGNpdHlcclxuICAgICAgICB0aGlzLmNpdHkgPSB0aGlzLmFkZC50aWxlU3ByaXRlKDAsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44LCB0aGlzLmdhbWUuY29uZmlnLndpZHRoLCAxMDksIFwiY2l0eVwiKVxyXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDAsIDEpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCgxKTtcclxuICAgICAgICB0aGlzLmNpdHkuc3BlZWQgPSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnQ6IDAsXHJcbiAgICAgICAgICAgIHBhdXNlOiAwLFxyXG4gICAgICAgICAgICBtaW46IDAuMixcclxuICAgICAgICAgICAgbWlkOiAwLjQsXHJcbiAgICAgICAgICAgIG1heDogMC42XHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLmxpbmUgPSB0aGlzLmFkZC5ncmFwaGljcygwLCAwKVxyXG4gICAgICAgICAgICAuZmlsbFN0eWxlKDB4ZjRkMjQyLCAxKVxyXG4gICAgICAgICAgICAuZmlsbFJlY3QoMCwgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44KSwgdGhpcy5nYW1lLmNvbmZpZy53aWR0aCwgMylcclxuICAgICAgICAgICAgLnNldERlcHRoKDEpO1xyXG4gICAgICAgIC8vIGFkZCBjbG91ZFxyXG4gICAgICAgIHRoaXMuY2xvdWQgPSB0aGlzLmFkZC50aWxlU3ByaXRlKDAsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC42LCB0aGlzLmdhbWUuY29uZmlnLndpZHRoLCAxMDUsIFwiY2xvdWRcIilcclxuICAgICAgICAgICAgLnNldE9yaWdpbigwLCAxKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoMik7XHJcbiAgICAgICAgdGhpcy5jbG91ZC5zcGVlZCA9IHtcclxuICAgICAgICAgICAgY3VycmVudDogMCxcclxuICAgICAgICAgICAgcGF1c2U6IDAsXHJcbiAgICAgICAgICAgIG1pbjogLTAuNCxcclxuICAgICAgICAgICAgbWlkOiAtMC42LFxyXG4gICAgICAgICAgICBtYXg6IC0wLjhcclxuICAgICAgICB9O1xyXG4gICAgICAgIC8vIGxvYWQgcGxhdGZvcm1cclxuICAgICAgICB0aGlzLnRpdGxlID0gdGhpcy5hZGQudGV4dCh0aGlzLmdhbWUuY29uZmlnLndpZHRoICogMC41LCB0aGlzLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuMTUsIFwiXCIsIHtcclxuICAgICAgICAgICAgZm9udDogYCR7KHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IFwiMTYwXCIgOiBcIjEwMFwiKX1weCAnJHt0aGlzLmdhbWUuZm9udH0nYCxcclxuICAgICAgICAgICAgZmlsbDogXCIjRkZGOEVFXCJcclxuICAgICAgICB9KS5zZXRPcmlnaW4oMC41KTtcclxuICAgICAgICAvLyBhZGQgaGVscFxyXG4gICAgICAgIHRoaXMuaGVscEJ0biA9IHRoaXMuYWRkLnRleHQoMjUsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0IC0gMjAsIFwiP1wiLCB7XHJcbiAgICAgICAgICAgIGZvbnQ6IGAkeyh0aGlzLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyBcIjQwXCIgOiBcIjMwXCIpfXB4ICcke3RoaXMuZ2FtZS5mb250fSdgLFxyXG4gICAgICAgICAgICBmaWxsOiBcIiNGRkY4RUVcIlxyXG4gICAgICAgIH0pLnNldE9yaWdpbigwLCAxKVxyXG4gICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUoKVxyXG4gICAgICAgICAgICAub24oXCJwb2ludGVyZG93blwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICBpZiAoIXRoaXMuaGVscE9wZW4pIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnN0YXJ0KFwiSGVscFwiKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5zdGFydChcIkJvb3RcIik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0sIHRoaXMpO1xyXG4gICAgICAgIC8vIGFkZCBmdWxsc2NyZWVuXHJcbiAgICAgICAgdGhpcy5mdWxsc2NyZWVuQnRuID0gdGhpcy5hZGQudGV4dCh0aGlzLmdhbWUuY29uZmlnLndpZHRoIC0gMjUsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0IC0gMjAsIFwi4o6aXCIsIHtcclxuICAgICAgICAgICAgZm9udDogYCR7KHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IFwiNDBcIiA6IFwiMzBcIil9cHggJyR7dGhpcy5nYW1lLmZvbnR9J2AsXHJcbiAgICAgICAgICAgIGZpbGw6IFwiI0ZGRjhFRVwiXHJcbiAgICAgICAgfSkuc2V0T3JpZ2luKDEsIDEpXHJcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSgpXHJcbiAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aGlzLnNjYWxlLmlzRnVsbHNjcmVlbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NhbGUuc3RvcEZ1bGxzY3JlZW4oKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZS5zdGFydEZ1bGxzY3JlZW4oKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcyk7XHJcbiAgICAgICAgLy8gZW5kIG9mIHNjZW5lXHJcbiAgICAgICAgdGhpcy5sb2coXCJjcmVhdGVcIiwgdHJ1ZSk7XHJcbiAgICAgICAgdGhpcy5nYW1lLnNjZW5lTG9nKHRoaXMubmFtZSwgdGhpcy5rZWVwTG9nKTtcclxuICAgIH1cclxuICAgIHVwZGF0ZSgpIHtcclxuICAgICAgICBpZiAodGhpcy5sb2NrKSByZXR1cm47XHJcbiAgICAgICAgaWYgKHRoaXMuZ3JvdW5kLnNwZWVkLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5wbGF0Zm9ybS5ydW4odGhpcy5ncm91bmQuc3BlZWQuY3VycmVudCk7XHJcbiAgICAgICAgICAgIHRoaXMuZ3JvdW5kLnRpbGVQb3NpdGlvblggKz0gKHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IHRoaXMuZ3JvdW5kLnNwZWVkLmN1cnJlbnQgOiB0aGlzLmdyb3VuZC5zcGVlZC5jdXJyZW50ICogMS42KTtcclxuICAgICAgICAgICAgaWYgKHRoaXMuY2l0eS5zcGVlZC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNpdHkudGlsZVBvc2l0aW9uWCArPSB0aGlzLmNpdHkuc3BlZWQuY3VycmVudDtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5jbG91ZC5zcGVlZC5jdXJyZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuY2xvdWQudGlsZVBvc2l0aW9uWCArPSB0aGlzLmNsb3VkLnNwZWVkLmN1cnJlbnQ7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IFNjZW5lOyIsImNvbnN0IFNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lXCIpO1xyXG5cclxuY2xhc3MgQm9vdCBleHRlbmRzIFNjZW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKFwiQm9vdFwiKTtcclxuICAgIH1cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgc3VwZXIuaW5pdCgpO1xyXG4gICAgfVxyXG4gICAgcHJlbG9hZCgpIHtcclxuICAgICAgICBzdXBlci5wcmVsb2FkKCk7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiZ3JvdW5kXCIsIFwiZGF0YS9ncm91bmQucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImNpdHlcIiwgXCJkYXRhL2NpdHkucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImNsb3VkXCIsIFwiZGF0YS9jbG91ZC5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicGxheVwiLCBcImRhdGEvcGxheS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiaGVscFwiLCBcImRhdGEvaGVscC5wbmdcIik7XHJcbiAgICAgICAgLy9cclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJ0cmVlMVwiLCBcImRhdGEvdHJlZTEucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInRyZWUyXCIsIFwiZGF0YS90cmVlMi5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwidHJlZTNcIiwgXCJkYXRhL3RyZWUzLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJ0cmVlNFwiLCBcImRhdGEvdHJlZTQucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInRyZWU1XCIsIFwiZGF0YS90cmVlNS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwidHJlZTZcIiwgXCJkYXRhL3RyZWU2LnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImxpZ2h0XCIsIFwiZGF0YS9saWdodC5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiYmVuY2hcIiwgXCJkYXRhL2JlbmNoLnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGVcIiwgXCJkYXRhL3BvbGUucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGUtMVwiLCBcImRhdGEvcG9sZS0xLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJwb2xlLTJcIiwgXCJkYXRhL3BvbGUtMi5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicG9sZSsxXCIsIFwiZGF0YS9wb2xlKzEucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGUrMlwiLCBcImRhdGEvcG9sZSsyLnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImxhbXAtMS1vblwiLCBcImRhdGEvbGFtcC0xLW9uLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJsYW1wLTEtb2ZmXCIsIFwiZGF0YS9sYW1wLTEtb2ZmLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJsYW1wLTItb25cIiwgXCJkYXRhL2xhbXAtMi1vbi5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwibGFtcC0yLW9mZlwiLCBcImRhdGEvbGFtcC0yLW9mZi5wbmdcIik7XHJcbiAgICB9XHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgc3VwZXIuY3JlYXRlKCk7XHJcbiAgICAgICAgdGhpcy5oZWxwT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIGlmICh0aGlzLmdhbWUuY29uZmlnLmhlaWdodCA+IHRoaXMuZ2FtZS5jb25maWcud2lkdGgpIHtcclxuICAgICAgICAgICAgdGhpcy50aXRsZS5zZXRUZXh0KFwiUm90YXRlIVwiKVxyXG4gICAgICAgICAgICAgICAgLnNldERlcHRoKDIwKVxyXG4gICAgICAgICAgICAgICAgLnNldFRpbnRGaWxsKDB4ZmYwMDAwLCAweDAwMDAwMClcclxuICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLmdhbWUuY29uZmlnLndpZHRoIC8gMiwgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44KSAvIDIpO1xyXG4gICAgICAgICAgICB0aGlzLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy50aXRsZSxcclxuICAgICAgICAgICAgICAgIHNjYWxlOiB7IGZyb206IDAuOTUsIHRvOiAxLjA1IH0sXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwLFxyXG4gICAgICAgICAgICAgICAgeW95bzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHJlcGVhdDogLTFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5jb25maWcud2lkdGggPCA0ODAgfHwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgPCAzMjApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGl0bGUuc2V0VGV4dChcIlNjcmVlbiFcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0RGVwdGgoMjApXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFRpbnRGaWxsKDB4ZmYwMDAwLCAweDAwMDAwMClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy5nYW1lLmNvbmZpZy53aWR0aCAvIDIsICh0aGlzLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCkgLyAyKTtcclxuICAgICAgICAgICAgICAgIHRoaXMudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy50aXRsZSxcclxuICAgICAgICAgICAgICAgICAgICBzY2FsZTogeyBmcm9tOiAwLjk1LCB0bzogMS4wNSB9LFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgeW95bzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQ6IC0xXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGl0bGUuc2V0VGV4dChcIkxpZ2h0IFRyZWVcIikuc2V0VGludEZpbGwoMHhmNGQyNDIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5idG4gPSB0aGlzLmFkZC5zcHJpdGUoMCwgMCwgXCJwbGF5XCIpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldE9yaWdpbigwLjUpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMuZ2FtZS5jb25maWcud2lkdGggLyAyLCAodGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgLyAyKSArICh0aGlzLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuMSkpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldERlcHRoKDEwKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgwLjMpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKClcclxuICAgICAgICAgICAgICAgICAgICAub24oXCJwb2ludGVyZG93blwiLCAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuc3RhcnQoXCJQbGF5XCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIHRoaXMpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLmJ0bixcclxuICAgICAgICAgICAgICAgICAgICB4OiB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZyb206IHRoaXMuZ2FtZS5jb25maWcud2lkdGggKiAwLjQ5NyxcclxuICAgICAgICAgICAgICAgICAgICAgICAgdG86IHRoaXMuZ2FtZS5jb25maWcud2lkdGggKiAwLjUwM1xyXG4gICAgICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDMwMCxcclxuICAgICAgICAgICAgICAgICAgICB5b3lvOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdDogLTFcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEJvb3Q7IiwiY29uc3QgU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmVcIik7XHJcblxyXG5jbGFzcyBIZWxwIGV4dGVuZHMgU2NlbmUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJIZWxwXCIpO1xyXG4gICAgfVxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBzdXBlci5pbml0KCk7XHJcbiAgICB9XHJcbiAgICBwcmVsb2FkKCkge1xyXG4gICAgICAgIHN1cGVyLnByZWxvYWQoKTtcclxuXHJcbiAgICB9XHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgc3VwZXIuY3JlYXRlKCk7XHJcbiAgICAgICAgLy8gaGlkZSBib290IHNjZW5lIG9iamVjdFxyXG4gICAgICAgIHRoaXMuZ3JvdW5kLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuY2l0eS5zZXRWaXNpYmxlKGZhbHNlKTtcclxuICAgICAgICB0aGlzLmNsb3VkLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMubGluZS5zZXRWaXNpYmxlKGZhbHNlKTtcclxuICAgICAgICB0aGlzLmZ1bGxzY3JlZW5CdG4uc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgLy8gYWRkIGhlbHAgaW1hZ2VcclxuICAgICAgICB0aGlzLmhlbHBJbWFnZSA9IHRoaXMuYWRkLmltYWdlKDAsIDAsIFwiaGVscFwiKVxyXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDAuNSlcclxuICAgICAgICAgICAgLnNldFNjYWxlKCh0aGlzLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyAwLjYgOiAwLjQpKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoNSlcclxuICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMuZ2FtZS5jb25maWcud2lkdGggLyAyLCB0aGlzLmdhbWUuY29uZmlnLmhlaWdodCAvIDIpXHJcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSgpXHJcbiAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuc3RhcnQoXCJCb290XCIpO1xyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICB0aGlzLmhlbHBPcGVuID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmhlbHBCdG4uc2V0VGV4dChcIsKrXCIpLnNldFRpbnRGaWxsKDB4MDAwMDAwKTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBIZWxwOyIsImNvbnN0IFNjZW5lID0gcmVxdWlyZShcIi4uL3NjZW5lXCIpO1xyXG5jb25zdCBQbGF0Zm9ybSA9IHJlcXVpcmUoXCIuLi9nYW1lT2JqZWN0L3BsYXRmb3JtXCIpO1xyXG5cclxuY2xhc3MgUGxheSBleHRlbmRzIFNjZW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKCkge1xyXG4gICAgICAgIHN1cGVyKFwiUGxheVwiKTtcclxuICAgICAgICB0aGlzLmxvY2sgPSBmYWxzZTtcclxuICAgIH1cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgc3VwZXIuaW5pdCgpO1xyXG4gICAgfVxyXG4gICAgcHJlbG9hZCgpIHtcclxuICAgICAgICBzdXBlci5wcmVsb2FkKCk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgc3VwZXIuY3JlYXRlKCk7XHJcbiAgICAgICAgdGhpcy5sb2NrID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5oZWxwT3BlbiA9IGZhbHNlO1xyXG4gICAgICAgIHRoaXMucGxhdGZvcm0gPSBuZXcgUGxhdGZvcm0odGhpcyk7XHJcbiAgICAgICAgaWYgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ID4gdGhpcy5nYW1lLmNvbmZpZy53aWR0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnRpdGxlLnNldFRleHQoXCJSb3RhdGUhXCIpO1xyXG4gICAgICAgICAgICB0aGlzLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0czogdGhpcy50aXRsZSxcclxuICAgICAgICAgICAgICAgIGFuZ2xlOiB7IGZyb206IC01LCB0bzogNSB9LFxyXG4gICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MCxcclxuICAgICAgICAgICAgICAgIHlveW86IHRydWUsXHJcbiAgICAgICAgICAgICAgICByZXBlYXQ6IC0xXHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLmdhbWUuY29uZmlnLndpZHRoIDwgNDgwIHx8IHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0IDwgMzIwKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnRpdGxlLnNldFRleHQoXCJTY3JlZW4hXCIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHk6IDUwLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgeW95bzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgICAgICByZXBlYXQ6IC0xXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgIHRoaXMucGxhdGZvcm0uc2hvdygpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5ydW5TcGFjZSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcnVuU3BhY2Uoc3BlZWQgPSBcIm1pblwiLCBvYmplY3QgPSBbXSkge1xyXG4gICAgICAgIGlmICghb2JqZWN0Lmxlbmd0aCkge1xyXG4gICAgICAgICAgICBvYmplY3QgPSBbXCJncm91bmRcIiwgXCJjaXR5XCIsIFwiY2xvdWRcIl07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAobGV0IGluZGV4IGluIG9iamVjdCkge1xyXG4gICAgICAgICAgICB0aGlzW29iamVjdFtpbmRleF1dLnNwZWVkLmN1cnJlbnQgPSB0aGlzW29iamVjdFtpbmRleF1dLnNwZWVkW3NwZWVkXTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBwYXVzZVNwYWNlKCkge1xyXG4gICAgICAgIHRoaXMubG9jayA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5ncm91bmQuc3BlZWQuY3VycmVudCA9IHRoaXMuZ3JvdW5kLnNwZWVkLnBhdXNlO1xyXG4gICAgICAgIHRoaXMuY2l0eS5zcGVlZC5jdXJyZW50ID0gdGhpcy5jaXR5LnNwZWVkLnBhdXNlO1xyXG4gICAgICAgIHRoaXMuY2xvdWQuc3BlZWQuY3VycmVudCA9IHRoaXMuY2xvdWQuc3BlZWQucGF1c2U7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUGxheTsiXX0="}