{"version":3,"sources":["node_modules/browser-pack/_prelude.js","src/action.js","src/lib/game.js","src/lib/gameObject/bench.js","src/lib/gameObject/lamp.js","src/lib/gameObject/platform.js","src/lib/gameObject/pole.js","src/lib/gameObject/tree.js","src/lib/scene.js","src/lib/scene/boot.js","src/lib/scene/help.js","src/lib/scene/play.js"],"names":[],"mappings":"AAAA;ACAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACZA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC7DA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AChBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACxBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9RA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACvBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AC9CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AClHA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;ACpCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"action.js","sourcesContent":["(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c=\"function\"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error(\"Cannot find module '\"+i+\"'\");throw a.code=\"MODULE_NOT_FOUND\",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u=\"function\"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()","const debug = \"@@debug\";\r\nconst fontFamily = \"Cute Font\";\r\nconst Game = require(\"./lib/game\");\r\n\r\nWebFont.load({\r\n    google: {\r\n        families: [fontFamily]\r\n    },\r\n    active() {\r\n        const gameObject = new Game(fontFamily, debug);\r\n    }\r\n});\r\n","// load scenes\r\nconst BootScene = require(\"./scene/boot\");\r\nconst HelpScene = require(\"./scene/help\");\r\nconst PlayScene = require(\"./scene/play\");\r\n\r\nclass Game extends Phaser.Game {\r\n    constructor(font, debug = false) {\r\n        if (debug) {\r\n            console.time(\"Game\");\r\n        }\r\n        super({\r\n            renderer: Phaser.AUTO,\r\n            antialias: true,\r\n            backgroundColor: \"#fcf1de\",\r\n            pixelArt: false,\r\n            roundPixels: true,\r\n            autoCenter: true,\r\n            banner: debug,\r\n            disableContextMenu: !debug,\r\n            scale: {\r\n                mode: Phaser.Scale.RESIZE,\r\n                parent: \"game\",\r\n                width: window.innerWidth,\r\n                height: window.innerHeight\r\n            },\r\n            scene: [\r\n                BootScene,\r\n                HelpScene,\r\n                PlayScene\r\n            ]\r\n        });\r\n        this.font = font;\r\n        this.debug = debug;\r\n    }\r\n    start() {\r\n        super.start();\r\n        document.querySelector(\"#game canvas\").style.opacity = 1;\r\n        if (this.debug) {\r\n            console.timeEnd(\"Game\");\r\n        }\r\n        this.scale.on(\"resize\", () => {\r\n            document.querySelector(\"#game canvas\").style.opacity = 0;\r\n            this.config.width = window.innerWidth;\r\n            this.config.height = window.innerHeight;\r\n            this.scene.getScene(\"Play\").scene.stop();\r\n            this.scene.getScene(\"Help\").scene.stop();\r\n            this.scene.getScene(\"Boot\").scene.restart();\r\n            setTimeout(() => {\r\n                document.querySelector(\"#game canvas\").style.opacity = 1;\r\n            }, 250);\r\n        });\r\n    }\r\n    sceneLog(name, log) {\r\n        if (this.debug) {\r\n            console.groupCollapsed(`%cScene Log [${name}]`, \"color: green;\");\r\n            console.table(log);\r\n            console.groupEnd();\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Game;","class Bench extends Phaser.GameObjects.Sprite {\r\n    constructor(scene) {\r\n        super(scene, 0, scene.game.config.height * 0.8, \"bench\");\r\n        this.scene = scene;\r\n        this.setOrigin(0, 0.85)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.8 : 0.6))\r\n            .setDepth(4);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Bench;","class Lamp extends Phaser.GameObjects.Sprite {\r\n    constructor(scene, count = 2, status = false, currect = true) {\r\n        super(scene, 0, scene.game.config.height * 0.8, `lamp-${count}-${(status == true ? \"on\" : \"off\")}`);\r\n        this.scene = scene;\r\n        this.gameCheck = true;\r\n        this.isCurrect = currect;\r\n        this.lightStatus = status;\r\n        this.setOrigin(0, 0.96)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.8 : 0.6))\r\n            .setDepth(4)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                this.lightStatus = !this.lightStatus;\r\n                this.setTexture(`lamp-${count}-${(this.lightStatus ? \"on\" : \"off\")}`);\r\n            }, this);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Lamp;","const TreeSprite = require(\"./tree\");\r\nconst PoleSprite = require(\"./pole\");\r\nconst BenchSprite = require(\"./bench\");\r\nconst LampSprite = require(\"./lamp\");\r\n\r\nclass Platform extends Phaser.GameObjects.Container {\r\n    constructor(scene) {\r\n        super(scene, 0, 0);\r\n        this.scene = scene;\r\n        this.level = {\r\n            requestCount: Math.round(scene.game.config.width / 180),\r\n            keepResponse: [],\r\n            data: [],\r\n            current: 1,\r\n            score: 0\r\n        };\r\n        this.scope = {\r\n            available: \"three\",\r\n            one: {\r\n                status: \"active\",\r\n                keep: 20,\r\n                el: this.scene.add.container((this.scene.game.config.width + 100), 0)\r\n            },\r\n            two: {\r\n                status: \"active\",\r\n                keep: 20,\r\n                el: this.scene.add.container((this.scene.game.config.width * 2) + 100, 0)\r\n            },\r\n            three: {\r\n                status: \"pause\",\r\n                keep: 20,\r\n                el: this.scene.add.container(this.scene.game.config.width, 0)\r\n            },\r\n        };\r\n        this.area(this.scope.one.el, 0xff0000);\r\n        this.area(this.scope.two.el, 0x00ff00);\r\n        this.area(this.scope.three.el, 0x0000ff);\r\n        this.add([this.scope.one.el, this.scope.two.el, this.scope.three.el]).setDepth(10);\r\n        // set limit\r\n        this.limit = this.scene.game.config.width * -1;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        // init start content\r\n        this.addContent(this.scope.one);\r\n        this.addContent(this.scope.two);\r\n    }\r\n    initRequest() {\r\n        this.level.data = [];\r\n        for (let i = 1; i <= this.level.requestCount; i++) {\r\n            this.level.data.push(this.createRequest(this.level.current, (i == this.level.requestCount ? true : Phaser.Utils.Array.GetRandom([true, false]))));\r\n        }\r\n        if (this.level.current > (this.scene.game.device.os.desktop ? 2 : 4)) {\r\n            this.scene.runSpace(\"mid\");\r\n        }\r\n        if (this.level.current > (this.scene.game.device.os.desktop ? 5 : 8)) {\r\n            this.scene.runSpace(\"max\");\r\n        }\r\n        this.level.current++;\r\n    }\r\n    createRequest(level, createResponse = true) {\r\n        let worldLevel = Math.ceil(level / 3);\r\n        let request = {\r\n            count: 0,\r\n            light: Phaser.Math.Between(0, worldLevel),\r\n            pole: {\r\n                status: (Phaser.Math.Between(1, 12) >= 8 ? true : false),\r\n                more: 0\r\n            }\r\n        };\r\n        if (request.light > 4) {\r\n            request.light = 4;\r\n        }\r\n        if (request.pole.status && (request.light > 0 && request.light <= 2)) {\r\n            request.pole.more = Phaser.Utils.Array.GetRandom([-1, -2, 1, 2]);\r\n            if (request.light + request.pole.more < 0) {\r\n                request.pole.more = 0;\r\n            }\r\n        }\r\n        request.count = request.light + request.pole.more;\r\n        let currect = [];\r\n        let wrong = [];\r\n        if (this.level.keepResponse.length >= 2) {\r\n            createResponse = true;\r\n        }\r\n        if (createResponse) {\r\n            for (let index in this.level.keepResponse) {\r\n                currect.push(this.level.keepResponse[index]);\r\n            }\r\n            this.level.keepResponse = [];\r\n        }\r\n        let needLamp = request.count;\r\n        while (needLamp > 0) {\r\n            let select = 1;\r\n            if (needLamp > 1) {\r\n                select = (request.light >= 2 ? 2 : Phaser.Utils.Array.GetRandom([1, 2]));\r\n            }\r\n            currect.push(select);\r\n            needLamp -= select;\r\n        }\r\n        if (!createResponse) {\r\n            for (let index in currect) {\r\n                this.level.keepResponse.push(currect[index]);\r\n            }\r\n            currect = [];\r\n        }\r\n        for (let i = 0; i < currect.length / 2; i++) {\r\n            wrong.push(Phaser.Math.Between(1, 2));\r\n        }\r\n        return {\r\n            request,\r\n            currect,\r\n            wrong\r\n        };\r\n    }\r\n    addContent(scope) {\r\n        if (!this.level.data.length) {\r\n            this.initRequest();\r\n        }\r\n        let maxWidth = scope.el.width * (this.scene.game.device.os.desktop ? 0.8 : 0.6);\r\n        let container = this.scene.add.container(0, 0);\r\n        scope.el.add(container);\r\n        while (scope.keep <= maxWidth && this.level.data.length) {\r\n            let data = this.level.data.shift();\r\n            // add tree\r\n            let treeSpace = Phaser.Math.Between(10, 30);\r\n            let tree = new TreeSprite(this.scene, Phaser.Math.Between(1, 6), data.request.light).show().setX(scope.keep + treeSpace);\r\n            scope.keep += tree.width + treeSpace;\r\n            container.add(tree);\r\n            if (!data.request.pole.status) {\r\n                // add bench\r\n                if (Phaser.Math.Between(1, 2) == 2) {\r\n                    let benchSpace = Phaser.Math.Between(10, 20);\r\n                    let bench = new BenchSprite(this.scene).show().setX(scope.keep + benchSpace);\r\n                    scope.keep += bench.displayWidth + benchSpace;\r\n                    container.add(bench);\r\n                }\r\n            }\r\n            else {\r\n                // add pole\r\n                let poleSpace = Phaser.Math.Between(5, 15);\r\n                let pole = new PoleSprite(this.scene, data.request.pole.more).show().setX(scope.keep + poleSpace);\r\n                scope.keep += pole.displayWidth + poleSpace;\r\n                container.add(pole);\r\n            }\r\n            let lamps = [];\r\n            // add currect lamps\r\n            for (let index in data.currect) {\r\n                let lampSpace = Phaser.Math.Between(10, 20);\r\n                let lampItem = new LampSprite(this.scene, data.currect[index], Phaser.Utils.Array.GetRandom([false, true]), true)\r\n                    .show()\r\n                    .setFlipX((data.currect[index] == 1 ? Phaser.Utils.Array.GetRandom([false, true]) : false))\r\n                    .setX(scope.keep + lampSpace);\r\n                scope.keep += lampItem.displayWidth + lampSpace;\r\n                lamps.push(lampItem);\r\n            }\r\n            // add wrong lamps\r\n            for (let index in data.wrong) {\r\n                if (scope.keep <= maxWidth) {\r\n                    let lampSpace = Phaser.Math.Between(10, 20);\r\n                    let lampItem = new LampSprite(this.scene, data.wrong[index], Phaser.Utils.Array.GetRandom([false, true]), false)\r\n                        .show()\r\n                        .setFlipX((data.currect[index] == 1 ? Phaser.Utils.Array.GetRandom([false, true]) : false))\r\n                        .setX(scope.keep + lampSpace);\r\n                    scope.keep += lampItem.displayWidth + lampSpace;\r\n                    lamps.push(lampItem);\r\n                }\r\n            }\r\n            container.add(lamps);\r\n        }\r\n        container.x = ((scope.el.width - scope.keep) / 2);\r\n    }\r\n    removeContent(scope) {\r\n        scope.status = \"pause\";\r\n        let gameOver = false;\r\n        scope.el.last.each((child) => {\r\n            child.setAlpha(0.3);\r\n            if (child.gameCheck) {\r\n                if (child.isCurrect != child.lightStatus) {\r\n                    child.setAlpha(1).setTintFill(0xff0000, 0x000000);\r\n                    gameOver = true;\r\n                }\r\n            }\r\n        });\r\n        if (gameOver) {\r\n            this.scene.pauseSpace();\r\n\r\n            if (this.scope.one.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.one.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            if (this.scope.two.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.two.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            if (this.scope.three.status == \"active\") {\r\n                this.scene.tweens.add({\r\n                    targets: this.scope.three.el,\r\n                    x: this.scene.game.config.width * 1.2,\r\n                    duration: 800,\r\n                    ease: Phaser.Math.Easing.Back.In\r\n                });\r\n            }\r\n            this.scene.tweens.add({\r\n                targets: scope.el,\r\n                x: 0,\r\n                delay: 800,\r\n                duration: 800,\r\n                ease: Phaser.Math.Easing.Back.Out\r\n            });\r\n            this.scene.time.addEvent({\r\n                delay: 1000,\r\n                callback: () => {\r\n                    this.scene.title.setText(\"Game Over\").setDepth(20).setTintFill(0xff0000, 0x000000);\r\n                },\r\n                callbackScope: this.scene\r\n            });\r\n            this.scene.time.addEvent({\r\n                delay: 6000,\r\n                callback: () => {\r\n                    this.scene.scene.start(\"Boot\");\r\n                },\r\n                callbackScope: this.scene\r\n            });\r\n        } else {\r\n            scope.el.x = Math.abs(this.limit);\r\n            scope.el.removeAll(true);\r\n            scope.keep = 20;\r\n        }\r\n    }\r\n    run(speed = 0) {\r\n        if (speed) {\r\n            this.level.score += speed;\r\n            if (this.scope.one.status == \"active\") {\r\n                this.scope.one.el.x -= speed;\r\n                if (this.scope.one.el.x <= this.limit) {\r\n                    this.scope.available = \"one\";\r\n                    this.scope.three.status = \"active\";\r\n                    this.removeContent(this.scope.one);\r\n                    this.addContent(this.scope.three);\r\n                }\r\n            }\r\n            if (this.scope.two.status == \"active\") {\r\n                this.scope.two.el.x -= speed;\r\n                if (this.scope.two.el.x <= this.limit) {\r\n                    this.scope.available = \"two\";\r\n                    this.scope.one.status = \"active\";\r\n                    this.removeContent(this.scope.two);\r\n                    this.addContent(this.scope.one);\r\n                }\r\n            }\r\n            if (this.scope.three.status == \"active\") {\r\n                this.scope.three.el.x -= speed;\r\n                if (this.scope.three.el.x <= this.limit) {\r\n                    this.scope.available = \"three\";\r\n                    this.scope.two.status = \"active\";\r\n                    this.removeContent(this.scope.three);\r\n                    this.addContent(this.scope.two);\r\n                }\r\n            }\r\n            this.scene.title.setText(Math.round(this.level.score / 10).toString().padStart(5, \"0\"));\r\n        }\r\n    }\r\n    area(scope, color) {\r\n        scope.setSize(this.scene.game.config.width - 40, (this.scene.game.config.height * 0.8) - 40)\r\n        if (false) {\r\n            let areaStart = this.scene.add.graphics(0, 0)\r\n                .fillStyle(color, 0.5)\r\n                .fillRect(10, 10, 2, scope.height + 20);\r\n            let areaEnd = this.scene.add.graphics(0, 0)\r\n                .fillStyle(color, 0.5)\r\n                .fillRect(scope.width + 20, 10, 2, scope.height + 20);\r\n            scope.add([areaStart, areaEnd]);\r\n        }\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Platform;","class Pole extends Phaser.GameObjects.Sprite {\r\n    constructor(scene, type = \"0\") {\r\n        let poleType = {\r\n            \"-2\": \"-2\",\r\n            \"-1\": \"-1\",\r\n            \"0\": \"\",\r\n            \"1\": \"+1\",\r\n            \"2\": \"+2\"\r\n        };\r\n        super(scene, 0, scene.game.config.height * 0.8, `pole${poleType[type]}`);\r\n        this.scene = scene;\r\n        this.setOrigin(0, 0.97)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.8 : 0.6))\r\n            .setDepth(4);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Pole;","class Tree extends Phaser.GameObjects.Container {\r\n    constructor(scene, type = \"1\", lightCount = 0) {\r\n        super(scene, 0, scene.game.config.height * 0.8);\r\n        this.scene = scene;\r\n        let tree = this.scene.add.sprite(0, 0, `tree${type}`)\r\n            .setScale((this.scene.game.device.os.desktop ? 0.7 : 0.5))\r\n            .setOrigin(0, 0.91);\r\n        this.add(tree);\r\n        if (lightCount < 0 || lightCount > 4) {\r\n            lightCount = 0;\r\n        }\r\n        if (lightCount) {\r\n            let count = {\r\n                w: 200,\r\n                h: 230\r\n            };\r\n            switch (lightCount) {\r\n                case 2: {\r\n                    count.w *= 2;\r\n                    break;\r\n                }\r\n                case 3: {\r\n                    count.w *= 3;\r\n                    break;\r\n                }\r\n                case 4: {\r\n                    count.w *= 2;\r\n                    count.h *= 2;\r\n                    break;\r\n                }\r\n            }\r\n            let light = this.scene.add.tileSprite(tree.displayWidth / 2, (tree.displayHeight * -1), count.w, count.h, \"light\")\r\n                .setScale(0.13)\r\n                .setOrigin(0.5, 1);\r\n            this.add(light);\r\n        }\r\n        this.setDepth(4).setSize(tree.displayWidth, tree.displayHeight);\r\n        //\r\n        return this;\r\n    }\r\n    show() {\r\n        this.scene.add.existing(this);\r\n        return this;\r\n    }\r\n}\r\n\r\nmodule.exports = Tree;","const Platform = require(\"./gameObject/platform\");\r\n\r\nclass Scene extends Phaser.Scene {\r\n    constructor(name) {\r\n        super(name);\r\n        this.name = name;\r\n        this.keepLog = [];\r\n        this.lock = true;\r\n        this.helpOpen = false;\r\n    }\r\n    log(message = null, system = false) {\r\n        if (this.game.debug && message) {\r\n            this.keepLog.push({\r\n                message,\r\n                bySystem: system\r\n            });\r\n        }\r\n        return this.keepLog;\r\n    }\r\n    init() {\r\n        this.log(\"init\", true);\r\n    }\r\n    preload() {\r\n        this.log(\"preload\", true);\r\n    }\r\n    create() {\r\n        // add ground\r\n        this.ground = this.add.tileSprite(-2, this.game.config.height + 2, this.game.config.width + 4, this.game.config.height * 0.2, \"ground\")\r\n            .setOrigin(0, 1)\r\n            .setTileScale((this.game.device.os.desktop ? 1 : 0.6))\r\n            .setDepth(0);\r\n        this.ground.speed = {\r\n            current: 0,\r\n            pause: 0,\r\n            min: (this.game.device.os.desktop ? 2.5 : 2),\r\n            mid: (this.game.device.os.desktop ? 3.5 : 3),\r\n            max: (this.game.device.os.desktop ? 4.5 : 4),\r\n        };\r\n        // add city\r\n        this.city = this.add.tileSprite(0, this.game.config.height * 0.8, this.game.config.width, 109, \"city\")\r\n            .setOrigin(0, 1)\r\n            .setDepth(1);\r\n        this.city.speed = {\r\n            current: 0,\r\n            pause: 0,\r\n            min: 0.2,\r\n            mid: 0.4,\r\n            max: 0.6\r\n        };\r\n        this.line = this.add.graphics(0, 0)\r\n            .fillStyle(0xf4d242, 1)\r\n            .fillRect(0, (this.game.config.height * 0.8), this.game.config.width, 3)\r\n            .setDepth(1);\r\n        // add cloud\r\n        this.cloud = this.add.tileSprite(0, this.game.config.height * 0.6, this.game.config.width, 105, \"cloud\")\r\n            .setOrigin(0, 1)\r\n            .setDepth(2);\r\n        this.cloud.speed = {\r\n            current: 0,\r\n            pause: 0,\r\n            min: -0.4,\r\n            mid: -0.6,\r\n            max: -0.8\r\n        };\r\n        // load platform\r\n        this.title = this.add.text(this.game.config.width * 0.5, this.game.config.height * 0.15, \"\", {\r\n            font: `${(this.game.device.os.desktop ? \"160\" : \"100\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(0.5);\r\n        // add help\r\n        this.helpBtn = this.add.text(25, this.game.config.height - 20, \"?\", {\r\n            font: `${(this.game.device.os.desktop ? \"40\" : \"30\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(0, 1)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                if (!this.helpOpen) {\r\n                    this.scene.start(\"Help\");\r\n                } else {\r\n                    this.scene.start(\"Boot\");\r\n                }\r\n            }, this);\r\n        // add fullscreen\r\n        this.fullscreenBtn = this.add.text(this.game.config.width - 25, this.game.config.height - 20, \"⎚\", {\r\n            font: `${(this.game.device.os.desktop ? \"40\" : \"30\")}px '${this.game.font}'`,\r\n            fill: \"#FFF8EE\"\r\n        }).setOrigin(1, 1)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                if (this.scale.isFullscreen) {\r\n                    this.scale.stopFullscreen();\r\n                } else {\r\n                    this.scale.startFullscreen();\r\n                }\r\n            }, this);\r\n        // end of scene\r\n        this.log(\"create\", true);\r\n        this.game.sceneLog(this.name, this.keepLog);\r\n    }\r\n    update() {\r\n        if (this.lock) return;\r\n        if (this.ground.speed.current) {\r\n            this.platform.run(this.ground.speed.current);\r\n            this.ground.tilePositionX += (this.game.device.os.desktop ? this.ground.speed.current : this.ground.speed.current * 1.6);\r\n            if (this.city.speed.current) {\r\n                this.city.tilePositionX += this.city.speed.current;\r\n            }\r\n        }\r\n        if (this.cloud.speed.current) {\r\n            this.cloud.tilePositionX += this.cloud.speed.current;\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Scene;","const Scene = require(\"../scene\");\r\n\r\nclass Boot extends Scene {\r\n    constructor() {\r\n        super(\"Boot\");\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n        this.load.image(\"ground\", \"data/ground.png\");\r\n        this.load.image(\"city\", \"data/city.png\");\r\n        this.load.image(\"cloud\", \"data/cloud.png\");\r\n        this.load.image(\"play\", \"data/play.png\");\r\n        this.load.image(\"help\", \"data/help.png\");\r\n        //\r\n        this.load.image(\"tree1\", \"data/tree1.png\");\r\n        this.load.image(\"tree2\", \"data/tree2.png\");\r\n        this.load.image(\"tree3\", \"data/tree3.png\");\r\n        this.load.image(\"tree4\", \"data/tree4.png\");\r\n        this.load.image(\"tree5\", \"data/tree5.png\");\r\n        this.load.image(\"tree6\", \"data/tree6.png\");\r\n        //\r\n        this.load.image(\"light\", \"data/light.png\");\r\n        this.load.image(\"bench\", \"data/bench.png\");\r\n        //\r\n        this.load.image(\"pole\", \"data/pole.png\");\r\n        this.load.image(\"pole-1\", \"data/pole-1.png\");\r\n        this.load.image(\"pole-2\", \"data/pole-2.png\");\r\n        this.load.image(\"pole+1\", \"data/pole+1.png\");\r\n        this.load.image(\"pole+2\", \"data/pole+2.png\");\r\n        //\r\n        this.load.image(\"lamp-1-on\", \"data/lamp-1-on.png\");\r\n        this.load.image(\"lamp-1-off\", \"data/lamp-1-off.png\");\r\n        this.load.image(\"lamp-2-on\", \"data/lamp-2-on.png\");\r\n        this.load.image(\"lamp-2-off\", \"data/lamp-2-off.png\");\r\n    }\r\n    create() {\r\n        super.create();\r\n        // music\r\n        this.load.audio(\"music\", \"data/music.mp3\").on(\"filecomplete\", () => {\r\n            this.sound.add(\"music\", {\r\n                volume: 1,\r\n                loop: true\r\n            }).play()\r\n        }).start();\r\n        this.helpOpen = false;\r\n        if (this.game.config.height > this.game.config.width) {\r\n            this.title.setText(\"Rotate!\")\r\n                .setDepth(20)\r\n                .setTintFill(0xff0000, 0x000000)\r\n                .setPosition(this.game.config.width / 2, (this.game.config.height * 0.8) / 2);\r\n            this.tweens.add({\r\n                targets: this.title,\r\n                scale: { from: 0.95, to: 1.05 },\r\n                duration: 150,\r\n                yoyo: true,\r\n                repeat: -1\r\n            });\r\n        } else {\r\n            if (this.game.config.width < 480 || this.game.config.height < 320) {\r\n                this.title.setText(\"Screen!\")\r\n                    .setDepth(20)\r\n                    .setTintFill(0xff0000, 0x000000)\r\n                    .setPosition(this.game.config.width / 2, (this.game.config.height * 0.8) / 2);\r\n                this.tweens.add({\r\n                    targets: this.title,\r\n                    scale: { from: 0.95, to: 1.05 },\r\n                    duration: 150,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            } else {\r\n                this.title.setText(\"Light Tree\").setTintFill(0xf4d242);\r\n                this.btn = this.add.sprite(0, 0, \"play\")\r\n                    .setOrigin(0.5)\r\n                    .setPosition(this.game.config.width / 2, (this.game.config.height / 2) + (this.game.config.height * 0.1))\r\n                    .setDepth(10)\r\n                    .setScale(0.3)\r\n                    .setInteractive()\r\n                    .on(\"pointerdown\", () => {\r\n                        this.scene.start(\"Play\");\r\n                    }, this);\r\n                this.tweens.add({\r\n                    targets: this.btn,\r\n                    x: {\r\n                        from: this.game.config.width * 0.497,\r\n                        to: this.game.config.width * 0.503\r\n                    },\r\n                    duration: 300,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            }\r\n        }\r\n    }\r\n}\r\n\r\nmodule.exports = Boot;","const Scene = require(\"../scene\");\r\n\r\nclass Help extends Scene {\r\n    constructor() {\r\n        super(\"Help\");\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n\r\n    }\r\n    create() {\r\n        super.create();\r\n        // hide boot scene object\r\n        this.ground.setVisible(false);\r\n        this.city.setVisible(false);\r\n        this.cloud.setVisible(false);\r\n        this.line.setVisible(false);\r\n        this.fullscreenBtn.setVisible(false);\r\n        // add help image\r\n        this.helpImage = this.add.image(0, 0, \"help\")\r\n            .setOrigin(0.5)\r\n            .setScale((this.game.device.os.desktop ? 0.6 : 0.4))\r\n            .setDepth(5)\r\n            .setPosition(this.game.config.width / 2, this.game.config.height / 2)\r\n            .setInteractive()\r\n            .on(\"pointerdown\", () => {\r\n                this.scene.start(\"Boot\");\r\n            }, this);\r\n        this.helpOpen = true;\r\n        this.helpBtn.setText(\"«\").setTintFill(0x000000);\r\n    }\r\n}\r\n\r\nmodule.exports = Help;","const Scene = require(\"../scene\");\r\nconst Platform = require(\"../gameObject/platform\");\r\n\r\nclass Play extends Scene {\r\n    constructor() {\r\n        super(\"Play\");\r\n        this.lock = false;\r\n    }\r\n    init() {\r\n        super.init();\r\n    }\r\n    preload() {\r\n        super.preload();\r\n    }\r\n    create() {\r\n        super.create();\r\n        this.lock = false;\r\n        this.helpOpen = false;\r\n        this.platform = new Platform(this);\r\n        if (this.game.config.height > this.game.config.width) {\r\n            this.title.setText(\"Rotate!\");\r\n            this.tweens.add({\r\n                targets: this.title,\r\n                angle: { from: -5, to: 5 },\r\n                duration: 150,\r\n                yoyo: true,\r\n                repeat: -1\r\n            });\r\n        } else {\r\n            if (this.game.config.width < 480 || this.game.config.height < 320) {\r\n                this.title.setText(\"Screen!\");\r\n                this.tweens.add({\r\n                    targets: this.title,\r\n                    y: 50,\r\n                    duration: 150,\r\n                    yoyo: true,\r\n                    repeat: -1\r\n                });\r\n            } else {\r\n                this.platform.show();\r\n                this.runSpace();\r\n            }\r\n        }\r\n    }\r\n    runSpace(speed = \"min\", object = []) {\r\n        if (!object.length) {\r\n            object = [\"ground\", \"city\", \"cloud\"];\r\n        }\r\n        for (let index in object) {\r\n            this[object[index]].speed.current = this[object[index]].speed[speed];\r\n        }\r\n    }\r\n    pauseSpace() {\r\n        this.lock = true;\r\n        this.ground.speed.current = this.ground.speed.pause;\r\n        this.city.speed.current = this.city.speed.pause;\r\n        this.cloud.speed.current = this.cloud.speed.pause;\r\n    }\r\n}\r\n\r\nmodule.exports = Play;"],"preExistingComment":"//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJzcmMvYWN0aW9uLmpzIiwic3JjL2xpYi9nYW1lLmpzIiwic3JjL2xpYi9nYW1lT2JqZWN0L2JlbmNoLmpzIiwic3JjL2xpYi9nYW1lT2JqZWN0L2xhbXAuanMiLCJzcmMvbGliL2dhbWVPYmplY3QvcGxhdGZvcm0uanMiLCJzcmMvbGliL2dhbWVPYmplY3QvcG9sZS5qcyIsInNyYy9saWIvZ2FtZU9iamVjdC90cmVlLmpzIiwic3JjL2xpYi9zY2VuZS5qcyIsInNyYy9saWIvc2NlbmUvYm9vdC5qcyIsInNyYy9saWIvc2NlbmUvaGVscC5qcyIsInNyYy9saWIvc2NlbmUvcGxheS5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ1pBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDN0RBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDaEJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ3hCQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQzlSQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDdkJBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDOUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOztBQ2xIQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTs7QUNuR0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7O0FDcENBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBIiwiZmlsZSI6ImdlbmVyYXRlZC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzQ29udGVudCI6WyIoZnVuY3Rpb24oKXtmdW5jdGlvbiByKGUsbix0KXtmdW5jdGlvbiBvKGksZil7aWYoIW5baV0pe2lmKCFlW2ldKXt2YXIgYz1cImZ1bmN0aW9uXCI9PXR5cGVvZiByZXF1aXJlJiZyZXF1aXJlO2lmKCFmJiZjKXJldHVybiBjKGksITApO2lmKHUpcmV0dXJuIHUoaSwhMCk7dmFyIGE9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitpK1wiJ1wiKTt0aHJvdyBhLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsYX12YXIgcD1uW2ldPXtleHBvcnRzOnt9fTtlW2ldWzBdLmNhbGwocC5leHBvcnRzLGZ1bmN0aW9uKHIpe3ZhciBuPWVbaV1bMV1bcl07cmV0dXJuIG8obnx8cil9LHAscC5leHBvcnRzLHIsZSxuLHQpfXJldHVybiBuW2ldLmV4cG9ydHN9Zm9yKHZhciB1PVwiZnVuY3Rpb25cIj09dHlwZW9mIHJlcXVpcmUmJnJlcXVpcmUsaT0wO2k8dC5sZW5ndGg7aSsrKW8odFtpXSk7cmV0dXJuIG99cmV0dXJuIHJ9KSgpIiwiY29uc3QgZGVidWcgPSBcIkBAZGVidWdcIjtcclxuY29uc3QgZm9udEZhbWlseSA9IFwiQ3V0ZSBGb250XCI7XHJcbmNvbnN0IEdhbWUgPSByZXF1aXJlKFwiLi9saWIvZ2FtZVwiKTtcclxuXHJcbldlYkZvbnQubG9hZCh7XHJcbiAgICBnb29nbGU6IHtcclxuICAgICAgICBmYW1pbGllczogW2ZvbnRGYW1pbHldXHJcbiAgICB9LFxyXG4gICAgYWN0aXZlKCkge1xyXG4gICAgICAgIGNvbnN0IGdhbWVPYmplY3QgPSBuZXcgR2FtZShmb250RmFtaWx5LCBkZWJ1Zyk7XHJcbiAgICB9XHJcbn0pO1xyXG4iLCIvLyBsb2FkIHNjZW5lc1xyXG5jb25zdCBCb290U2NlbmUgPSByZXF1aXJlKFwiLi9zY2VuZS9ib290XCIpO1xyXG5jb25zdCBIZWxwU2NlbmUgPSByZXF1aXJlKFwiLi9zY2VuZS9oZWxwXCIpO1xyXG5jb25zdCBQbGF5U2NlbmUgPSByZXF1aXJlKFwiLi9zY2VuZS9wbGF5XCIpO1xyXG5cclxuY2xhc3MgR2FtZSBleHRlbmRzIFBoYXNlci5HYW1lIHtcclxuICAgIGNvbnN0cnVjdG9yKGZvbnQsIGRlYnVnID0gZmFsc2UpIHtcclxuICAgICAgICBpZiAoZGVidWcpIHtcclxuICAgICAgICAgICAgY29uc29sZS50aW1lKFwiR2FtZVwiKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgc3VwZXIoe1xyXG4gICAgICAgICAgICByZW5kZXJlcjogUGhhc2VyLkFVVE8sXHJcbiAgICAgICAgICAgIGFudGlhbGlhczogdHJ1ZSxcclxuICAgICAgICAgICAgYmFja2dyb3VuZENvbG9yOiBcIiNmY2YxZGVcIixcclxuICAgICAgICAgICAgcGl4ZWxBcnQ6IGZhbHNlLFxyXG4gICAgICAgICAgICByb3VuZFBpeGVsczogdHJ1ZSxcclxuICAgICAgICAgICAgYXV0b0NlbnRlcjogdHJ1ZSxcclxuICAgICAgICAgICAgYmFubmVyOiBkZWJ1ZyxcclxuICAgICAgICAgICAgZGlzYWJsZUNvbnRleHRNZW51OiAhZGVidWcsXHJcbiAgICAgICAgICAgIHNjYWxlOiB7XHJcbiAgICAgICAgICAgICAgICBtb2RlOiBQaGFzZXIuU2NhbGUuUkVTSVpFLFxyXG4gICAgICAgICAgICAgICAgcGFyZW50OiBcImdhbWVcIixcclxuICAgICAgICAgICAgICAgIHdpZHRoOiB3aW5kb3cuaW5uZXJXaWR0aCxcclxuICAgICAgICAgICAgICAgIGhlaWdodDogd2luZG93LmlubmVySGVpZ2h0XHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgIHNjZW5lOiBbXHJcbiAgICAgICAgICAgICAgICBCb290U2NlbmUsXHJcbiAgICAgICAgICAgICAgICBIZWxwU2NlbmUsXHJcbiAgICAgICAgICAgICAgICBQbGF5U2NlbmVcclxuICAgICAgICAgICAgXVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuZm9udCA9IGZvbnQ7XHJcbiAgICAgICAgdGhpcy5kZWJ1ZyA9IGRlYnVnO1xyXG4gICAgfVxyXG4gICAgc3RhcnQoKSB7XHJcbiAgICAgICAgc3VwZXIuc3RhcnQoKTtcclxuICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2dhbWUgY2FudmFzXCIpLnN0eWxlLm9wYWNpdHkgPSAxO1xyXG4gICAgICAgIGlmICh0aGlzLmRlYnVnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUudGltZUVuZChcIkdhbWVcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2NhbGUub24oXCJyZXNpemVcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2dhbWUgY2FudmFzXCIpLnN0eWxlLm9wYWNpdHkgPSAwO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy53aWR0aCA9IHdpbmRvdy5pbm5lcldpZHRoO1xyXG4gICAgICAgICAgICB0aGlzLmNvbmZpZy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUuZ2V0U2NlbmUoXCJQbGF5XCIpLnNjZW5lLnN0b3AoKTtcclxuICAgICAgICAgICAgdGhpcy5zY2VuZS5nZXRTY2VuZShcIkhlbHBcIikuc2NlbmUuc3RvcCgpO1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLmdldFNjZW5lKFwiQm9vdFwiKS5zY2VuZS5yZXN0YXJ0KCk7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNnYW1lIGNhbnZhc1wiKS5zdHlsZS5vcGFjaXR5ID0gMTtcclxuICAgICAgICAgICAgfSwgMjUwKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuICAgIHNjZW5lTG9nKG5hbWUsIGxvZykge1xyXG4gICAgICAgIGlmICh0aGlzLmRlYnVnKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUuZ3JvdXBDb2xsYXBzZWQoYCVjU2NlbmUgTG9nIFske25hbWV9XWAsIFwiY29sb3I6IGdyZWVuO1wiKTtcclxuICAgICAgICAgICAgY29uc29sZS50YWJsZShsb2cpO1xyXG4gICAgICAgICAgICBjb25zb2xlLmdyb3VwRW5kKCk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEdhbWU7IiwiY2xhc3MgQmVuY2ggZXh0ZW5kcyBQaGFzZXIuR2FtZU9iamVjdHMuU3ByaXRlIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lKSB7XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIHNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCwgXCJiZW5jaFwiKTtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgdGhpcy5zZXRPcmlnaW4oMCwgMC44NSlcclxuICAgICAgICAgICAgLnNldFNjYWxlKCh0aGlzLnNjZW5lLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyAwLjggOiAwLjYpKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoNCk7XHJcbiAgICAgICAgLy9cclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuICAgIHNob3coKSB7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5hZGQuZXhpc3RpbmcodGhpcyk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQmVuY2g7IiwiY2xhc3MgTGFtcCBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGUge1xyXG4gICAgY29uc3RydWN0b3Ioc2NlbmUsIGNvdW50ID0gMiwgc3RhdHVzID0gZmFsc2UsIGN1cnJlY3QgPSB0cnVlKSB7XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIHNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCwgYGxhbXAtJHtjb3VudH0tJHsoc3RhdHVzID09IHRydWUgPyBcIm9uXCIgOiBcIm9mZlwiKX1gKTtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgdGhpcy5nYW1lQ2hlY2sgPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaXNDdXJyZWN0ID0gY3VycmVjdDtcclxuICAgICAgICB0aGlzLmxpZ2h0U3RhdHVzID0gc3RhdHVzO1xyXG4gICAgICAgIHRoaXMuc2V0T3JpZ2luKDAsIDAuOTYpXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgodGhpcy5zY2VuZS5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMC44IDogMC42KSlcclxuICAgICAgICAgICAgLnNldERlcHRoKDQpXHJcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSgpXHJcbiAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIHRoaXMubGlnaHRTdGF0dXMgPSAhdGhpcy5saWdodFN0YXR1cztcclxuICAgICAgICAgICAgICAgIHRoaXMuc2V0VGV4dHVyZShgbGFtcC0ke2NvdW50fS0keyh0aGlzLmxpZ2h0U3RhdHVzID8gXCJvblwiIDogXCJvZmZcIil9YCk7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbiAgICBzaG93KCkge1xyXG4gICAgICAgIHRoaXMuc2NlbmUuYWRkLmV4aXN0aW5nKHRoaXMpO1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IExhbXA7IiwiY29uc3QgVHJlZVNwcml0ZSA9IHJlcXVpcmUoXCIuL3RyZWVcIik7XHJcbmNvbnN0IFBvbGVTcHJpdGUgPSByZXF1aXJlKFwiLi9wb2xlXCIpO1xyXG5jb25zdCBCZW5jaFNwcml0ZSA9IHJlcXVpcmUoXCIuL2JlbmNoXCIpO1xyXG5jb25zdCBMYW1wU3ByaXRlID0gcmVxdWlyZShcIi4vbGFtcFwiKTtcclxuXHJcbmNsYXNzIFBsYXRmb3JtIGV4dGVuZHMgUGhhc2VyLkdhbWVPYmplY3RzLkNvbnRhaW5lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihzY2VuZSkge1xyXG4gICAgICAgIHN1cGVyKHNjZW5lLCAwLCAwKTtcclxuICAgICAgICB0aGlzLnNjZW5lID0gc2NlbmU7XHJcbiAgICAgICAgdGhpcy5sZXZlbCA9IHtcclxuICAgICAgICAgICAgcmVxdWVzdENvdW50OiBNYXRoLnJvdW5kKHNjZW5lLmdhbWUuY29uZmlnLndpZHRoIC8gMTgwKSxcclxuICAgICAgICAgICAga2VlcFJlc3BvbnNlOiBbXSxcclxuICAgICAgICAgICAgZGF0YTogW10sXHJcbiAgICAgICAgICAgIGN1cnJlbnQ6IDEsXHJcbiAgICAgICAgICAgIHNjb3JlOiAwXHJcbiAgICAgICAgfTtcclxuICAgICAgICB0aGlzLnNjb3BlID0ge1xyXG4gICAgICAgICAgICBhdmFpbGFibGU6IFwidGhyZWVcIixcclxuICAgICAgICAgICAgb25lOiB7XHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IFwiYWN0aXZlXCIsXHJcbiAgICAgICAgICAgICAgICBrZWVwOiAyMCxcclxuICAgICAgICAgICAgICAgIGVsOiB0aGlzLnNjZW5lLmFkZC5jb250YWluZXIoKHRoaXMuc2NlbmUuZ2FtZS5jb25maWcud2lkdGggKyAxMDApLCAwKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0d286IHtcclxuICAgICAgICAgICAgICAgIHN0YXR1czogXCJhY3RpdmVcIixcclxuICAgICAgICAgICAgICAgIGtlZXA6IDIwLFxyXG4gICAgICAgICAgICAgICAgZWw6IHRoaXMuc2NlbmUuYWRkLmNvbnRhaW5lcigodGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAqIDIpICsgMTAwLCAwKVxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICB0aHJlZToge1xyXG4gICAgICAgICAgICAgICAgc3RhdHVzOiBcInBhdXNlXCIsXHJcbiAgICAgICAgICAgICAgICBrZWVwOiAyMCxcclxuICAgICAgICAgICAgICAgIGVsOiB0aGlzLnNjZW5lLmFkZC5jb250YWluZXIodGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCwgMClcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMuYXJlYSh0aGlzLnNjb3BlLm9uZS5lbCwgMHhmZjAwMDApO1xyXG4gICAgICAgIHRoaXMuYXJlYSh0aGlzLnNjb3BlLnR3by5lbCwgMHgwMGZmMDApO1xyXG4gICAgICAgIHRoaXMuYXJlYSh0aGlzLnNjb3BlLnRocmVlLmVsLCAweDAwMDBmZik7XHJcbiAgICAgICAgdGhpcy5hZGQoW3RoaXMuc2NvcGUub25lLmVsLCB0aGlzLnNjb3BlLnR3by5lbCwgdGhpcy5zY29wZS50aHJlZS5lbF0pLnNldERlcHRoKDEwKTtcclxuICAgICAgICAvLyBzZXQgbGltaXRcclxuICAgICAgICB0aGlzLmxpbWl0ID0gdGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAqIC0xO1xyXG4gICAgfVxyXG4gICAgc2hvdygpIHtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgICAgICAvLyBpbml0IHN0YXJ0IGNvbnRlbnRcclxuICAgICAgICB0aGlzLmFkZENvbnRlbnQodGhpcy5zY29wZS5vbmUpO1xyXG4gICAgICAgIHRoaXMuYWRkQ29udGVudCh0aGlzLnNjb3BlLnR3byk7XHJcbiAgICB9XHJcbiAgICBpbml0UmVxdWVzdCgpIHtcclxuICAgICAgICB0aGlzLmxldmVsLmRhdGEgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpID0gMTsgaSA8PSB0aGlzLmxldmVsLnJlcXVlc3RDb3VudDsgaSsrKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGV2ZWwuZGF0YS5wdXNoKHRoaXMuY3JlYXRlUmVxdWVzdCh0aGlzLmxldmVsLmN1cnJlbnQsIChpID09IHRoaXMubGV2ZWwucmVxdWVzdENvdW50ID8gdHJ1ZSA6IFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oW3RydWUsIGZhbHNlXSkpKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmxldmVsLmN1cnJlbnQgPiAodGhpcy5zY2VuZS5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMiA6IDQpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUucnVuU3BhY2UoXCJtaWRcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmxldmVsLmN1cnJlbnQgPiAodGhpcy5zY2VuZS5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gNSA6IDgpKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUucnVuU3BhY2UoXCJtYXhcIik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMubGV2ZWwuY3VycmVudCsrO1xyXG4gICAgfVxyXG4gICAgY3JlYXRlUmVxdWVzdChsZXZlbCwgY3JlYXRlUmVzcG9uc2UgPSB0cnVlKSB7XHJcbiAgICAgICAgbGV0IHdvcmxkTGV2ZWwgPSBNYXRoLmNlaWwobGV2ZWwgLyAzKTtcclxuICAgICAgICBsZXQgcmVxdWVzdCA9IHtcclxuICAgICAgICAgICAgY291bnQ6IDAsXHJcbiAgICAgICAgICAgIGxpZ2h0OiBQaGFzZXIuTWF0aC5CZXR3ZWVuKDAsIHdvcmxkTGV2ZWwpLFxyXG4gICAgICAgICAgICBwb2xlOiB7XHJcbiAgICAgICAgICAgICAgICBzdGF0dXM6IChQaGFzZXIuTWF0aC5CZXR3ZWVuKDEsIDEyKSA+PSA4ID8gdHJ1ZSA6IGZhbHNlKSxcclxuICAgICAgICAgICAgICAgIG1vcmU6IDBcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHJlcXVlc3QubGlnaHQgPiA0KSB7XHJcbiAgICAgICAgICAgIHJlcXVlc3QubGlnaHQgPSA0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAocmVxdWVzdC5wb2xlLnN0YXR1cyAmJiAocmVxdWVzdC5saWdodCA+IDAgJiYgcmVxdWVzdC5saWdodCA8PSAyKSkge1xyXG4gICAgICAgICAgICByZXF1ZXN0LnBvbGUubW9yZSA9IFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oWy0xLCAtMiwgMSwgMl0pO1xyXG4gICAgICAgICAgICBpZiAocmVxdWVzdC5saWdodCArIHJlcXVlc3QucG9sZS5tb3JlIDwgMCkge1xyXG4gICAgICAgICAgICAgICAgcmVxdWVzdC5wb2xlLm1vcmUgPSAwO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJlcXVlc3QuY291bnQgPSByZXF1ZXN0LmxpZ2h0ICsgcmVxdWVzdC5wb2xlLm1vcmU7XHJcbiAgICAgICAgbGV0IGN1cnJlY3QgPSBbXTtcclxuICAgICAgICBsZXQgd3JvbmcgPSBbXTtcclxuICAgICAgICBpZiAodGhpcy5sZXZlbC5rZWVwUmVzcG9uc2UubGVuZ3RoID49IDIpIHtcclxuICAgICAgICAgICAgY3JlYXRlUmVzcG9uc2UgPSB0cnVlO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoY3JlYXRlUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggaW4gdGhpcy5sZXZlbC5rZWVwUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgICAgIGN1cnJlY3QucHVzaCh0aGlzLmxldmVsLmtlZXBSZXNwb25zZVtpbmRleF0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIHRoaXMubGV2ZWwua2VlcFJlc3BvbnNlID0gW107XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBuZWVkTGFtcCA9IHJlcXVlc3QuY291bnQ7XHJcbiAgICAgICAgd2hpbGUgKG5lZWRMYW1wID4gMCkge1xyXG4gICAgICAgICAgICBsZXQgc2VsZWN0ID0gMTtcclxuICAgICAgICAgICAgaWYgKG5lZWRMYW1wID4gMSkge1xyXG4gICAgICAgICAgICAgICAgc2VsZWN0ID0gKHJlcXVlc3QubGlnaHQgPj0gMiA/IDIgOiBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFsxLCAyXSkpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGN1cnJlY3QucHVzaChzZWxlY3QpO1xyXG4gICAgICAgICAgICBuZWVkTGFtcCAtPSBzZWxlY3Q7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghY3JlYXRlUmVzcG9uc2UpIHtcclxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggaW4gY3VycmVjdCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sZXZlbC5rZWVwUmVzcG9uc2UucHVzaChjdXJyZWN0W2luZGV4XSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgY3VycmVjdCA9IFtdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IGN1cnJlY3QubGVuZ3RoIC8gMjsgaSsrKSB7XHJcbiAgICAgICAgICAgIHdyb25nLnB1c2goUGhhc2VyLk1hdGguQmV0d2VlbigxLCAyKSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgIHJlcXVlc3QsXHJcbiAgICAgICAgICAgIGN1cnJlY3QsXHJcbiAgICAgICAgICAgIHdyb25nXHJcbiAgICAgICAgfTtcclxuICAgIH1cclxuICAgIGFkZENvbnRlbnQoc2NvcGUpIHtcclxuICAgICAgICBpZiAoIXRoaXMubGV2ZWwuZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgdGhpcy5pbml0UmVxdWVzdCgpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgbWF4V2lkdGggPSBzY29wZS5lbC53aWR0aCAqICh0aGlzLnNjZW5lLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyAwLjggOiAwLjYpO1xyXG4gICAgICAgIGxldCBjb250YWluZXIgPSB0aGlzLnNjZW5lLmFkZC5jb250YWluZXIoMCwgMCk7XHJcbiAgICAgICAgc2NvcGUuZWwuYWRkKGNvbnRhaW5lcik7XHJcbiAgICAgICAgd2hpbGUgKHNjb3BlLmtlZXAgPD0gbWF4V2lkdGggJiYgdGhpcy5sZXZlbC5kYXRhLmxlbmd0aCkge1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHRoaXMubGV2ZWwuZGF0YS5zaGlmdCgpO1xyXG4gICAgICAgICAgICAvLyBhZGQgdHJlZVxyXG4gICAgICAgICAgICBsZXQgdHJlZVNwYWNlID0gUGhhc2VyLk1hdGguQmV0d2VlbigxMCwgMzApO1xyXG4gICAgICAgICAgICBsZXQgdHJlZSA9IG5ldyBUcmVlU3ByaXRlKHRoaXMuc2NlbmUsIFBoYXNlci5NYXRoLkJldHdlZW4oMSwgNiksIGRhdGEucmVxdWVzdC5saWdodCkuc2hvdygpLnNldFgoc2NvcGUua2VlcCArIHRyZWVTcGFjZSk7XHJcbiAgICAgICAgICAgIHNjb3BlLmtlZXAgKz0gdHJlZS53aWR0aCArIHRyZWVTcGFjZTtcclxuICAgICAgICAgICAgY29udGFpbmVyLmFkZCh0cmVlKTtcclxuICAgICAgICAgICAgaWYgKCFkYXRhLnJlcXVlc3QucG9sZS5zdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgIC8vIGFkZCBiZW5jaFxyXG4gICAgICAgICAgICAgICAgaWYgKFBoYXNlci5NYXRoLkJldHdlZW4oMSwgMikgPT0gMikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBiZW5jaFNwYWNlID0gUGhhc2VyLk1hdGguQmV0d2VlbigxMCwgMjApO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBiZW5jaCA9IG5ldyBCZW5jaFNwcml0ZSh0aGlzLnNjZW5lKS5zaG93KCkuc2V0WChzY29wZS5rZWVwICsgYmVuY2hTcGFjZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2NvcGUua2VlcCArPSBiZW5jaC5kaXNwbGF5V2lkdGggKyBiZW5jaFNwYWNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnRhaW5lci5hZGQoYmVuY2gpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgLy8gYWRkIHBvbGVcclxuICAgICAgICAgICAgICAgIGxldCBwb2xlU3BhY2UgPSBQaGFzZXIuTWF0aC5CZXR3ZWVuKDUsIDE1KTtcclxuICAgICAgICAgICAgICAgIGxldCBwb2xlID0gbmV3IFBvbGVTcHJpdGUodGhpcy5zY2VuZSwgZGF0YS5yZXF1ZXN0LnBvbGUubW9yZSkuc2hvdygpLnNldFgoc2NvcGUua2VlcCArIHBvbGVTcGFjZSk7XHJcbiAgICAgICAgICAgICAgICBzY29wZS5rZWVwICs9IHBvbGUuZGlzcGxheVdpZHRoICsgcG9sZVNwYWNlO1xyXG4gICAgICAgICAgICAgICAgY29udGFpbmVyLmFkZChwb2xlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBsZXQgbGFtcHMgPSBbXTtcclxuICAgICAgICAgICAgLy8gYWRkIGN1cnJlY3QgbGFtcHNcclxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggaW4gZGF0YS5jdXJyZWN0KSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbGFtcFNwYWNlID0gUGhhc2VyLk1hdGguQmV0d2VlbigxMCwgMjApO1xyXG4gICAgICAgICAgICAgICAgbGV0IGxhbXBJdGVtID0gbmV3IExhbXBTcHJpdGUodGhpcy5zY2VuZSwgZGF0YS5jdXJyZWN0W2luZGV4XSwgUGhhc2VyLlV0aWxzLkFycmF5LkdldFJhbmRvbShbZmFsc2UsIHRydWVdKSwgdHJ1ZSlcclxuICAgICAgICAgICAgICAgICAgICAuc2hvdygpXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldEZsaXBYKChkYXRhLmN1cnJlY3RbaW5kZXhdID09IDEgPyBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFtmYWxzZSwgdHJ1ZV0pIDogZmFsc2UpKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRYKHNjb3BlLmtlZXAgKyBsYW1wU3BhY2UpO1xyXG4gICAgICAgICAgICAgICAgc2NvcGUua2VlcCArPSBsYW1wSXRlbS5kaXNwbGF5V2lkdGggKyBsYW1wU3BhY2U7XHJcbiAgICAgICAgICAgICAgICBsYW1wcy5wdXNoKGxhbXBJdGVtKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBhZGQgd3JvbmcgbGFtcHNcclxuICAgICAgICAgICAgZm9yIChsZXQgaW5kZXggaW4gZGF0YS53cm9uZykge1xyXG4gICAgICAgICAgICAgICAgaWYgKHNjb3BlLmtlZXAgPD0gbWF4V2lkdGgpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbGFtcFNwYWNlID0gUGhhc2VyLk1hdGguQmV0d2VlbigxMCwgMjApO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBsYW1wSXRlbSA9IG5ldyBMYW1wU3ByaXRlKHRoaXMuc2NlbmUsIGRhdGEud3JvbmdbaW5kZXhdLCBQaGFzZXIuVXRpbHMuQXJyYXkuR2V0UmFuZG9tKFtmYWxzZSwgdHJ1ZV0pLCBmYWxzZSlcclxuICAgICAgICAgICAgICAgICAgICAgICAgLnNob3coKVxyXG4gICAgICAgICAgICAgICAgICAgICAgICAuc2V0RmxpcFgoKGRhdGEuY3VycmVjdFtpbmRleF0gPT0gMSA/IFBoYXNlci5VdGlscy5BcnJheS5HZXRSYW5kb20oW2ZhbHNlLCB0cnVlXSkgOiBmYWxzZSkpXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC5zZXRYKHNjb3BlLmtlZXAgKyBsYW1wU3BhY2UpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNjb3BlLmtlZXAgKz0gbGFtcEl0ZW0uZGlzcGxheVdpZHRoICsgbGFtcFNwYWNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGxhbXBzLnB1c2gobGFtcEl0ZW0pO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGNvbnRhaW5lci5hZGQobGFtcHMpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBjb250YWluZXIueCA9ICgoc2NvcGUuZWwud2lkdGggLSBzY29wZS5rZWVwKSAvIDIpO1xyXG4gICAgfVxyXG4gICAgcmVtb3ZlQ29udGVudChzY29wZSkge1xyXG4gICAgICAgIHNjb3BlLnN0YXR1cyA9IFwicGF1c2VcIjtcclxuICAgICAgICBsZXQgZ2FtZU92ZXIgPSBmYWxzZTtcclxuICAgICAgICBzY29wZS5lbC5sYXN0LmVhY2goKGNoaWxkKSA9PiB7XHJcbiAgICAgICAgICAgIGNoaWxkLnNldEFscGhhKDAuMyk7XHJcbiAgICAgICAgICAgIGlmIChjaGlsZC5nYW1lQ2hlY2spIHtcclxuICAgICAgICAgICAgICAgIGlmIChjaGlsZC5pc0N1cnJlY3QgIT0gY2hpbGQubGlnaHRTdGF0dXMpIHtcclxuICAgICAgICAgICAgICAgICAgICBjaGlsZC5zZXRBbHBoYSgxKS5zZXRUaW50RmlsbCgweGZmMDAwMCwgMHgwMDAwMDApO1xyXG4gICAgICAgICAgICAgICAgICAgIGdhbWVPdmVyID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIGlmIChnYW1lT3Zlcikge1xyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnBhdXNlU3BhY2UoKTtcclxuXHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLm9uZS5zdGF0dXMgPT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnNjb3BlLm9uZS5lbCxcclxuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLnNjZW5lLmdhbWUuY29uZmlnLndpZHRoICogMS4yLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA4MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZWFzZTogUGhhc2VyLk1hdGguRWFzaW5nLkJhY2suSW5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLnR3by5zdGF0dXMgPT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnNjb3BlLnR3by5lbCxcclxuICAgICAgICAgICAgICAgICAgICB4OiB0aGlzLnNjZW5lLmdhbWUuY29uZmlnLndpZHRoICogMS4yLFxyXG4gICAgICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA4MDAsXHJcbiAgICAgICAgICAgICAgICAgICAgZWFzZTogUGhhc2VyLk1hdGguRWFzaW5nLkJhY2suSW5cclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmICh0aGlzLnNjb3BlLnRocmVlLnN0YXR1cyA9PSBcImFjdGl2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMuc2NvcGUudGhyZWUuZWwsXHJcbiAgICAgICAgICAgICAgICAgICAgeDogdGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAqIDEuMixcclxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogODAwLFxyXG4gICAgICAgICAgICAgICAgICAgIGVhc2U6IFBoYXNlci5NYXRoLkVhc2luZy5CYWNrLkluXHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgdGFyZ2V0czogc2NvcGUuZWwsXHJcbiAgICAgICAgICAgICAgICB4OiAwLFxyXG4gICAgICAgICAgICAgICAgZGVsYXk6IDgwMCxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiA4MDAsXHJcbiAgICAgICAgICAgICAgICBlYXNlOiBQaGFzZXIuTWF0aC5FYXNpbmcuQmFjay5PdXRcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUudGltZS5hZGRFdmVudCh7XHJcbiAgICAgICAgICAgICAgICBkZWxheTogMTAwMCxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS50aXRsZS5zZXRUZXh0KFwiR2FtZSBPdmVyXCIpLnNldERlcHRoKDIwKS5zZXRUaW50RmlsbCgweGZmMDAwMCwgMHgwMDAwMDApO1xyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrU2NvcGU6IHRoaXMuc2NlbmVcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIHRoaXMuc2NlbmUudGltZS5hZGRFdmVudCh7XHJcbiAgICAgICAgICAgICAgICBkZWxheTogNjAwMCxcclxuICAgICAgICAgICAgICAgIGNhbGxiYWNrOiAoKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5zY2VuZS5zdGFydChcIkJvb3RcIik7XHJcbiAgICAgICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2tTY29wZTogdGhpcy5zY2VuZVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBzY29wZS5lbC54ID0gTWF0aC5hYnModGhpcy5saW1pdCk7XHJcbiAgICAgICAgICAgIHNjb3BlLmVsLnJlbW92ZUFsbCh0cnVlKTtcclxuICAgICAgICAgICAgc2NvcGUua2VlcCA9IDIwO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHJ1bihzcGVlZCA9IDApIHtcclxuICAgICAgICBpZiAoc3BlZWQpIHtcclxuICAgICAgICAgICAgdGhpcy5sZXZlbC5zY29yZSArPSBzcGVlZDtcclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUub25lLnN0YXR1cyA9PSBcImFjdGl2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLm9uZS5lbC54IC09IHNwZWVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUub25lLmVsLnggPD0gdGhpcy5saW1pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUuYXZhaWxhYmxlID0gXCJvbmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLnRocmVlLnN0YXR1cyA9IFwiYWN0aXZlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5yZW1vdmVDb250ZW50KHRoaXMuc2NvcGUub25lKTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLmFkZENvbnRlbnQodGhpcy5zY29wZS50aHJlZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUudHdvLnN0YXR1cyA9PSBcImFjdGl2ZVwiKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLnR3by5lbC54IC09IHNwZWVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUudHdvLmVsLnggPD0gdGhpcy5saW1pdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NvcGUuYXZhaWxhYmxlID0gXCJ0d29cIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjb3BlLm9uZS5zdGF0dXMgPSBcImFjdGl2ZVwiO1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMucmVtb3ZlQ29udGVudCh0aGlzLnNjb3BlLnR3byk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250ZW50KHRoaXMuc2NvcGUub25lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAodGhpcy5zY29wZS50aHJlZS5zdGF0dXMgPT0gXCJhY3RpdmVcIikge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY29wZS50aHJlZS5lbC54IC09IHNwZWVkO1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NvcGUudGhyZWUuZWwueCA8PSB0aGlzLmxpbWl0KSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS5hdmFpbGFibGUgPSBcInRocmVlXCI7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY29wZS50d28uc3RhdHVzID0gXCJhY3RpdmVcIjtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnJlbW92ZUNvbnRlbnQodGhpcy5zY29wZS50aHJlZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5hZGRDb250ZW50KHRoaXMuc2NvcGUudHdvKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0aGlzLnNjZW5lLnRpdGxlLnNldFRleHQoTWF0aC5yb3VuZCh0aGlzLmxldmVsLnNjb3JlIC8gMTApLnRvU3RyaW5nKCkucGFkU3RhcnQoNSwgXCIwXCIpKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBhcmVhKHNjb3BlLCBjb2xvcikge1xyXG4gICAgICAgIHNjb3BlLnNldFNpemUodGhpcy5zY2VuZS5nYW1lLmNvbmZpZy53aWR0aCAtIDQwLCAodGhpcy5zY2VuZS5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgpIC0gNDApXHJcbiAgICAgICAgaWYgKGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGxldCBhcmVhU3RhcnQgPSB0aGlzLnNjZW5lLmFkZC5ncmFwaGljcygwLCAwKVxyXG4gICAgICAgICAgICAgICAgLmZpbGxTdHlsZShjb2xvciwgMC41KVxyXG4gICAgICAgICAgICAgICAgLmZpbGxSZWN0KDEwLCAxMCwgMiwgc2NvcGUuaGVpZ2h0ICsgMjApO1xyXG4gICAgICAgICAgICBsZXQgYXJlYUVuZCA9IHRoaXMuc2NlbmUuYWRkLmdyYXBoaWNzKDAsIDApXHJcbiAgICAgICAgICAgICAgICAuZmlsbFN0eWxlKGNvbG9yLCAwLjUpXHJcbiAgICAgICAgICAgICAgICAuZmlsbFJlY3Qoc2NvcGUud2lkdGggKyAyMCwgMTAsIDIsIHNjb3BlLmhlaWdodCArIDIwKTtcclxuICAgICAgICAgICAgc2NvcGUuYWRkKFthcmVhU3RhcnQsIGFyZWFFbmRdKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gUGxhdGZvcm07IiwiY2xhc3MgUG9sZSBleHRlbmRzIFBoYXNlci5HYW1lT2JqZWN0cy5TcHJpdGUge1xyXG4gICAgY29uc3RydWN0b3Ioc2NlbmUsIHR5cGUgPSBcIjBcIikge1xyXG4gICAgICAgIGxldCBwb2xlVHlwZSA9IHtcclxuICAgICAgICAgICAgXCItMlwiOiBcIi0yXCIsXHJcbiAgICAgICAgICAgIFwiLTFcIjogXCItMVwiLFxyXG4gICAgICAgICAgICBcIjBcIjogXCJcIixcclxuICAgICAgICAgICAgXCIxXCI6IFwiKzFcIixcclxuICAgICAgICAgICAgXCIyXCI6IFwiKzJcIlxyXG4gICAgICAgIH07XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIHNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCwgYHBvbGUke3BvbGVUeXBlW3R5cGVdfWApO1xyXG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuICAgICAgICB0aGlzLnNldE9yaWdpbigwLCAwLjk3KVxyXG4gICAgICAgICAgICAuc2V0U2NhbGUoKHRoaXMuc2NlbmUuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDAuOCA6IDAuNikpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCg0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2hvdygpIHtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQb2xlOyIsImNsYXNzIFRyZWUgZXh0ZW5kcyBQaGFzZXIuR2FtZU9iamVjdHMuQ29udGFpbmVyIHtcclxuICAgIGNvbnN0cnVjdG9yKHNjZW5lLCB0eXBlID0gXCIxXCIsIGxpZ2h0Q291bnQgPSAwKSB7XHJcbiAgICAgICAgc3VwZXIoc2NlbmUsIDAsIHNjZW5lLmdhbWUuY29uZmlnLmhlaWdodCAqIDAuOCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZSA9IHNjZW5lO1xyXG4gICAgICAgIGxldCB0cmVlID0gdGhpcy5zY2VuZS5hZGQuc3ByaXRlKDAsIDAsIGB0cmVlJHt0eXBlfWApXHJcbiAgICAgICAgICAgIC5zZXRTY2FsZSgodGhpcy5zY2VuZS5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMC43IDogMC41KSlcclxuICAgICAgICAgICAgLnNldE9yaWdpbigwLCAwLjkxKTtcclxuICAgICAgICB0aGlzLmFkZCh0cmVlKTtcclxuICAgICAgICBpZiAobGlnaHRDb3VudCA8IDAgfHwgbGlnaHRDb3VudCA+IDQpIHtcclxuICAgICAgICAgICAgbGlnaHRDb3VudCA9IDA7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChsaWdodENvdW50KSB7XHJcbiAgICAgICAgICAgIGxldCBjb3VudCA9IHtcclxuICAgICAgICAgICAgICAgIHc6IDIwMCxcclxuICAgICAgICAgICAgICAgIGg6IDIzMFxyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgICAgICBzd2l0Y2ggKGxpZ2h0Q291bnQpIHtcclxuICAgICAgICAgICAgICAgIGNhc2UgMjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50LncgKj0gMjtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgMzoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50LncgKj0gMztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGNhc2UgNDoge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvdW50LncgKj0gMjtcclxuICAgICAgICAgICAgICAgICAgICBjb3VudC5oICo9IDI7XHJcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgbGV0IGxpZ2h0ID0gdGhpcy5zY2VuZS5hZGQudGlsZVNwcml0ZSh0cmVlLmRpc3BsYXlXaWR0aCAvIDIsICh0cmVlLmRpc3BsYXlIZWlnaHQgKiAtMSksIGNvdW50LncsIGNvdW50LmgsIFwibGlnaHRcIilcclxuICAgICAgICAgICAgICAgIC5zZXRTY2FsZSgwLjEzKVxyXG4gICAgICAgICAgICAgICAgLnNldE9yaWdpbigwLjUsIDEpO1xyXG4gICAgICAgICAgICB0aGlzLmFkZChsaWdodCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuc2V0RGVwdGgoNCkuc2V0U2l6ZSh0cmVlLmRpc3BsYXlXaWR0aCwgdHJlZS5kaXNwbGF5SGVpZ2h0KTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHJldHVybiB0aGlzO1xyXG4gICAgfVxyXG4gICAgc2hvdygpIHtcclxuICAgICAgICB0aGlzLnNjZW5lLmFkZC5leGlzdGluZyh0aGlzKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBUcmVlOyIsImNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZShcIi4vZ2FtZU9iamVjdC9wbGF0Zm9ybVwiKTtcclxuXHJcbmNsYXNzIFNjZW5lIGV4dGVuZHMgUGhhc2VyLlNjZW5lIHtcclxuICAgIGNvbnN0cnVjdG9yKG5hbWUpIHtcclxuICAgICAgICBzdXBlcihuYW1lKTtcclxuICAgICAgICB0aGlzLm5hbWUgPSBuYW1lO1xyXG4gICAgICAgIHRoaXMua2VlcExvZyA9IFtdO1xyXG4gICAgICAgIHRoaXMubG9jayA9IHRydWU7XHJcbiAgICAgICAgdGhpcy5oZWxwT3BlbiA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgbG9nKG1lc3NhZ2UgPSBudWxsLCBzeXN0ZW0gPSBmYWxzZSkge1xyXG4gICAgICAgIGlmICh0aGlzLmdhbWUuZGVidWcgJiYgbWVzc2FnZSkge1xyXG4gICAgICAgICAgICB0aGlzLmtlZXBMb2cucHVzaCh7XHJcbiAgICAgICAgICAgICAgICBtZXNzYWdlLFxyXG4gICAgICAgICAgICAgICAgYnlTeXN0ZW06IHN5c3RlbVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMua2VlcExvZztcclxuICAgIH1cclxuICAgIGluaXQoKSB7XHJcbiAgICAgICAgdGhpcy5sb2coXCJpbml0XCIsIHRydWUpO1xyXG4gICAgfVxyXG4gICAgcHJlbG9hZCgpIHtcclxuICAgICAgICB0aGlzLmxvZyhcInByZWxvYWRcIiwgdHJ1ZSk7XHJcbiAgICB9XHJcbiAgICBjcmVhdGUoKSB7XHJcbiAgICAgICAgLy8gYWRkIGdyb3VuZFxyXG4gICAgICAgIHRoaXMuZ3JvdW5kID0gdGhpcy5hZGQudGlsZVNwcml0ZSgtMiwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKyAyLCB0aGlzLmdhbWUuY29uZmlnLndpZHRoICsgNCwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjIsIFwiZ3JvdW5kXCIpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMSlcclxuICAgICAgICAgICAgLnNldFRpbGVTY2FsZSgodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gMSA6IDAuNikpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCgwKTtcclxuICAgICAgICB0aGlzLmdyb3VuZC5zcGVlZCA9IHtcclxuICAgICAgICAgICAgY3VycmVudDogMCxcclxuICAgICAgICAgICAgcGF1c2U6IDAsXHJcbiAgICAgICAgICAgIG1pbjogKHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDIuNSA6IDIpLFxyXG4gICAgICAgICAgICBtaWQ6ICh0aGlzLmdhbWUuZGV2aWNlLm9zLmRlc2t0b3AgPyAzLjUgOiAzKSxcclxuICAgICAgICAgICAgbWF4OiAodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gNC41IDogNCksXHJcbiAgICAgICAgfTtcclxuICAgICAgICAvLyBhZGQgY2l0eVxyXG4gICAgICAgIHRoaXMuY2l0eSA9IHRoaXMuYWRkLnRpbGVTcHJpdGUoMCwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgsIHRoaXMuZ2FtZS5jb25maWcud2lkdGgsIDEwOSwgXCJjaXR5XCIpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMCwgMSlcclxuICAgICAgICAgICAgLnNldERlcHRoKDEpO1xyXG4gICAgICAgIHRoaXMuY2l0eS5zcGVlZCA9IHtcclxuICAgICAgICAgICAgY3VycmVudDogMCxcclxuICAgICAgICAgICAgcGF1c2U6IDAsXHJcbiAgICAgICAgICAgIG1pbjogMC4yLFxyXG4gICAgICAgICAgICBtaWQ6IDAuNCxcclxuICAgICAgICAgICAgbWF4OiAwLjZcclxuICAgICAgICB9O1xyXG4gICAgICAgIHRoaXMubGluZSA9IHRoaXMuYWRkLmdyYXBoaWNzKDAsIDApXHJcbiAgICAgICAgICAgIC5maWxsU3R5bGUoMHhmNGQyNDIsIDEpXHJcbiAgICAgICAgICAgIC5maWxsUmVjdCgwLCAodGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgpLCB0aGlzLmdhbWUuY29uZmlnLndpZHRoLCAzKVxyXG4gICAgICAgICAgICAuc2V0RGVwdGgoMSk7XHJcbiAgICAgICAgLy8gYWRkIGNsb3VkXHJcbiAgICAgICAgdGhpcy5jbG91ZCA9IHRoaXMuYWRkLnRpbGVTcHJpdGUoMCwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjYsIHRoaXMuZ2FtZS5jb25maWcud2lkdGgsIDEwNSwgXCJjbG91ZFwiKVxyXG4gICAgICAgICAgICAuc2V0T3JpZ2luKDAsIDEpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCgyKTtcclxuICAgICAgICB0aGlzLmNsb3VkLnNwZWVkID0ge1xyXG4gICAgICAgICAgICBjdXJyZW50OiAwLFxyXG4gICAgICAgICAgICBwYXVzZTogMCxcclxuICAgICAgICAgICAgbWluOiAtMC40LFxyXG4gICAgICAgICAgICBtaWQ6IC0wLjYsXHJcbiAgICAgICAgICAgIG1heDogLTAuOFxyXG4gICAgICAgIH07XHJcbiAgICAgICAgLy8gbG9hZCBwbGF0Zm9ybVxyXG4gICAgICAgIHRoaXMudGl0bGUgPSB0aGlzLmFkZC50ZXh0KHRoaXMuZ2FtZS5jb25maWcud2lkdGggKiAwLjUsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC4xNSwgXCJcIiwge1xyXG4gICAgICAgICAgICBmb250OiBgJHsodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gXCIxNjBcIiA6IFwiMTAwXCIpfXB4ICcke3RoaXMuZ2FtZS5mb250fSdgLFxyXG4gICAgICAgICAgICBmaWxsOiBcIiNGRkY4RUVcIlxyXG4gICAgICAgIH0pLnNldE9yaWdpbigwLjUpO1xyXG4gICAgICAgIC8vIGFkZCBoZWxwXHJcbiAgICAgICAgdGhpcy5oZWxwQnRuID0gdGhpcy5hZGQudGV4dCgyNSwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgLSAyMCwgXCI/XCIsIHtcclxuICAgICAgICAgICAgZm9udDogYCR7KHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IFwiNDBcIiA6IFwiMzBcIil9cHggJyR7dGhpcy5nYW1lLmZvbnR9J2AsXHJcbiAgICAgICAgICAgIGZpbGw6IFwiI0ZGRjhFRVwiXHJcbiAgICAgICAgfSkuc2V0T3JpZ2luKDAsIDEpXHJcbiAgICAgICAgICAgIC5zZXRJbnRlcmFjdGl2ZSgpXHJcbiAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICghdGhpcy5oZWxwT3Blbikge1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuc2NlbmUuc3RhcnQoXCJIZWxwXCIpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjZW5lLnN0YXJ0KFwiQm9vdFwiKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfSwgdGhpcyk7XHJcbiAgICAgICAgLy8gYWRkIGZ1bGxzY3JlZW5cclxuICAgICAgICB0aGlzLmZ1bGxzY3JlZW5CdG4gPSB0aGlzLmFkZC50ZXh0KHRoaXMuZ2FtZS5jb25maWcud2lkdGggLSAyNSwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgLSAyMCwgXCLijppcIiwge1xyXG4gICAgICAgICAgICBmb250OiBgJHsodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gXCI0MFwiIDogXCIzMFwiKX1weCAnJHt0aGlzLmdhbWUuZm9udH0nYCxcclxuICAgICAgICAgICAgZmlsbDogXCIjRkZGOEVFXCJcclxuICAgICAgICB9KS5zZXRPcmlnaW4oMSwgMSlcclxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKClcclxuICAgICAgICAgICAgLm9uKFwicG9pbnRlcmRvd25cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaWYgKHRoaXMuc2NhbGUuaXNGdWxsc2NyZWVuKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2FsZS5zdG9wRnVsbHNjcmVlbigpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLnNjYWxlLnN0YXJ0RnVsbHNjcmVlbigpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9LCB0aGlzKTtcclxuICAgICAgICAvLyBlbmQgb2Ygc2NlbmVcclxuICAgICAgICB0aGlzLmxvZyhcImNyZWF0ZVwiLCB0cnVlKTtcclxuICAgICAgICB0aGlzLmdhbWUuc2NlbmVMb2codGhpcy5uYW1lLCB0aGlzLmtlZXBMb2cpO1xyXG4gICAgfVxyXG4gICAgdXBkYXRlKCkge1xyXG4gICAgICAgIGlmICh0aGlzLmxvY2spIHJldHVybjtcclxuICAgICAgICBpZiAodGhpcy5ncm91bmQuc3BlZWQuY3VycmVudCkge1xyXG4gICAgICAgICAgICB0aGlzLnBsYXRmb3JtLnJ1bih0aGlzLmdyb3VuZC5zcGVlZC5jdXJyZW50KTtcclxuICAgICAgICAgICAgdGhpcy5ncm91bmQudGlsZVBvc2l0aW9uWCArPSAodGhpcy5nYW1lLmRldmljZS5vcy5kZXNrdG9wID8gdGhpcy5ncm91bmQuc3BlZWQuY3VycmVudCA6IHRoaXMuZ3JvdW5kLnNwZWVkLmN1cnJlbnQgKiAxLjYpO1xyXG4gICAgICAgICAgICBpZiAodGhpcy5jaXR5LnNwZWVkLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgICAgIHRoaXMuY2l0eS50aWxlUG9zaXRpb25YICs9IHRoaXMuY2l0eS5zcGVlZC5jdXJyZW50O1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aGlzLmNsb3VkLnNwZWVkLmN1cnJlbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5jbG91ZC50aWxlUG9zaXRpb25YICs9IHRoaXMuY2xvdWQuc3BlZWQuY3VycmVudDtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gU2NlbmU7IiwiY29uc3QgU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmVcIik7XHJcblxyXG5jbGFzcyBCb290IGV4dGVuZHMgU2NlbmUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJCb290XCIpO1xyXG4gICAgfVxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBzdXBlci5pbml0KCk7XHJcbiAgICB9XHJcbiAgICBwcmVsb2FkKCkge1xyXG4gICAgICAgIHN1cGVyLnByZWxvYWQoKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJncm91bmRcIiwgXCJkYXRhL2dyb3VuZC5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiY2l0eVwiLCBcImRhdGEvY2l0eS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwiY2xvdWRcIiwgXCJkYXRhL2Nsb3VkLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJwbGF5XCIsIFwiZGF0YS9wbGF5LnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJoZWxwXCIsIFwiZGF0YS9oZWxwLnBuZ1wiKTtcclxuICAgICAgICAvL1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInRyZWUxXCIsIFwiZGF0YS90cmVlMS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwidHJlZTJcIiwgXCJkYXRhL3RyZWUyLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJ0cmVlM1wiLCBcImRhdGEvdHJlZTMucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInRyZWU0XCIsIFwiZGF0YS90cmVlNC5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwidHJlZTVcIiwgXCJkYXRhL3RyZWU1LnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJ0cmVlNlwiLCBcImRhdGEvdHJlZTYucG5nXCIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwibGlnaHRcIiwgXCJkYXRhL2xpZ2h0LnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJiZW5jaFwiLCBcImRhdGEvYmVuY2gucG5nXCIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicG9sZVwiLCBcImRhdGEvcG9sZS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicG9sZS0xXCIsIFwiZGF0YS9wb2xlLTEucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcInBvbGUtMlwiLCBcImRhdGEvcG9sZS0yLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJwb2xlKzFcIiwgXCJkYXRhL3BvbGUrMS5wbmdcIik7XHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwicG9sZSsyXCIsIFwiZGF0YS9wb2xlKzIucG5nXCIpO1xyXG4gICAgICAgIC8vXHJcbiAgICAgICAgdGhpcy5sb2FkLmltYWdlKFwibGFtcC0xLW9uXCIsIFwiZGF0YS9sYW1wLTEtb24ucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImxhbXAtMS1vZmZcIiwgXCJkYXRhL2xhbXAtMS1vZmYucG5nXCIpO1xyXG4gICAgICAgIHRoaXMubG9hZC5pbWFnZShcImxhbXAtMi1vblwiLCBcImRhdGEvbGFtcC0yLW9uLnBuZ1wiKTtcclxuICAgICAgICB0aGlzLmxvYWQuaW1hZ2UoXCJsYW1wLTItb2ZmXCIsIFwiZGF0YS9sYW1wLTItb2ZmLnBuZ1wiKTtcclxuICAgIH1cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICBzdXBlci5jcmVhdGUoKTtcclxuICAgICAgICAvLyBtdXNpY1xyXG4gICAgICAgIHRoaXMubG9hZC5hdWRpbyhcIm11c2ljXCIsIFwiZGF0YS9tdXNpYy5tcDNcIikub24oXCJmaWxlY29tcGxldGVcIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICB0aGlzLnNvdW5kLmFkZChcIm11c2ljXCIsIHtcclxuICAgICAgICAgICAgICAgIHZvbHVtZTogMSxcclxuICAgICAgICAgICAgICAgIGxvb3A6IHRydWVcclxuICAgICAgICAgICAgfSkucGxheSgpXHJcbiAgICAgICAgfSkuc3RhcnQoKTtcclxuICAgICAgICB0aGlzLmhlbHBPcGVuID0gZmFsc2U7XHJcbiAgICAgICAgaWYgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ID4gdGhpcy5nYW1lLmNvbmZpZy53aWR0aCkge1xyXG4gICAgICAgICAgICB0aGlzLnRpdGxlLnNldFRleHQoXCJSb3RhdGUhXCIpXHJcbiAgICAgICAgICAgICAgICAuc2V0RGVwdGgoMjApXHJcbiAgICAgICAgICAgICAgICAuc2V0VGludEZpbGwoMHhmZjAwMDAsIDB4MDAwMDAwKVxyXG4gICAgICAgICAgICAgICAgLnNldFBvc2l0aW9uKHRoaXMuZ2FtZS5jb25maWcud2lkdGggLyAyLCAodGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgKiAwLjgpIC8gMik7XHJcbiAgICAgICAgICAgIHRoaXMudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgc2NhbGU6IHsgZnJvbTogMC45NSwgdG86IDEuMDUgfSxcclxuICAgICAgICAgICAgICAgIGR1cmF0aW9uOiAxNTAsXHJcbiAgICAgICAgICAgICAgICB5b3lvOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBpZiAodGhpcy5nYW1lLmNvbmZpZy53aWR0aCA8IDQ4MCB8fCB0aGlzLmdhbWUuY29uZmlnLmhlaWdodCA8IDMyMCkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZS5zZXRUZXh0KFwiU2NyZWVuIVwiKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXREZXB0aCgyMClcclxuICAgICAgICAgICAgICAgICAgICAuc2V0VGludEZpbGwoMHhmZjAwMDAsIDB4MDAwMDAwKVxyXG4gICAgICAgICAgICAgICAgICAgIC5zZXRQb3NpdGlvbih0aGlzLmdhbWUuY29uZmlnLndpZHRoIC8gMiwgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC44KSAvIDIpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy50d2VlbnMuYWRkKHtcclxuICAgICAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgICAgIHNjYWxlOiB7IGZyb206IDAuOTUsIHRvOiAxLjA1IH0sXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MCxcclxuICAgICAgICAgICAgICAgICAgICB5b3lvOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdDogLTFcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy50aXRsZS5zZXRUZXh0KFwiTGlnaHQgVHJlZVwiKS5zZXRUaW50RmlsbCgweGY0ZDI0Mik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmJ0biA9IHRoaXMuYWRkLnNwcml0ZSgwLCAwLCBcInBsYXlcIilcclxuICAgICAgICAgICAgICAgICAgICAuc2V0T3JpZ2luKDAuNSlcclxuICAgICAgICAgICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy5nYW1lLmNvbmZpZy53aWR0aCAvIDIsICh0aGlzLmdhbWUuY29uZmlnLmhlaWdodCAvIDIpICsgKHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0ICogMC4xKSlcclxuICAgICAgICAgICAgICAgICAgICAuc2V0RGVwdGgoMTApXHJcbiAgICAgICAgICAgICAgICAgICAgLnNldFNjYWxlKDAuMylcclxuICAgICAgICAgICAgICAgICAgICAuc2V0SW50ZXJhY3RpdmUoKVxyXG4gICAgICAgICAgICAgICAgICAgIC5vbihcInBvaW50ZXJkb3duXCIsICgpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5zdGFydChcIlBsYXlcIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfSwgdGhpcyk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMuYnRuLFxyXG4gICAgICAgICAgICAgICAgICAgIHg6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZnJvbTogdGhpcy5nYW1lLmNvbmZpZy53aWR0aCAqIDAuNDk3LFxyXG4gICAgICAgICAgICAgICAgICAgICAgICB0bzogdGhpcy5nYW1lLmNvbmZpZy53aWR0aCAqIDAuNTAzXHJcbiAgICAgICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICAgICBkdXJhdGlvbjogMzAwLFxyXG4gICAgICAgICAgICAgICAgICAgIHlveW86IHRydWUsXHJcbiAgICAgICAgICAgICAgICAgICAgcmVwZWF0OiAtMVxyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbn1cclxuXHJcbm1vZHVsZS5leHBvcnRzID0gQm9vdDsiLCJjb25zdCBTY2VuZSA9IHJlcXVpcmUoXCIuLi9zY2VuZVwiKTtcclxuXHJcbmNsYXNzIEhlbHAgZXh0ZW5kcyBTY2VuZSB7XHJcbiAgICBjb25zdHJ1Y3RvcigpIHtcclxuICAgICAgICBzdXBlcihcIkhlbHBcIik7XHJcbiAgICB9XHJcbiAgICBpbml0KCkge1xyXG4gICAgICAgIHN1cGVyLmluaXQoKTtcclxuICAgIH1cclxuICAgIHByZWxvYWQoKSB7XHJcbiAgICAgICAgc3VwZXIucHJlbG9hZCgpO1xyXG5cclxuICAgIH1cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICBzdXBlci5jcmVhdGUoKTtcclxuICAgICAgICAvLyBoaWRlIGJvb3Qgc2NlbmUgb2JqZWN0XHJcbiAgICAgICAgdGhpcy5ncm91bmQuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5jaXR5LnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuY2xvdWQuc2V0VmlzaWJsZShmYWxzZSk7XHJcbiAgICAgICAgdGhpcy5saW5lLnNldFZpc2libGUoZmFsc2UpO1xyXG4gICAgICAgIHRoaXMuZnVsbHNjcmVlbkJ0bi5zZXRWaXNpYmxlKGZhbHNlKTtcclxuICAgICAgICAvLyBhZGQgaGVscCBpbWFnZVxyXG4gICAgICAgIHRoaXMuaGVscEltYWdlID0gdGhpcy5hZGQuaW1hZ2UoMCwgMCwgXCJoZWxwXCIpXHJcbiAgICAgICAgICAgIC5zZXRPcmlnaW4oMC41KVxyXG4gICAgICAgICAgICAuc2V0U2NhbGUoKHRoaXMuZ2FtZS5kZXZpY2Uub3MuZGVza3RvcCA/IDAuNiA6IDAuNCkpXHJcbiAgICAgICAgICAgIC5zZXREZXB0aCg1KVxyXG4gICAgICAgICAgICAuc2V0UG9zaXRpb24odGhpcy5nYW1lLmNvbmZpZy53aWR0aCAvIDIsIHRoaXMuZ2FtZS5jb25maWcuaGVpZ2h0IC8gMilcclxuICAgICAgICAgICAgLnNldEludGVyYWN0aXZlKClcclxuICAgICAgICAgICAgLm9uKFwicG9pbnRlcmRvd25cIiwgKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5zY2VuZS5zdGFydChcIkJvb3RcIik7XHJcbiAgICAgICAgICAgIH0sIHRoaXMpO1xyXG4gICAgICAgIHRoaXMuaGVscE9wZW4gPSB0cnVlO1xyXG4gICAgICAgIHRoaXMuaGVscEJ0bi5zZXRUZXh0KFwiwqtcIikuc2V0VGludEZpbGwoMHgwMDAwMDApO1xyXG4gICAgfVxyXG59XHJcblxyXG5tb2R1bGUuZXhwb3J0cyA9IEhlbHA7IiwiY29uc3QgU2NlbmUgPSByZXF1aXJlKFwiLi4vc2NlbmVcIik7XHJcbmNvbnN0IFBsYXRmb3JtID0gcmVxdWlyZShcIi4uL2dhbWVPYmplY3QvcGxhdGZvcm1cIik7XHJcblxyXG5jbGFzcyBQbGF5IGV4dGVuZHMgU2NlbmUge1xyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgc3VwZXIoXCJQbGF5XCIpO1xyXG4gICAgICAgIHRoaXMubG9jayA9IGZhbHNlO1xyXG4gICAgfVxyXG4gICAgaW5pdCgpIHtcclxuICAgICAgICBzdXBlci5pbml0KCk7XHJcbiAgICB9XHJcbiAgICBwcmVsb2FkKCkge1xyXG4gICAgICAgIHN1cGVyLnByZWxvYWQoKTtcclxuICAgIH1cclxuICAgIGNyZWF0ZSgpIHtcclxuICAgICAgICBzdXBlci5jcmVhdGUoKTtcclxuICAgICAgICB0aGlzLmxvY2sgPSBmYWxzZTtcclxuICAgICAgICB0aGlzLmhlbHBPcGVuID0gZmFsc2U7XHJcbiAgICAgICAgdGhpcy5wbGF0Zm9ybSA9IG5ldyBQbGF0Zm9ybSh0aGlzKTtcclxuICAgICAgICBpZiAodGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgPiB0aGlzLmdhbWUuY29uZmlnLndpZHRoKSB7XHJcbiAgICAgICAgICAgIHRoaXMudGl0bGUuc2V0VGV4dChcIlJvdGF0ZSFcIik7XHJcbiAgICAgICAgICAgIHRoaXMudHdlZW5zLmFkZCh7XHJcbiAgICAgICAgICAgICAgICB0YXJnZXRzOiB0aGlzLnRpdGxlLFxyXG4gICAgICAgICAgICAgICAgYW5nbGU6IHsgZnJvbTogLTUsIHRvOiA1IH0sXHJcbiAgICAgICAgICAgICAgICBkdXJhdGlvbjogMTUwLFxyXG4gICAgICAgICAgICAgICAgeW95bzogdHJ1ZSxcclxuICAgICAgICAgICAgICAgIHJlcGVhdDogLTFcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgaWYgKHRoaXMuZ2FtZS5jb25maWcud2lkdGggPCA0ODAgfHwgdGhpcy5nYW1lLmNvbmZpZy5oZWlnaHQgPCAzMjApIHtcclxuICAgICAgICAgICAgICAgIHRoaXMudGl0bGUuc2V0VGV4dChcIlNjcmVlbiFcIik7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnR3ZWVucy5hZGQoe1xyXG4gICAgICAgICAgICAgICAgICAgIHRhcmdldHM6IHRoaXMudGl0bGUsXHJcbiAgICAgICAgICAgICAgICAgICAgeTogNTAsXHJcbiAgICAgICAgICAgICAgICAgICAgZHVyYXRpb246IDE1MCxcclxuICAgICAgICAgICAgICAgICAgICB5b3lvOiB0cnVlLFxyXG4gICAgICAgICAgICAgICAgICAgIHJlcGVhdDogLTFcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5wbGF0Zm9ybS5zaG93KCk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLnJ1blNwYWNlKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICBydW5TcGFjZShzcGVlZCA9IFwibWluXCIsIG9iamVjdCA9IFtdKSB7XHJcbiAgICAgICAgaWYgKCFvYmplY3QubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIG9iamVjdCA9IFtcImdyb3VuZFwiLCBcImNpdHlcIiwgXCJjbG91ZFwiXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yIChsZXQgaW5kZXggaW4gb2JqZWN0KSB7XHJcbiAgICAgICAgICAgIHRoaXNbb2JqZWN0W2luZGV4XV0uc3BlZWQuY3VycmVudCA9IHRoaXNbb2JqZWN0W2luZGV4XV0uc3BlZWRbc3BlZWRdO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIHBhdXNlU3BhY2UoKSB7XHJcbiAgICAgICAgdGhpcy5sb2NrID0gdHJ1ZTtcclxuICAgICAgICB0aGlzLmdyb3VuZC5zcGVlZC5jdXJyZW50ID0gdGhpcy5ncm91bmQuc3BlZWQucGF1c2U7XHJcbiAgICAgICAgdGhpcy5jaXR5LnNwZWVkLmN1cnJlbnQgPSB0aGlzLmNpdHkuc3BlZWQucGF1c2U7XHJcbiAgICAgICAgdGhpcy5jbG91ZC5zcGVlZC5jdXJyZW50ID0gdGhpcy5jbG91ZC5zcGVlZC5wYXVzZTtcclxuICAgIH1cclxufVxyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBQbGF5OyJdfQ=="}